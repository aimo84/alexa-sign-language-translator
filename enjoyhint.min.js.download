var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||typeof Object.defineProperties=='function'?Object.defineProperty:function(b,c,a){a=a;if(b==Array.prototype||b==Object.prototype){return}b[c]=a.value};$jscomp.getGlobal=function(a){return typeof window!='undefined'&&window===a?a:typeof global!='undefined'&&global!=null?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(i,f,j,k){if(!f){return}var a=$jscomp.global;var b=i.split('.');for(var e=0;e<b.length-1;e++){var d=b[e];if(!(d in a)){a[d]={}}a=a[d]}var g=b[b.length-1];var h=a[g];var c=f(h);if(c==h||c==null){return}$jscomp.defineProperty(a,g,{configurable:!0,writable:!0,value:c})};$jscomp.polyfill('Array.prototype.copyWithin',function(a){if(a){return a}var b=function(d,c,b){var e=this.length;d=Number(d);c=Number(c);b=Number(b!=null?b:e);if(d<c){b=Math.min(b,e);while(c<b){if(c in this){this[d++]=this[c++]}else {delete this[d++];c++}}}else {b=Math.min(b,e+c-d);d+=b-c;while(b>c){if(--b in this){this[--d]=this[b]}else {delete this[d]}}}return this};return b},'es6','es3');$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};if(!$jscomp.global['Symbol']){$jscomp.global['Symbol']=$jscomp.Symbol}};$jscomp.Symbol=function(){var a=0;function Symbol(b){return $jscomp.SYMBOL_PREFIX+(b||'')+a++}return Symbol}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global['Symbol'].iterator;if(!a){a=$jscomp.global['Symbol'].iterator=$jscomp.global['Symbol']('iterator')}if(typeof Array.prototype[a]!='function'){$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}})}$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){if(b<a.length){return {done:!1,value:a[b++]}}else {return {done:!0}}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();var a={next:b};a[$jscomp.global['Symbol'].iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,d){$jscomp.initSymbolIterator();if(a instanceof String){a=a+''}var c=0;var b={next:function(){if(c<a.length){var e=c++;return {value:d(e,a[e]),done:!1}}b.next=function(){return {done:!0,value:void 0}};return b.next()}};b[Symbol.iterator]=function(){return b};return b};$jscomp.polyfill('Array.prototype.entries',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b,c){return [b,c]})};return b},'es6','es3');$jscomp.polyfill('Array.prototype.fill',function(a){if(a){return a}var b=function(f,c,b){var d=this.length||0;if(c<0){c=Math.max(0,d+c)}if(b==null||b>d){b=d}b=Number(b);if(b<0){b=Math.max(0,d+b)}for(var e=Number(c||0);e<b;e++){this[e]=f}return this};return b},'es6','es3');$jscomp.findInternal=function(a,d,e){if(a instanceof String){a=String(a)}var f=a.length;for(var b=0;b<f;b++){var c=a[b];if(d.call(e,c,b,a)){return {i:b,v:c}}}return {i:-1,v:void 0}};$jscomp.polyfill('Array.prototype.find',function(a){if(a){return a}var b=function(c,b){return $jscomp.findInternal(this,c,b).v};return b},'es6','es3');$jscomp.polyfill('Array.prototype.findIndex',function(a){if(a){return a}var b=function(c,b){return $jscomp.findInternal(this,c,b).i};return b},'es6','es3');$jscomp.polyfill('Array.from',function(a){if(a){return a}var b=function(b,c,g){$jscomp.initSymbolIterator();c=c!=null?c:function(d){return d};var e=[];var f=b[Symbol.iterator];if(typeof f=='function'){b=f.call(b);var h;var j=0;while(!(h=b.next()).done){e.push(c.call(g,h.value,j++))}}else {var i=b.length;for(var d=0;d<i;d++){e.push(c.call(g,b[d],d))}}return e};return b},'es6','es3');$jscomp.polyfill('Object.is',function(a){if(a){return a}var b=function(b,c){if(b===c){return b!==0||1/b===1/c}else {return b!==b&&c!==c}};return b},'es6','es3');$jscomp.polyfill('Array.prototype.includes',function(a){if(a){return a}var b=function(d,g){var c=this;if(c instanceof String){c=String(c)}var f=c.length;var b=g||0;if(b<0){b=Math.max(b+f,0)}for(;b<f;b++){var e=c[b];if(e===d||Object.is(e,d)){return !0}}return !1};return b},'es7','es3');$jscomp.polyfill('Array.prototype.keys',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(b){return b})};return b},'es6','es3');$jscomp.polyfill('Array.of',function(a){if(a){return a}var b=function(b){return Array.from(arguments)};return b},'es6','es3');$jscomp.polyfill('Array.prototype.values',function(a){if(a){return a}var b=function(){return $jscomp.iteratorFromArray(this,function(c,b){return b})};return b},'es8','es3');$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.polyfill('Promise',function(c){if(c&&!$jscomp.FORCE_POLYFILL_PROMISE){return c}function AsyncExecutor(){this.batch_=null}AsyncExecutor.prototype.asyncExecute=function(a){if(this.batch_==null){this.batch_=[];this.asyncExecuteBatch_()}this.batch_.push(a);return this};AsyncExecutor.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var e=$jscomp.global['setTimeout'];AsyncExecutor.prototype.asyncExecuteFunction=function(a){e(a,0)};AsyncExecutor.prototype.executeBatch_=function(){while(this.batch_&&this.batch_.length){var b=this.batch_;this.batch_=[];for(var a=0;a<b.length;++a){var d=b[a];b[a]=null;try{d()}catch(f){this.asyncThrow_(f)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a})};var b={PENDING:0,FULFILLED:1,REJECTED:2};var a=function(d){this.state_=b.PENDING;this.result_=undefined;this.onSettledCallbacks_=[];var a=this.createResolveAndReject_();try{d(a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.createResolveAndReject_=function(){var b=this;var a=!1;function firstCallWins(d){return function(e){if(!a){a=!0;d.call(b,e)}}}return {resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};a.prototype.resolveTo_=function(b){if(b===this){this.reject_(new TypeError('A Promise cannot resolve to itself'))}else {if(b instanceof a){this.settleSameAsPromise_(b)}else {if(isObject(b)){this.resolveToNonPromiseObj_(b)}else {this.fulfill_(b)}}}};a.prototype.resolveToNonPromiseObj_=function(b){var a=undefined;try{a=b.then}catch(f){this.reject_(f);return}if(typeof a=='function'){this.settleSameAsThenable_(a,b)}else {this.fulfill_(b)}};function isObject(a){switch(typeof a){case 'object':return a!=null;case 'function':return !0;default:return !1;}}a.prototype.reject_=function(a){this.settle_(b.REJECTED,a)};a.prototype.fulfill_=function(a){this.settle_(b.FULFILLED,a)};a.prototype.settle_=function(d,a){if(this.state_!=b.PENDING){throw new Error('Cannot settle('+d+', '+a+'): Promise already settled in state'+this.state_)}this.state_=d;this.result_=a;this.executeOnSettledCallbacks_()};a.prototype.executeOnSettledCallbacks_=function(){if(this.onSettledCallbacks_!=null){for(var a=0;a<this.onSettledCallbacks_.length;++a){d.asyncExecute(this.onSettledCallbacks_[a])}this.onSettledCallbacks_=null}};var d=new AsyncExecutor();a.prototype.settleSameAsPromise_=function(b){var a=this.createResolveAndReject_();b.callWhenSettled_(a.resolve,a.reject)};a.prototype.settleSameAsThenable_=function(b,d){var a=this.createResolveAndReject_();try{b.call(d,a.resolve,a.reject)}catch(f){a.reject(f)}};a.prototype.then=function(f,g){var b;var d;var e=new a(function(a,e){b=a;d=e});function createCallback(a,e){if(typeof a=='function'){return function(h){try{b(a(h))}catch(i){d(i)}}}else {return e}}this.callWhenSettled_(createCallback(f,b),createCallback(g,d));return e};a.prototype['catch']=function(a){return this.then(undefined,a)};a.prototype.callWhenSettled_=function(e,f){var a=this;function callback(){switch(a.state_){case b.FULFILLED:e(a.result_);break;case b.REJECTED:f(a.result_);break;default:throw new Error('Unexpected state: '+a.state_);}}if(this.onSettledCallbacks_==null){d.asyncExecute(callback)}else {this.onSettledCallbacks_.push(callback)}};function resolvingPromise(b){if(b instanceof a){return b}else {return new a(function(a,d){a(b)})}}a['resolve']=resolvingPromise;a['reject']=function(b){return new a(function(d,a){a(b)})};a['race']=function(b){return new a(function(e,f){var d=$jscomp.makeIterator(b);for(var a=d.next();!a.done;a=d.next()){resolvingPromise(a.value).callWhenSettled_(e,f)}})};a['all']=function(e){var d=$jscomp.makeIterator(e);var b=d.next();if(b.done){return resolvingPromise([])}else {return new a(function(g,h){var a=[];var f=0;function onFulfilled(b){return function(d){a[b]=d;f--;if(f==0){g(a)}}}do{a.push(undefined);f++;resolvingPromise(b.value).callWhenSettled_(onFulfilled(a.length-1),h);b=d.next()}while(!b.done)})}};return a},'es6','es3');$jscomp.polyfill('Promise.prototype.finally',function(a){if(a){return a}var b=function(b){return this.then(function(d){var c=Promise.resolve(b());return c.then(function(){return d})},function(d){var c=Promise.resolve(b());return c.then(function(){throw d})})};return b},'es9','es3');$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0};var a={};try{a.__proto__=b;return a.a}catch(c){}return !1};$jscomp.setPrototypeOf=typeof Object.setPrototypeOf=='function'?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b){throw new TypeError(a+' is not extensible')}return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(a instanceof Object){return}throw new TypeError('Iterator result '+a+' is not an object')};$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=undefined;this.nextAddress=1;this.catchAddress_=0;this.finallyAddress_=0;this.abruptCompletion_=null;this.finallyContexts_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_){throw new TypeError('Generator is already running')}this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype['return']=function(a){this.abruptCompletion_={'return':a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(b,a){this.nextAddress=a;return {value:b}};$jscomp.generator.Context.prototype.yieldAll=function(d,b){var c=$jscomp.makeIterator(d);var a=c.next();$jscomp.generator.ensureIteratorResultIsObject_(a);if(a.done){this.yieldResult=a.value;this.nextAddress=b;return}this.yieldAllIterator_=c;return this.yield(a.value,b)};$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(b,a){this.catchAddress_=b;if(a!=undefined){this.finallyAddress_=a}};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(b,a){this.nextAddress=b;this.catchAddress_=a||0};$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;var b=this.abruptCompletion_.exception;this.abruptCompletion_=null;return b};$jscomp.generator.Context.prototype.enterFinallyBlock=function(c,b,a){if(!a){this.finallyContexts_=[this.abruptCompletion_]}else {this.finallyContexts_[a]=this.abruptCompletion_}this.catchAddress_=c||0;this.finallyAddress_=b||0};$jscomp.generator.Context.prototype.leaveFinallyBlock=function(d,c){var b=this.finallyContexts_.splice(c||0)[0];var a=this.abruptCompletion_=this.abruptCompletion_||b;if(a){if(a.isException){return this.jumpToErrorHandler_()}if(a.jumpTo!=undefined&&this.finallyAddress_<a.jumpTo){this.nextAddress=a.jumpTo;this.abruptCompletion_=null}else {this.nextAddress=this.finallyAddress_}}else {this.nextAddress=d}};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a){this.properties_.push(b)}this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){while(this.properties_.length>0){var a=this.properties_.pop();if(a in this.object_){return a}}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context();this.program_=a};$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_){return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_)}this.context_.next_(a);return this.nextStep_()};$jscomp.generator.Engine_.prototype.return_=function(b){this.context_.start_();var a=this.context_.yieldAllIterator_;if(a){var c='return' in a?a['return']:function(a){return {value:a,done:!0}};return this.yieldAllStep_(c,b,this.context_['return'])}this.context_['return'](b);return this.nextStep_()};$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_){return this.yieldAllStep_(this.context_.yieldAllIterator_['throw'],a,this.context_.next_)}this.context_.throw_(a);return this.nextStep_()};$jscomp.generator.Engine_.prototype.yieldAllStep_=function(d,e,c){try{var a=d.call(this.context_.yieldAllIterator_,e);$jscomp.generator.ensureIteratorResultIsObject_(a);if(!a.done){this.context_.stop_();return a}var b=a.value}catch(f){this.context_.yieldAllIterator_=null;this.context_.throw_(f);return this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,b);return this.nextStep_()};$jscomp.generator.Engine_.prototype.nextStep_=function(){while(this.context_.nextAddress){try{var b=this.program_(this.context_);if(b){this.context_.stop_();return {value:b.value,done:!1}}}catch(c){this.context_.yieldResult=undefined;this.context_.throw_(c)}}this.context_.stop_();if(this.context_.abruptCompletion_){var a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException){throw a.exception}return {value:a['return'],done:!0}}return {value:undefined,done:!0}};$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this['throw']=function(b){return a.throw_(b)};this['return']=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(b,c){var a=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(c));if($jscomp.setPrototypeOf){$jscomp.setPrototypeOf(a,b.prototype)}return a};$jscomp.asyncExecutePromiseGenerator=function(a){function passValueToGenerator(b){return a.next(b)}function passErrorToGenerator(b){return a['throw'](b)}return new Promise(function(b,c){function handleGeneratorRecord(d){if(d.done){b(d.value)}else {Promise.resolve(d.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,c)}}handleGeneratorRecord(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};$jscomp.checkEs6ConformanceViaProxy=function(){try{var a={};var b=Object.create(new $jscomp.global['Proxy'](a,{'get':function(d,e,c){return d==a&&e=='q'&&c==b}}));return b['q']===!0}catch(c){return !1}};$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS=!1;$jscomp.ES6_CONFORMANCE=$jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS&&$jscomp.checkEs6ConformanceViaProxy();$jscomp.owns=function(b,a){return Object.prototype.hasOwnProperty.call(b,a)};$jscomp.polyfill('WeakMap',function(c){function isConformant(){if(!c||!Object.seal){return !1}try{var b=Object.seal({});var d=Object.seal({});var a=new c([[b,2],[d,3]]);if(a.get(b)!=2||a.get(d)!=3){return !1}a['delete'](b);a.set(d,4);return !a.has(b)&&a.get(d)==4}catch(e){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(c&&$jscomp.ES6_CONFORMANCE){return c}}else {if(isConformant()){return c}}var a='$jscomp_hidden_'+Math.random();function insert(b){if(!$jscomp.owns(b,a)){var d={};$jscomp.defineProperty(b,a,{value:d})}}function patch(a){var b=Object[a];if(b){Object[a]=function(d){insert(d);return b(d)}}}patch('freeze');patch('preventExtensions');patch('seal');var d=0;var b=function(a){this.id_=(d+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=$jscomp.makeIterator(a);var b;while(!(b=f.next()).done){var e=b.value;this.set(e[0],e[1])}}};b.prototype.set=function(b,d){insert(b);if(!$jscomp.owns(b,a)){throw new Error('WeakMap key fail: '+b)}b[a][this.id_]=d;return this};b.prototype.get=function(b){return $jscomp.owns(b,a)?b[a][this.id_]:undefined};b.prototype.has=function(b){return $jscomp.owns(b,a)&&$jscomp.owns(b[a],this.id_)};b.prototype['delete']=function(b){if(!$jscomp.owns(b,a)||!$jscomp.owns(b[a],this.id_)){return !1}return delete b[a][this.id_]};return b},'es6','es3');$jscomp.MapEntry=function(){this.previous;this.next;this.head;this.key;this.value};$jscomp.polyfill('Map',function(b){function isConformant(){if($jscomp.ASSUME_NO_NATIVE_MAP||!b||typeof b!='function'||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=b;var e=Object.seal({x:4});var c=new b($jscomp.makeIterator([[e,'s']]));if(c.get(e)!='s'||c.size!=1||c.get({x:4})||c.set({x:4},'t')!=c||c.size!=2){return !1}var d=c.entries();var a=d.next();if(a.done||a.value[0]!=e||a.value[1]!='s'){return !1}a=d.next();if(a.done||a.value[0].x!=4||a.value[1]!='t'||!d.next().done){return !1}return !0}catch(i){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE){return b}}else {if(isConformant()){return b}}$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=new WeakMap();var a=function(a){this.data_={};this.head_=f();this.size=0;if(a){var e=$jscomp.makeIterator(a);var c;while(!(c=e.next()).done){var d=c.value;this.set(d[0],d[1])}}};a.prototype.set=function(d,e){d=d===0?0:d;var a=c(this,d);if(!a.list){a.list=this.data_[a.id]=[]}if(!a.entry){a.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:d,value:e};a.list.push(a.entry);this.head_.previous.next=a.entry;this.head_.previous=a.entry;this.size++}else {a.entry.value=e}return this};a.prototype['delete']=function(d){var a=c(this,d);if(a.entry&&a.list){a.list.splice(a.index,1);if(!a.list.length){delete this.data_[a.id]}a.entry.previous.next=a.entry.next;a.entry.next.previous=a.entry.previous;a.entry.head=null;this.size--;return !0}return !1};a.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=f();this.size=0};a.prototype.has=function(a){return !!c(this,a).entry};a.prototype.get=function(d){var a=c(this,d).entry;return a&&a.value};a.prototype.entries=function(){return d(this,function(a){return [a.key,a.value]})};a.prototype.keys=function(){return d(this,function(a){return a.key})};a.prototype.values=function(){return d(this,function(a){return a.value})};a.prototype.forEach=function(e,d){var f=this.entries();var c;while(!(c=f.next()).done){var a=c.value;e.call(d,a[1],a[0],this)}};a.prototype[Symbol.iterator]=a.prototype.entries;var c=function(g,e){var f=h(e);var a=g.data_[f];if(a&&$jscomp.owns(g.data_,f)){for(var d=0;d<a.length;d++){var c=a[d];if(e!==e&&c.key!==c.key||e===c.key){return {id:f,list:a,index:d,entry:c}}}}return {id:f,list:a,index:-1,entry:undefined}};var d=function(c,d){var a=c.head_;return $jscomp.iteratorPrototype(function(){if(a){while(a.head!=c.head_){a=a.previous}while(a.next!=a.head){a=a.next;return {done:!1,value:d(a)}}a=null}return {done:!0,value:void 0}})};var f=function(){var a={};a.previous=a.next=a.head=a;return a};var g=0;var h=function(a){var c=a&&typeof a;if(c=='object'||c=='function'){a=a;if(!e.has(a)){var d=''+ ++g;e.set(a,d);return d}return e.get(a)}return 'p_'+a};return a},'es6','es3');$jscomp.polyfill('Math.acosh',function(a){if(a){return a}var b=function(b){b=Number(b);return Math.log(b+Math.sqrt(b*b-1))};return b},'es6','es3');$jscomp.polyfill('Math.asinh',function(a){if(a){return a}var b=function(b){b=Number(b);if(b===0){return b}var c=Math.log(Math.abs(b)+Math.sqrt(b*b+1));return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Math.log1p',function(a){if(a){return a}var b=function(b){b=Number(b);if(b<0.25&&b>-0.25){var f=b;var g=1;var c=b;var d=0;var e=1;while(d!=c){f*=b;e*=-1;c=(d=c)+e*f/++g}return c}return Math.log(1+b)};return b},'es6','es3');$jscomp.polyfill('Math.atanh',function(b){if(b){return b}var a=Math.log1p;var c=function(c){c=Number(c);return (a(c)-a(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.cbrt',function(a){if(a){return a}var b=function(b){if(b===0){return b}b=Number(b);var c=Math.pow(Math.abs(b),1/3);return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Math.clz32',function(a){if(a){return a}var b=function(b){b=Number(b)>>>0;if(b===0){return 32}var c=0;if((b&4.29490176E9)===0){b<<=16;c+=16}if((b&4.27819008E9)===0){b<<=8;c+=8}if((b&4.02653184E9)===0){b<<=4;c+=4}if((b&3.221225472E9)===0){b<<=2;c+=2}if((b&2.147483648E9)===0){c++}return c};return b},'es6','es3');$jscomp.polyfill('Math.cosh',function(a){if(a){return a}var b=Math.exp;var c=function(c){c=Number(c);return (b(c)+b(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.expm1',function(a){if(a){return a}var b=function(b){b=Number(b);if(b<0.25&&b>-0.25){var e=b;var f=1;var c=b;var d=0;while(d!=c){e*=b/++f;c=(d=c)+e}return c}return Math.exp(b)-1};return b},'es6','es3');$jscomp.polyfill('Math.hypot',function(a){if(a){return a}var b=function(d,e,h){d=Number(d);e=Number(e);var b,g,f;var c=Math.max(Math.abs(d),Math.abs(e));for(b=2;b<arguments.length;b++){c=Math.max(c,Math.abs(arguments[b]))}if(c>1.0E100||c<1.0E-100){if(!c){return c}d=d/c;e=e/c;f=d*d+e*e;for(b=2;b<arguments.length;b++){g=Number(arguments[b])/c;f+=g*g}return Math.sqrt(f)*c}else {f=d*d+e*e;for(b=2;b<arguments.length;b++){g=Number(arguments[b]);f+=g*g}return Math.sqrt(f)}};return b},'es6','es3');$jscomp.polyfill('Math.imul',function(a){if(a){return a}var b=function(b,c){b=Number(b);c=Number(c);var f=b>>>16&65535;var d=b&65535;var g=c>>>16&65535;var e=c&65535;var h=f*e+d*g<<16>>>0;return d*e+h|0};return b},'es6','es3');$jscomp.polyfill('Math.log10',function(a){if(a){return a}var b=function(b){return Math.log(b)/Math.LN10};return b},'es6','es3');$jscomp.polyfill('Math.log2',function(a){if(a){return a}var b=function(b){return Math.log(b)/Math.LN2};return b},'es6','es3');$jscomp.polyfill('Math.sign',function(a){if(a){return a}var b=function(b){b=Number(b);return b===0||isNaN(b)?b:b>0?1:-1};return b},'es6','es3');$jscomp.polyfill('Math.sinh',function(a){if(a){return a}var b=Math.exp;var c=function(c){c=Number(c);if(c===0){return c}return (b(c)-b(-c))/2};return c},'es6','es3');$jscomp.polyfill('Math.tanh',function(a){if(a){return a}var b=function(b){b=Number(b);if(b===0){return b}var c=Math.exp(-2*Math.abs(b));var d=(1-c)/(1+c);return b<0?-d:d};return b},'es6','es3');$jscomp.polyfill('Math.trunc',function(a){if(a){return a}var b=function(b){b=Number(b);if(isNaN(b)||b===Infinity||b===-Infinity||b===0){return b}var c=Math.floor(Math.abs(b));return b<0?-c:c};return b},'es6','es3');$jscomp.polyfill('Number.EPSILON',function(a){return Math.pow(2,-52)},'es6','es3');$jscomp.polyfill('Number.MAX_SAFE_INTEGER',function(){return 9.007199254740991E15},'es6','es3');$jscomp.polyfill('Number.MIN_SAFE_INTEGER',function(){return -9.007199254740991E15},'es6','es3');$jscomp.polyfill('Number.isFinite',function(a){if(a){return a}var b=function(b){if(typeof b!=='number'){return !1}return !isNaN(b)&&b!==Infinity&&b!==-Infinity};return b},'es6','es3');$jscomp.polyfill('Number.isInteger',function(a){if(a){return a}var b=function(b){if(!Number.isFinite(b)){return !1}return b===Math.floor(b)};return b},'es6','es3');$jscomp.polyfill('Number.isNaN',function(a){if(a){return a}var b=function(b){return typeof b==='number'&&isNaN(b)};return b},'es6','es3');$jscomp.polyfill('Number.isSafeInteger',function(a){if(a){return a}var b=function(b){return Number.isInteger(b)&&Math.abs(b)<=Number.MAX_SAFE_INTEGER};return b},'es6','es3');$jscomp.polyfill('Number.parseFloat',function(a){return a||parseFloat},'es6','es3');$jscomp.polyfill('Number.parseInt',function(a){return a||parseInt},'es6','es3');$jscomp.assign=typeof Object.assign=='function'?Object.assign:function(d,e){for(var c=1;c<arguments.length;c++){var a=arguments[c];if(!a){continue}for(var b in a){if($jscomp.owns(a,b)){d[b]=a[b]}}}return d};$jscomp.polyfill('Object.assign',function(a){return a||$jscomp.assign},'es6','es3');$jscomp.polyfill('Object.entries',function(a){if(a){return a}var b=function(c){var d=[];for(var b in c){if($jscomp.owns(c,b)){d.push([b,c[b]])}}return d};return b},'es8','es3');$jscomp.polyfill('Object.getOwnPropertySymbols',function(a){if(a){return a}return function(){return []}},'es6','es5');$jscomp.polyfill('Reflect.ownKeys',function(b){if(b){return b}var a='jscomp_symbol_';function isSymbol(c){return c.substring(0,a.length)==a}var c=function(e){var f=[];var c=Object.getOwnPropertyNames(e);var d=Object.getOwnPropertySymbols(e);for(var a=0;a<c.length;a++){(isSymbol(c[a])?d:f).push(c[a])}return f.concat(d)};return c},'es6','es5');$jscomp.polyfill('Object.getOwnPropertyDescriptors',function(a){if(a){return a}var b=function(e){var d={};var c=Reflect.ownKeys(e);for(var b=0;b<c.length;b++){d[c[b]]=Object.getOwnPropertyDescriptor(e,c[b])}return d};return b},'es8','es5');$jscomp.polyfill('Object.setPrototypeOf',function(a){return a||$jscomp.setPrototypeOf},'es6','es5');$jscomp.polyfill('Object.values',function(a){if(a){return a}var b=function(b){var c=[];for(var d in b){if($jscomp.owns(b,d)){c.push(b[d])}}return c};return b},'es8','es3');$jscomp.polyfill('Reflect.apply',function(a){if(a){return a}var c=Function.prototype.apply;var b=function(e,d,b){return c.call(e,d,b)};return b},'es6','es3');$jscomp.objectCreate=$jscomp.ASSUME_ES5||typeof Object.create=='function'?Object.create:function(b){var a=function(){};a.prototype=b;return new a()};$jscomp.construct=function(){function reflectConstructWorks(){function Base(){}function Derived(){}new Base();Reflect.construct(Base,[],Derived);return new Base() instanceof Base}if(typeof Reflect!='undefined'&&Reflect.construct){if(reflectConstructWorks()){return Reflect.construct}var b=Reflect.construct;var a=function(e,d,a){var c=b(e,d);if(a){Reflect.setPrototypeOf(c,a.prototype)}return c};return a}function construct(b,d,a){if(a===undefined){a=b}var f=a.prototype||Object.prototype;var c=$jscomp.objectCreate(f);var e=Function.prototype.apply;var g=e.call(b,c,d);return g||c}return construct}();$jscomp.polyfill('Reflect.construct',function(a){return $jscomp.construct},'es6','es3');$jscomp.polyfill('Reflect.defineProperty',function(a){if(a){return a}var b=function(e,d,c){try{Object.defineProperty(e,d,c);var b=Object.getOwnPropertyDescriptor(e,d);if(!b){return !1}return b.configurable===(c.configurable||!1)&&b.enumerable===(c.enumerable||!1)&&('value' in b?b.value===c.value&&b.writable===(c.writable||!1):b.get===c.get&&b.set===c.set)}catch(f){return !1}};return b},'es6','es5');$jscomp.polyfill('Reflect.deleteProperty',function(a){if(a){return a}var b=function(c,b){if(!$jscomp.owns(c,b)){return !0}try{return delete c[b]}catch(d){return !1}};return b},'es6','es3');$jscomp.polyfill('Reflect.getOwnPropertyDescriptor',function(a){return a||Object.getOwnPropertyDescriptor},'es6','es5');$jscomp.polyfill('Reflect.getPrototypeOf',function(a){return a||Object.getPrototypeOf},'es6','es5');$jscomp.findDescriptor=function(d,c){var a=d;while(a){var b=Reflect.getOwnPropertyDescriptor(a,c);if(b){return b}a=Reflect.getPrototypeOf(a)}return undefined};$jscomp.polyfill('Reflect.get',function(a){if(a){return a}var b=function(d,c,e){if(arguments.length<=2){return d[c]}var b=$jscomp.findDescriptor(d,c);if(b){return b.get?b.get.call(e):b.value}return undefined};return b},'es6','es5');$jscomp.polyfill('Reflect.has',function(a){if(a){return a}var b=function(c,b){return b in c};return b},'es6','es3');$jscomp.polyfill('Reflect.isExtensible',function(a){if(a){return a}if($jscomp.ASSUME_ES5||typeof Object.isExtensible=='function'){return Object.isExtensible}return function(){return !0}},'es6','es3');$jscomp.polyfill('Reflect.preventExtensions',function(a){if(a){return a}if(!($jscomp.ASSUME_ES5||typeof Object.preventExtensions=='function')){return function(){return !1}}var b=function(b){Object.preventExtensions(b);return !Object.isExtensible(b)};return b},'es6','es3');$jscomp.polyfill('Reflect.set',function(a){if(a){return a}var b=function(b,d,e,f){var c=$jscomp.findDescriptor(b,d);if(!c){if(Reflect.isExtensible(b)){b[d]=e;return !0}return !1}if(c.set){c.set.call(arguments.length>3?f:b,e);return !0}else {if(c.writable&&!Object.isFrozen(b)){b[d]=e;return !0}}return !1};return b},'es6','es5');$jscomp.polyfill('Reflect.setPrototypeOf',function(a){if(a){return a}else {if($jscomp.setPrototypeOf){var b=$jscomp.setPrototypeOf;var c=function(c,d){try{b(c,d);return !0}catch(e){return !1}};return c}else {return null}}},'es6','es5');$jscomp.polyfill('Set',function(b){function isConformant(){if($jscomp.ASSUME_NO_NATIVE_SET||!b||typeof b!='function'||!b.prototype.entries||typeof Object.seal!='function'){return !1}try{b=b;var d=Object.seal({x:4});var c=new b($jscomp.makeIterator([d]));if(!c.has(d)||c.size!=1||c.add(d)!=c||c.size!=1||c.add({x:4})!=c||c.size!=2){return !1}var e=c.entries();var a=e.next();if(a.done||a.value[0]!=d||a.value[1]!=d){return !1}a=e.next();if(a.done||a.value[0]==d||a.value[0].x!=4||a.value[1]!=a.value[0]){return !1}return e.next().done}catch(f){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(b&&$jscomp.ES6_CONFORMANCE){return b}}else {if(isConformant()){return b}}$jscomp.initSymbol();$jscomp.initSymbolIterator();var a=function(a){this.map_=new Map();if(a){var e=$jscomp.makeIterator(a);var c;while(!(c=e.next()).done){var d=c.value;this.add(d)}}this.size=this.map_.size};a.prototype.add=function(a){a=a===0?0:a;this.map_.set(a,a);this.size=this.map_.size;return this};a.prototype['delete']=function(c){var a=this.map_['delete'](c);this.size=this.map_.size;return a};a.prototype.clear=function(){this.map_.clear();this.size=0};a.prototype.has=function(a){return this.map_.has(a)};a.prototype.entries=function(){return this.map_.entries()};a.prototype.values=function(){return this.map_.values()};a.prototype.keys=a.prototype.values;a.prototype[Symbol.iterator]=a.prototype.values;a.prototype.forEach=function(c,a){var d=this;this.map_.forEach(function(e){return c.call(a,e,e,d)})};return a},'es6','es3');$jscomp.checkStringArgs=function(a,c,b){if(a==null){throw new TypeError("The 'this' value for String.prototype."+b+' must not be null or undefined')}if(c instanceof RegExp){throw new TypeError('First argument to String.prototype.'+b+' must not be a regular expression')}return a+''};$jscomp.polyfill('String.prototype.codePointAt',function(a){if(a){return a}var b=function(b){var e=$jscomp.checkStringArgs(this,null,'codePointAt');var f=e.length;b=Number(b)||0;if(!(b>=0&&b<f)){return void 0}b=b|0;var c=e.charCodeAt(b);if(c<55296||c>56319||b+1===f){return c}var d=e.charCodeAt(b+1);if(d<56320||d>57343){return c}return (c-55296)*1024+d+9216};return b},'es6','es3');$jscomp.polyfill('String.prototype.endsWith',function(a){if(a){return a}var b=function(b,c){var d=$jscomp.checkStringArgs(this,b,'endsWith');b=b+'';if(c===void 0){c=d.length}var f=Math.max(0,Math.min(c|0,d.length));var e=b.length;while(e>0&&f>0){if(d[--f]!=b[--e]){return !1}}return e<=0};return b},'es6','es3');$jscomp.polyfill('String.fromCodePoint',function(a){if(a){return a}var b=function(e){var c='';for(var d=0;d<arguments.length;d++){var b=Number(arguments[d]);if(b<0||b>1114111||b!==Math.floor(b)){throw new RangeError('invalid_code_point '+b)}if(b<=65535){c+=String.fromCharCode(b)}else {b-=65536;c+=String.fromCharCode(b>>>10&1023|55296);c+=String.fromCharCode(b&1023|56320)}}return c};return b},'es6','es3');$jscomp.polyfill('String.prototype.includes',function(a){if(a){return a}var b=function(b,c){var d=$jscomp.checkStringArgs(this,b,'includes');return d.indexOf(b,c||0)!==-1};return b},'es6','es3');$jscomp.polyfill('String.prototype.repeat',function(a){if(a){return a}var b=function(b){var c=$jscomp.checkStringArgs(this,null,'repeat');if(b<0||b>1342177279){throw new RangeError('Invalid count value')}b=b|0;var d='';while(b){if(b&1){d+=c}if(b>>>=1){c+=c}}return d};return b},'es6','es3');$jscomp.stringPadding=function(c,a){var b=c!==undefined?String(c):' ';if(!(a>0)||!b){return ''}var d=Math.ceil(a/b.length);return b.repeat(d).substring(0,a)};$jscomp.polyfill('String.prototype.padEnd',function(a){if(a){return a}var b=function(d,c){var b=$jscomp.checkStringArgs(this,null,'padStart');var e=d-b.length;return b+$jscomp.stringPadding(c,e)};return b},'es8','es3');$jscomp.polyfill('String.prototype.padStart',function(a){if(a){return a}var b=function(d,c){var b=$jscomp.checkStringArgs(this,null,'padStart');var e=d-b.length;return $jscomp.stringPadding(c,e)+b};return b},'es8','es3');$jscomp.polyfill('String.prototype.startsWith',function(a){if(a){return a}var b=function(b,g){var c=$jscomp.checkStringArgs(this,b,'startsWith');b=b+'';var h=c.length;var e=b.length;var f=Math.max(0,Math.min(g|0,c.length));var d=0;while(d<e&&f<h){if(c[f++]!=b[d++]){return !1}}return d>=e};return b},'es6','es3');$jscomp.arrayFromIterator=function(c){var b;var a=[];while(!(b=c.next()).done){a.push(b.value)}return a};$jscomp.arrayFromIterable=function(a){if(a instanceof Array){return a}else {return $jscomp.arrayFromIterator($jscomp.makeIterator(a))}};$jscomp.inherits=function(a,b){a.prototype=$jscomp.objectCreate(b.prototype);a.prototype.constructor=a;if($jscomp.setPrototypeOf){var e=$jscomp.setPrototypeOf;e(a,b)}else {for(var c in b){if(c=='prototype'){continue}if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);if(d){Object.defineProperty(a,c,d)}}else {a[c]=b[c]}}}a.superClass_=b.prototype};$jscomp.polyfill('WeakSet',function(a){function isConformant(){if(!a||!Object.seal){return !1}try{var c=Object.seal({});var d=Object.seal({});var b=new a([c]);if(!b.has(c)||b.has(d)){return !1}b['delete'](c);b.add(d);return !b.has(c)&&b.has(d)}catch(e){return !1}}if($jscomp.USE_PROXY_FOR_ES6_CONFORMANCE_CHECKS){if(a&&$jscomp.ES6_CONFORMANCE){return a}}else {if(isConformant()){return a}}var b=function(b){this.map_=new WeakMap();if(b){$jscomp.initSymbol();$jscomp.initSymbolIterator();var e=$jscomp.makeIterator(b);var c;while(!(c=e.next()).done){var d=c.value;this.add(d)}}};b.prototype.add=function(b){this.map_.set(b,!0);return this};b.prototype.has=function(b){return this.map_.has(b)};b.prototype['delete']=function(b){return this.map_['delete'](b)};return b},'es6','es3');try{if(Array.prototype.values.toString().indexOf('[native code]')==-1){delete Array.prototype.values}}catch(a){}var EnjoyHint=function(m){var d,a=this,n={onStart:function(){},onEnd:function(){},onSkip:function(){},onNext:function(){}},f=$.extend(n,m),e=[],b=0;$body=$('body');var o=function(){$('.enjoyhint')&&$('.enjoyhint').remove(),$body.css({overflow:'hidden'}),$(document).on('touchmove',i),$body.enjoyhint({onNextClick:function(){k()},onSkipClick:function(){f.onSkip(),h()}})},i=function(a){a.preventDefault()},j=function(){$('.enjoyhint').remove(),$body.css({overflow:'auto'}),$(document).off('touchmove',i)};a.clear=function(){var b=$('.enjoyhint_next_btn'),c=$('.enjoyhint_skip_btn');b.removeClass(a.nextUserClass),b.text('Next'),c.removeClass(a.skipUserClass),c.text('Skip')};var c=function(){if(!e||!e[b]){return $body.enjoyhint('hide'),f.onEnd(),void j()}f.onNext();var i=$('.enjoyhint');i.removeClass('enjoyhint-step-'+b),i.removeClass('enjoyhint-step-'+(b+1)),i.addClass('enjoyhint-step-'+(b+1));var h=e[b];h.onBeforeStart&&'function'==typeof h.onBeforeStart&&h.onBeforeStart();var k=h.timeout||0;setTimeout(function(){if(!h.selector){for(var e in h){h.hasOwnProperty(e)&&e.split(' ')[1]&&(h.selector=e.split(' ')[1],h.event=e.split(' ')[0],'next'!=e.split(' ')[0]&&'auto'!=e.split(' ')[0]&&'custom'!=e.split(' ')[0]||(h.event_type=e.split(' ')[0]),h.description=h[e])}}setTimeout(function(){a.clear()},250),$(document.body).scrollTo(h.selector,h.scrollAnimationSpeed||250,{offset:-100}),setTimeout(function(){var e=$(h.selector),i=g(h.event);if($body.enjoyhint('show'),$body.enjoyhint('hide_next'),d=e,h.event_selector&&(d=$(h.event_selector)),h.event_type||'key'!=h.event||e.keydown(function(a){a.which==h.keyCode&&(b++,c())}),1==h.showNext&&$body.enjoyhint('show_next'),0==h.showSkip?$body.enjoyhint('hide_skip'):$body.enjoyhint('show_skip'),1==h.showSkip,h.nextButton){var j=$('.enjoyhint_next_btn');j.addClass(h.nextButton.className||''),j.text(h.nextButton.text||'Next'),a.nextUserClass=h.nextButton.className}if(h.skipButton){var k=$('.enjoyhint_skip_btn');k.addClass(h.skipButton.className||''),k.text(h.skipButton.text||'Skip'),a.skipUserClass=h.skipButton.className}if(h.event_type){switch(h.event_type){case 'auto':switch(e[h.event](),h.event){case 'click':};return b++,void c();case 'custom':p(h.event,function(){b++,l(h.event),c()});break;case 'next':$body.enjoyhint('show_next');}}else {d.on(i,function(a){h.keyCode&&a.keyCode!=h.keyCode||(b++,$(this).off(i),c())})}var t=Math.max(e.outerWidth(),e.outerHeight()),u=h.radius||Math.round(t/2)+5,n=e.offset(),o=e.outerWidth(),q=e.outerHeight(),r=void 0!==h.margin?h.margin:10,s={x:n.left+Math.round(o/2),y:n.top+Math.round(q/2)-$(document).scrollTop()},f={enjoyHintElementSelector:h.selector,center_x:s.x,center_y:s.y,text:h.description,top:h.top,bottom:h.bottom,left:h.left,right:h.right,margin:h.margin,scroll:h.scroll};h.shape&&'circle'==h.shape?(f.shape='circle',f.radius=u):(f.radius=0,f.width=o+r,f.height=q+r),$body.enjoyhint('render_label_with_shape',f,a.stop)},h.scrollAnimationSpeed+20||270)},k)},k=function(){b++,c()},h=function(){var a=e[b],c=$(a.selector);l(a.event),c.off(g(a.event)),j()},g=function(a,b){return a+(b?'custom':'')+'.enjoy_hint'},p=function(a,b){$body.on(g(a,!0),b)},l=function(a){$body.off(g(a,!0))};window.addEventListener('resize',function(){null!=d&&$body.enjoyhint('redo_events_near_rect',d[0].getBoundingClientRect())}),a.stop=function(){h()},a.reRunScript=function(a){b=a,c()},a.runScript=function(){b=0,f.onStart(),c()},a.resumeScript=function(){c()},a.setCurrentStep=function(a){b=a},a.getCurrentStep=function(){return b},a.trigger=function(a){switch(a){case 'next':k();break;case 'skip':h();}},a.setScript=function(a){a&&(e=a)},a.set=function(b){a.setScript(b)},a.setSteps=function(b){a.setScript(b)},a.run=function(){a.runScript()},a.resume=function(){a.resumeScript()},o()};CanvasRenderingContext2D.prototype.roundRect=function(a,b,d,e,c){return d<2*c&&(c=d/2),e<2*c&&(c=e/2),this.beginPath(),this.moveTo(a+c,b),this.arcTo(a+d,b,a+d,b+e,c),this.arcTo(a+d,b+e,a,b+e,c),this.arcTo(a,b+e,a,b,c),this.arcTo(a,b,a+d,b,c),this.closePath(),this},function(b){var a,g,h,c,d,e,n,f,o,i,j,k=window.innerWidth,l=window.innerHeight,m={init:function(m){return this.each(function(){function p(e,a){var c=document.createElementNS('http://www.w3.org/2000/svg',e);for(var d in a){c.setAttribute(d,a[d])}return c}var x={onNextClick:function(){},onSkipClick:function(){},animation_time:800};this.enjoyhint_obj={},a=this.enjoyhint_obj,a.resetComponentStuff=function(){g=null,h=null,c=null,d=null,e=null,n=null,f=null,o=null,i=null,j=null,k=window.innerWidth,l=window.innerHeight};var y=b(this);a.options=jQuery.extend(x,m),a.gcl={chooser:'enjoyhint'},a.cl={enjoy_hint:'enjoyhint',hide:'enjoyhint_hide',disable_events_element:'enjoyhint_disable_events',btn:'enjoyhint_btn',skip_btn:'enjoyhint_skip_btn',close_btn:'enjoyhint_close_btn',next_btn:'enjoyhint_next_btn',main_canvas:'enjoyhint_canvas',main_svg:'enjoyhint_svg',svg_wrapper:'enjoyhint_svg_wrapper',svg_transparent:'enjoyhint_svg_transparent',kinetic_container:'kinetic_container'},a.canvas_size={w:1.4*b(window).width(),h:1.4*b(window).height()};var z='enj_canvas';a.enjoyhint=b('<div>',{'class':a.cl.enjoy_hint+' '+a.cl.svg_transparent}).appendTo(y),a.enjoyhint_svg_wrapper=b('<div>',{'class':a.cl.svg_wrapper+' '+a.cl.svg_transparent}).appendTo(a.enjoyhint),a.$stage_container=b('<div id="'+a.cl.kinetic_container+'">').appendTo(a.enjoyhint),a.$canvas=b('<canvas id="'+z+'" width="'+a.canvas_size.w+'" height="'+a.canvas_size.h+'" class="'+a.cl.main_canvas+'">').appendTo(a.enjoyhint),a.$svg=b('<svg width="'+a.canvas_size.w+'" height="'+a.canvas_size.h+'" class="'+a.cl.main_canvas+' '+a.cl.main_svg+'">').appendTo(a.enjoyhint_svg_wrapper);var A=b(p('defs')),B=b(p('marker',{id:'arrowMarker',viewBox:'0 0 36 21',refX:'21',refY:'10',markerUnits:'strokeWidth',orient:'auto',markerWidth:'16',markerHeight:'12'})),C=b(p('path',{style:'fill:none; stroke:rgb(255,255,255); stroke-width:2',d:'M0,0 c30,11 30,9 0,20'}));A.append(B.append(C)).appendTo(a.$svg),a.kinetic_stage=new Kinetic.Stage({container:a.cl.kinetic_container,width:a.canvas_size.w,height:a.canvas_size.h,scaleX:1}),a.layer=new Kinetic.Layer(),a.rect=new Kinetic.Rect({fill:'rgba(0,0,0,0.6)',width:a.canvas_size.w,height:a.canvas_size.h});var q=b('<div>',{'class':a.cl.disable_events_element}).appendTo(a.enjoyhint),t=q.clone().appendTo(a.enjoyhint),u=q.clone().appendTo(a.enjoyhint),v=q.clone().appendTo(a.enjoyhint),r=function(a){a.stopImmediatePropagation()};b('button').focusout(r),q.click(r),t.click(r),u.click(r),v.click(r),a.$skip_btn=b('<div>',{'class':a.cl.skip_btn}).appendTo(a.enjoyhint).html('Skip').click(function(c){a.hide(),a.options.onSkipClick()}),a.$next_btn=b('<div>',{'class':a.cl.next_btn}).appendTo(a.enjoyhint).html('Next').click(function(c){a.options.onNextClick()}),a.$close_btn=b('<div>',{'class':a.cl.close_btn}).appendTo(a.enjoyhint).html('').click(function(c){a.hide(),a.options.onSkipClick()}),a.$canvas.mousedown(function(a){b('canvas').css({left:'4000px'});var c=document.elementFromPoint(a.clientX,a.clientY);return b('canvas').css({left:'0px'}),b(c).click(),!1});var w=0,s=130;a.shape=new Kinetic.Shape({radius:w,center_x:-s,center_y:-s,width:0,height:0,sceneFunc:function(f){var a=this.getContext('2d')._context,c=(this.pos,a.globalCompositeOperation);a.globalCompositeOperation='destination-out',a.beginPath();var d=this.attrs.center_x-Math.round(this.attrs.width/2),e=this.attrs.center_y-Math.round(this.attrs.height/2);a.roundRect(d,e,this.attrs.width,this.attrs.height,this.attrs.radius),a.fillStyle='red',a.fill(),a.globalCompositeOperation=c}}),a.shape.radius=w,a.layer.add(a.rect),a.layer.add(a.shape),a.kinetic_stage.add(a.layer),b(window).on('resize',function(){if(!b(a.stepData.enjoyHintElementSelector).is(':visible')){return a.stopFunction(),void b(window).off('resize')}i=window.innerWidth,j=window.innerHeight;var w=b(a.stepData.enjoyHintElementSelector)[0].getBoundingClientRect();a.shape.attrs.center_x=Math.round(w.left+w.width/2),a.shape.attrs.center_y=Math.round(w.top+w.height/2),a.shape.attrs.width=w.width+11,a.shape.attrs.height=w.height+11;var E=window.innerWidth,F=window.innerHeight,G=E/k,H=F/l;if(a.kinetic_stage.setAttr('width',k*G),a.kinetic_stage.setAttr('height',l*H),null!=a.stepData){if(i=window.innerWidth,j=window.innerHeight,e||(e=a.shape.attrs.center_x,n=a.shape.attrs.center_y),!c){c=[];var v=b('#enjoyhint_arrpw_line').attr('d');c.push(v.substr(1).split(',')[0]),c.push(v.substr(v.indexOf('Q')+1).split(',')[0]),c.push(v.split(' ')[2].split(',')[0]),d=[],d.push(v.split(',')[1].split(' ')[0]),d.push(v.split(',')[2].split(' ')[0]),d.push(v.split(',')[3])}var s=b('.enjoy_hint_label');g||(g=s[0].getBoundingClientRect().left,h=s[0].getBoundingClientRect().top);var x=b('.enjoyhint_skip_btn');f||(f=x[0].getBoundingClientRect().left,o=x[0].getBoundingClientRect().top),s.css('left',window.innerWidth/2-s.outerWidth()/2);var p=s[0].getBoundingClientRect();if(window.innerWidth<640){b('#enjoyhint_arrpw_line').hide(),s.css('top',window.innerHeight/2-s.outerHeight()/2)}else {b('#enjoyhint_arrpw_line').show(),s.css('top',h);var q,t,r,u,A=p.left+p.width/2<a.shape.attrs.center_x,C=p.top+p.height/2<a.shape.attrs.center_y;window.innerWidth<900?(q=Math.round(p.left+(p.width/2+15)*(p.left+p.width/2<a.shape.attrs.center_x?1:-1)),r=Math.round(p.top+p.height*(p.top+p.height/2<a.shape.attrs.center_y?1:-1)),t=Math.round(a.shape.attrs.center_x+(a.shape.attrs.radius+15)*(A?-1:1)),u=Math.round(a.shape.attrs.center_y)):(q=Math.round(p.left+p.width/2+(p.width/2+15)*(A?1:-1)),r=Math.round(p.top+p.height/2),t=Math.round(a.shape.attrs.center_x),u=Math.round(a.shape.attrs.center_y+(a.shape.attrs.height/2+15)*(C?-1:1)));var y=q<t?t:q,z=r<u?r:u;Math.abs(p.left+p.width/2-a.shape.attrs.center_x)<200&&(q=t=p.left+p.width/2,r=p.top,y=q,z=r,console.log('ok')),window.innerWidth<900&&(y=q<t?q:t,z=r<u?u:r);var D='M%d1,%d2 Q%d3,%d4 %d5,%d6'.replace('%d1',q).replace('%d2',r).replace('%d3',y).replace('%d4',z).replace('%d5',t).replace('%d6',u);b('#enjoyhint_arrpw_line')[0].setAttribute('d',D)}var B=+f+(a.shape.attrs.center_x-e)/2;x.css('left',B<15?15:B),x.css('top',p.top+p.height+20)}a.rect=new Kinetic.Rect({fill:'rgba(0,0,0,0.6)',width:window.innerWidth,height:window.innerHeight}),a.layer.removeChildren(),a.layer.add(a.rect),a.layer.add(a.shape),a.layer.draw(),a.kinetic_stage.draw()});[a.enjoyhint,q,t,u,v];return a.show=function(){a.enjoyhint.removeClass(a.cl.hide)},a.hide=function(){a.enjoyhint.addClass(a.cl.hide);var c=new Kinetic.Tween({node:a.shape,duration:0.002,center_x:-s,center_y:-s});c.play()},a.hide(),a.hideNextBtn=function(){a.$next_btn.addClass(a.cl.hide),a.nextBtn='hide'},a.showNextBtn=function(){a.$next_btn.removeClass(a.cl.hide),a.nextBtn='show'},a.hideSkipBtn=function(){a.$skip_btn.addClass(a.cl.hide)},a.showSkipBtn=function(){a.$skip_btn.removeClass(a.cl.hide)},a.renderCircle=function(g){var c=g.r||0,d=g.x||0,e=g.y||0,l=new Kinetic.Tween({node:a.shape,duration:0.2,center_x:d,center_y:e,width:2*c,height:2*c,radius:c});l.play();var h=d-c,i=d+c,j=e-c,k=e+c,f=20;return {x:d,y:e,left:h,right:i,top:j,bottom:k,conn:{left:{x:h-f,y:e},right:{x:i+f,y:e},top:{x:d,y:j-f},bottom:{x:d,y:k+f}}}},a.renderRect=function(e,p){var q=e.r||0,c=e.x||0,d=e.y||0,g=e.w||0,h=e.h||0,f=20,r=new Kinetic.Tween({node:a.shape,duration:p,center_x:c,center_y:d,width:g,height:h,radius:q});r.play();var i=Math.round(g/2),j=Math.round(h/2),k=c-i,l=c+i,n=d-j,o=d+j;return {x:c,y:d,left:k,right:l,top:n,bottom:o,conn:{left:{x:k-f,y:d},right:{x:l+f,y:d},top:{x:c,y:n-f},bottom:{x:c,y:o+f}}}},a.renderLabel=function(d){var j=d.x||0;a.originalElementX=j;var n=d.y||0,c=(d.text||0,a.getLabelElement({x:j,y:n,text:d.text})),h=c.width(),i=c.height(),e=c.offset().left,k=c.offset().left+h,f=c.offset().top-b(document).scrollTop(),l=c.offset().top+i,g=10,o={x:e-g,y:f+Math.round(i/2)},p={x:k+g,y:f+Math.round(i/2)},q={x:e+Math.round(h/2),y:f-g},r={x:e+Math.round(h/2),y:l+g};return c.detach(),setTimeout(function(){b('#enjoyhint_label').remove(),c.appendTo(a.enjoyhint)},a.options.animation_time/2),{label:c,left:e,right:k,top:f,bottom:l,conn:{left:o,right:p,top:q,bottom:r}}},a.renderArrow=function(c){if(window.innerWidth>=640){var h=c.x_from||0,d=c.y_from||0,i=c.x_to||0,e=c.y_to||0,j=c.by_top_side,f=0,g=0;j?d>=e?(g=e,f=h):(g=d,f=i):d>=e?(g=d,f=i):(g=e,f=h)}c.text||'';a.enjoyhint.addClass(a.cl.svg_transparent),setTimeout(function(){b('#enjoyhint_arrpw_line').remove();var j='M'+h+','+d+' Q'+f+','+g+' '+i+','+e;a.$svg.append(p('path',{style:'fill:none; stroke:rgb(255,255,255); stroke-width:3','marker-end':'url(#arrowMarker)',d:j,id:'enjoyhint_arrpw_line'})),a.enjoyhint.removeClass(a.cl.svg_transparent)},a.options.animation_time/2)},a.getLabelElement=function(c){return b('<div>',{'class':'enjoy_hint_label',id:'enjoyhint_label'}).css({top:c.y+'px',left:c.x+'px'}).html(c.text).appendTo(a.enjoyhint)},a.disableEventsNearRect=function(a){q.css({top:'0',left:'0'}).height(a.top),t.css({top:a.bottom+'px',left:'0'}),u.css({top:'0',left:'0px'}).width(a.left),v.css({top:'0',left:a.right+'px'})},function(a){a.event.special.destroyed={remove:function(c){c.handler&&c.handler()}}}(jQuery),a.renderLabelWithShape=function(c){function d(a){return 'MD-DIALOG'===a.tagName?a:'undefined'==typeof a.tagName?null:d(b(a).parent()[0])}function e(a,d,e){x=a,y=d,w=e}function f(d,f,g,h,i){var a=[];a=r?d:K?f:J?g:L?h:i,a&&e(a[0],a[1],a[2])}a.stepData=c;var C=d(b(a.stepData.enjoyHintElementSelector)[0]);null!=C&&b(C).on('dialogClosing',function(){a.stopFunction()}),a.resetComponentStuff();var N=c.shape||'rect',g={},k=0,j=0,l={top:c.top||0,bottom:c.bottom||0,left:c.left||0,right:c.right||0};switch(N){case 'circle':k=j=c.radius;var i={top:c.center_y-j+l.top,bottom:c.center_y+j-l.bottom,left:c.center_x-k+l.left,right:c.center_x+k-l.right},D=i.right-i.left,E=i.bottom-i.top;c.radius=Math.round(Math.min(D,E)/2),k=j=Math.round(c.radius/2);var O=Math.round(D/2),P=Math.round(E/2);c.center_x=i.left+O,c.center_y=i.top+P,g=a.renderCircle({x:c.center_x,y:c.center_y,r:c.radius});break;case 'rect':k=Math.round(c.width/2),j=Math.round(c.height/2);var i={top:c.center_y-j+l.top,bottom:c.center_y+j-l.bottom,left:c.center_x-k+l.left,right:c.center_x+k-l.right};c.width=i.right-i.left,c.height=i.bottom-i.top,k=Math.round(c.width/2),j=Math.round(c.height/2),c.center_x=i.left+k,c.center_y=i.top+j,g=a.renderRect({x:c.center_x,y:c.center_y,w:c.width,h:c.height,r:c.radius},0.2);}var p={w:a.enjoyhint.width(),h:a.enjoyhint.height()},s=a.getLabelElement({x:0,y:0,text:c.text}),Q=s.outerWidth(),q=s.outerHeight();s.remove();var R=c.center_y-j,S=p.h-(c.center_y+j),T=(c.center_x-k,p.w-(c.center_x+k),p.w-c.center_x<c.center_x?'left':'right',p.h-c.center_y<c.center_y?'top':'bottom'),F=150,G=40,t=F+q+G,u=j+F,n='top'==T?c.center_y-u-q:c.center_y+u,o=window.innerWidth/2-Q/2;R<t&&S<t&&(n=c.center_y+G),window.innerWidth<=640;var h=a.renderLabel({x:o,y:n,text:c.text});a.$next_btn.css({left:o,top:n+q+20});var v=o+a.$next_btn.width()+10;'hide'==a.nextBtn&&(v=o),a.$skip_btn.css({left:v,top:n+q+20}),a.$close_btn.css({right:10,top:10}),a.disableEventsNearRect({top:g.top,bottom:g.bottom,left:g.left,right:g.right});var w=!1,x='left',y='left',H=h.left<=g.x&&h.right>=g.x,I=h.right<g.x,r=(h.left>g.x,h.right<g.left,h.left>g.right,h.bottom<g.top),z=h.top>g.bottom,J=h.bottom>=g.y&&h.top<=g.y,K=h.bottom<=g.y&&!r,L=h.top>=g.y&&!z;if(H){if(r){e('bottom','top','top')}else {if(!z){return}e('top','bottom','bottom')}}else {I?f(['right','top','top'],['bottom','left','bottom'],['right','left','top'],['top','left','top'],['right','bottom','bottom']):f(['left','top','top'],['bottom','right','bottom'],['left','right','top'],['top','right','top'],['left','bottom','bottom'])}var A=h.conn[x],B=g.conn[y],M='top'==w;a.renderArrow({x_from:A.x,y_from:A.y,x_to:window.innerWidth<640?g.left+(g.left>0):B.x,y_to:window.innerWidth<640?g.conn.left.y:B.y,by_top_side:M})},a.clear=function(){a.ctx.clearRect(0,0,3000,2000)},this})},set:function(a){return this.each(function(){this.enjoyhint_obj.setValue(a)}),this},show:function(){return this.each(function(){this.enjoyhint_obj.show()}),this},hide:function(){return this.each(function(){this.enjoyhint_obj.hide()}),this},hide_next:function(){return this.each(function(){this.enjoyhint_obj.hideNextBtn()}),this},show_next:function(){return this.each(function(){this.enjoyhint_obj.showNextBtn()}),this},hide_skip:function(){return this.each(function(){this.enjoyhint_obj.hideSkipBtn()}),this},show_skip:function(){return this.each(function(){this.enjoyhint_obj.showSkipBtn()}),this},render_circle:function(a,c,d){return this.each(function(){this.enjoyhint_obj.renderCircle(a,c,d)}),this},render_label:function(a,c,d){return this.each(function(){this.enjoyhint_obj.renderLabel(a,c,d)}),this},render_label_with_shape:function(c,d){return this.each(function(){a.stopFunction=d,this.enjoyhint_obj.renderLabelWithShape(c)}),this},redo_events_near_rect:function(c){a.disableEventsNearRect({top:c.top,bottom:c.bottom,left:c.left,right:c.right})},clear:function(){return this.each(function(){this.enjoyhint_obj.clear()}),this},close:function(a){return this.each(function(){this.enjoyhint_obj.closePopdown()}),this}};b.fn.enjoyhint=function(a){return m[a]?m[a].apply(this,Array.prototype.slice.call(arguments,1)):'object'!=typeof a&&a?(b.error('Method '+a+' does not exist on $.numinput'),this):m.init.apply(this,arguments)}}(window.jQuery);var Kinetic={};!function(a){var b=Math.PI/180;Kinetic={version:'5.2.0',stages:[],idCounter:0,ids:{},names:{},shapes:{},listenClickTap:!1,inDblClickWindow:!1,enableTrace:!1,traceArrMax:100,dblClickWindow:400,pixelRatio:void 0,dragDistance:0,angleDeg:!0,showWarnings:!0,Filters:{},Node:function(b){this._init(b)},Shape:function(b){this.__init(b)},Container:function(b){this.__init(b)},Stage:function(b){this.___init(b)},BaseLayer:function(b){this.___init(b)},Layer:function(b){this.____init(b)},FastLayer:function(b){this.____init(b)},Group:function(b){this.___init(b)},isDragging:function(){var b=Kinetic.DD;return !!b&&b.isDragging},isDragReady:function(){var b=Kinetic.DD;return !!b&&!!b.node},_addId:function(c,b){void 0!==b&&(this.ids[b]=c)},_removeId:function(b){void 0!==b&&delete this.ids[b]},_addName:function(f,d){if(void 0!==d){for(var e=d.split(/\s/g),c=0;c<e.length;c++){var b=e[c];b&&(void 0===this.names[b]&&(this.names[b]=[]),this.names[b].push(f))}}},_removeName:function(d,e){if(void 0!==d){var b=this.names[d];if(void 0!==b){for(var c=0;c<b.length;c++){var f=b[c];f._id===e&&b.splice(c,1)}0===b.length&&delete this.names[d]}}},getAngle:function(c){return this.angleDeg?c*b:c},_parseUA:function(c){var b=c.toLowerCase(),d=/(chrome)[ \/]([\w.]+)/.exec(b)||/(webkit)[ \/]([\w.]+)/.exec(b)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(b)||/(msie) ([\w.]+)/.exec(b)||b.indexOf('compatible')<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(b)||[],e=!!c.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i),f=!!c.match(/IEMobile/i);return {browser:d[1]||'',version:d[2]||'0',mobile:e,ieMobile:f}},UA:void 0},Kinetic.UA=Kinetic._parseUA(a.navigator&&a.navigator.userAgent||'')}(this),function(a,b){if('object'==typeof exports){var d=b();if(global.window===global){Kinetic.document=global.document,Kinetic.window=global}else {var c=require('canvas'),e=require('jsdom').jsdom;Kinetic.document=e('<!DOCTYPE html><html><head></head><body></body></html>'),Kinetic.window=Kinetic.document.createWindow(),Kinetic.window.Image=c.Image,Kinetic._nodeCanvas=c}return Kinetic.root=a,void (module.exports=d)}'function'==typeof define&&define.amd&&define(b),Kinetic.document=document,Kinetic.window=window,Kinetic.root=a}(this,function(){return Kinetic}),function(){Kinetic.Collection=function(){var b=[].slice.call(arguments),c=b.length,a=0;for(this.length=c;c>a;a++){this[a]=b[a]}return this},Kinetic.Collection.prototype=[],Kinetic.Collection.prototype.each=function(b){for(var a=0;a<this.length;a++){b(this[a],a)}},Kinetic.Collection.prototype.toArray=function(){var a,b=[],c=this.length;for(a=0;c>a;a++){b.push(this[a])}return b},Kinetic.Collection.toCollection=function(b){var a,c=new Kinetic.Collection(),d=b.length;for(a=0;d>a;a++){c.push(b[a])}return c},Kinetic.Collection._mapMethod=function(a){Kinetic.Collection.prototype[a]=function(){var b,c=this.length,d=[].slice.call(arguments);for(b=0;c>b;b++){this[b][a].apply(this[b],d)}return this}},Kinetic.Collection.mapMethods=function(a){var b=a.prototype;for(var c in b){Kinetic.Collection._mapMethod(c)}},Kinetic.Transform=function(a){this.m=a&&a.slice()||[1,0,0,1,0,0]},Kinetic.Transform.prototype={copy:function(){return new Kinetic.Transform(this.m)},point:function(b){var a=this.m;return {x:a[0]*b.x+a[2]*b.y+a[4],y:a[1]*b.x+a[3]*b.y+a[5]}},translate:function(a,b){return this.m[4]+=this.m[0]*a+this.m[2]*b,this.m[5]+=this.m[1]*a+this.m[3]*b,this},scale:function(a,b){return this.m[0]*=a,this.m[1]*=a,this.m[2]*=b,this.m[3]*=b,this},rotate:function(c){var a=Math.cos(c),b=Math.sin(c),d=this.m[0]*a+this.m[2]*b,e=this.m[1]*a+this.m[3]*b,f=this.m[0]*-b+this.m[2]*a,g=this.m[1]*-b+this.m[3]*a;return this.m[0]=d,this.m[1]=e,this.m[2]=f,this.m[3]=g,this},getTranslation:function(){return {x:this.m[4],y:this.m[5]}},skew:function(a,b){var c=this.m[0]+this.m[2]*b,d=this.m[1]+this.m[3]*b,e=this.m[2]+this.m[0]*a,f=this.m[3]+this.m[1]*a;return this.m[0]=c,this.m[1]=d,this.m[2]=e,this.m[3]=f,this},multiply:function(a){var b=this.m[0]*a.m[0]+this.m[2]*a.m[1],c=this.m[1]*a.m[0]+this.m[3]*a.m[1],d=this.m[0]*a.m[2]+this.m[2]*a.m[3],e=this.m[1]*a.m[2]+this.m[3]*a.m[3],f=this.m[0]*a.m[4]+this.m[2]*a.m[5]+this.m[4],g=this.m[1]*a.m[4]+this.m[3]*a.m[5]+this.m[5];return this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g,this},invert:function(){var a=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),b=this.m[3]*a,c=-this.m[1]*a,d=-this.m[2]*a,e=this.m[0]*a,f=a*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),g=a*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=b,this.m[1]=c,this.m[2]=d,this.m[3]=e,this.m[4]=f,this.m[5]=g,this},getMatrix:function(){return this.m},setAbsolutePosition:function(b,g){var a=this.m[0],c=this.m[1],d=this.m[2],h=this.m[3],e=this.m[4],i=this.m[5],f=(a*(g-i)-c*(b-e))/(a*h-c*d),j=(b-e-d*f)/a;return this.translate(j,f)}};var d='2d',e='[object Array]',f='[object Number]',g='[object String]',h=Math.PI/180,i=180/Math.PI,a='#',b='',j='0',k='Kinetic warning: ',l='Kinetic error: ',m='rgb(',c={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},n=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/;Kinetic.Util={_isElement:function(a){return !(!a||1!=a.nodeType)},_isFunction:function(a){return !!(a&&a.constructor&&a.call&&a.apply)},_isObject:function(a){return !!a&&a.constructor==Object},_isArray:function(a){return Object.prototype.toString.call(a)==e},_isNumber:function(a){return Object.prototype.toString.call(a)==f},_isString:function(a){return Object.prototype.toString.call(a)==g},_throttle:function(g,h,i){var a,b,e,c=null,d=0,f=i||{},j=function(){d=f.leading===!1?0:(new Date()).getTime(),c=null,e=g.apply(a,b),a=b=null};return function(){var k=(new Date()).getTime();d||f.leading!==!1||(d=k);var l=h-(k-d);return a=this,b=arguments,0>=l?(clearTimeout(c),c=null,d=k,e=g.apply(a,b),a=b=null):c||f.trailing===!1||(c=setTimeout(j,l)),e}},_hasMethods:function(b){var a,c=[];for(a in b){this._isFunction(b[a])&&c.push(a)}return c.length>0},createCanvasElement:function(){var a=Kinetic.document.createElement('canvas');try{a.style=a.style||{}}catch(o){}return a},isBrowser:function(){return 'object'!=typeof exports},_isInDocument:function(a){for(;a=a.parentNode;){if(a==Kinetic.document){return !0}}return !1},_simplifyArray:function(c){var b,a,d=[],f=c.length,e=Kinetic.Util;for(b=0;f>b;b++){a=c[b],e._isNumber(a)?a=Math.round(1000*a)/1000:e._isString(a)||(a=a.toString()),d.push(a)}return d},_getImage:function(a,b){var e,c;if(a){if(this._isElement(a)){b(a)}else {if(this._isString(a)){e=new Kinetic.window.Image(),e.onload=function(){b(e)},e.src=a}else {if(a.data){c=Kinetic.Util.createCanvasElement(),c.width=a.width,c.height=a.height;var f=c.getContext(d);f.putImageData(a,0,0),this._getImage(c.toDataURL(),b)}else {b(null)}}}}else {b(null)}},_getRGBAString:function(a){var c=a.red||0,d=a.green||0,e=a.blue||0,f=a.alpha||1;return ['rgba(',c,',',d,',',e,',',f,')'].join(b)},_rgbToHex:function(a,b,c){return ((1<<24)+(a<<16)+(b<<8)+c).toString(16).slice(1)},_hexToRgb:function(c){c=c.replace(a,b);var d=parseInt(c,16);return {r:d>>16&255,g:d>>8&255,b:255&d}},getRandomColor:function(){for(var b=(16777215*Math.random()<<0).toString(16);b.length<6;){b=j+b}return a+b},get:function(a,b){return void 0===a?b:a},getRGB:function(d){var b;return d in c?(b=c[d],{r:b[0],g:b[1],b:b[2]}):d[0]===a?this._hexToRgb(d.substring(1)):d.substr(0,4)===m?(b=n.exec(d.replace(/ /g,'')),{r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10)}):{r:0,g:0,b:0}},_merge:function(b,d){var c=this._clone(d);for(var a in b){c[a]=this._isObject(b[a])?this._merge(b[a],c[a]):b[a]}return c},cloneObject:function(a){var c={};for(var b in a){c[b]=this._isObject(a[b])?this.cloneObject(a[b]):this._isArray(a[b])?this.cloneArray(a[b]):a[b]}return c},cloneArray:function(a){return a.slice(0)},_degToRad:function(a){return a*h},_radToDeg:function(a){return a*i},_capitalize:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},error:function(a){throw new Error(l+a)},warn:function(a){Kinetic.root.console&&console.warn&&Kinetic.showWarnings&&console.warn(k+a)},extend:function(a,e){function c(){this.constructor=a}c.prototype=e.prototype;var b=a.prototype;a.prototype=new c();for(var d in b){b.hasOwnProperty(d)&&(a.prototype[d]=b[d])}a.__super__=e.prototype},addMethods:function(c,b){var a;for(a in b){c.prototype[a]=b[a]}},_getControlPoints:function(c,d,a,b,e,f,i){var g=Math.sqrt(Math.pow(a-c,2)+Math.pow(b-d,2)),h=Math.sqrt(Math.pow(e-a,2)+Math.pow(f-b,2)),j=i*g/(g+h),k=i*h/(g+h),l=a-j*(e-c),m=b-j*(f-d),n=a+k*(e-c),o=b+k*(f-d);return [l,m,n,o]},_expandPoints:function(b,e){var a,d,f=b.length,c=[];for(a=2;f-2>a;a+=2){d=Kinetic.Util._getControlPoints(b[a-2],b[a-1],b[a],b[a+1],b[a+2],b[a+3],e),c.push(d[0]),c.push(d[1]),c.push(b[a]),c.push(b[a+1]),c.push(d[2]),c.push(d[3])}return c},_removeLastLetter:function(a){return a.substring(0,a.length-1)}}}(),function(){var b=Kinetic.Util.createCanvasElement(),a=b.getContext('2d'),c=Kinetic.UA.mobile?function(){var b=window.devicePixelRatio||1,c=a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return b/c}():1;Kinetic.Canvas=function(a){this.init(a)},Kinetic.Canvas.prototype={init:function(a){var b=a||{},d=b.pixelRatio||Kinetic.pixelRatio||c;this.pixelRatio=d,this._canvas=Kinetic.Util.createCanvasElement(),this._canvas.style.padding=0,this._canvas.style.margin=0,this._canvas.style.border=0,this._canvas.style.background='transparent',this._canvas.style.position='absolute',this._canvas.style.top=0,this._canvas.style.left=0},getContext:function(){return this.context},getPixelRatio:function(){return this.pixelRatio},setPixelRatio:function(a){this.pixelRatio=a,this.setSize(this.getWidth(),this.getHeight())},setWidth:function(a){this.width=this._canvas.width=a*this.pixelRatio,this._canvas.style.width=a+'px'},setHeight:function(a){this.height=this._canvas.height=a*this.pixelRatio,this._canvas.style.height=a+'px'},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(a,b){this.setWidth(a),this.setHeight(b)},toDataURL:function(a,b){try{return this._canvas.toDataURL(a,b)}catch(d){try{return this._canvas.toDataURL()}catch(e){return Kinetic.Util.warn('Unable to get data URL. '+e.message),''}}}},Kinetic.SceneCanvas=function(b){var a=b||{},c=a.width||0,d=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.SceneContext(this),this.setSize(c,d)},Kinetic.SceneCanvas.prototype={setWidth:function(b){var a=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setWidth.call(this,b),c.scale(a,a)},setHeight:function(b){var a=this.pixelRatio,c=this.getContext()._context;Kinetic.Canvas.prototype.setHeight.call(this,b),c.scale(a,a)}},Kinetic.Util.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(b){var a=b||{},c=a.width||0,d=a.height||0;Kinetic.Canvas.call(this,a),this.context=new Kinetic.HitContext(this),this.setSize(c,d),this.hitCanvas=!0},Kinetic.Util.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),function(){var a=',',c='(',d=')',e='([',f='])',g=';',h='()',i='=',b=['arc','arcTo','beginPath','bezierCurveTo','clearRect','clip','closePath','createLinearGradient','createPattern','createRadialGradient','drawImage','fill','fillText','getImageData','createImageData','lineTo','moveTo','putImageData','quadraticCurveTo','rect','restore','rotate','save','scale','setLineDash','setTransform','stroke','strokeText','transform','translate'];Kinetic.Context=function(a){this.init(a)},Kinetic.Context.prototype={init:function(a){this.canvas=a,this._context=a._canvas.getContext('2d'),Kinetic.enableTrace&&(this.traceArr=[],this._enableTrace())},fillShape:function(a){a.getFillEnabled()&&this._fill(a)},strokeShape:function(a){a.getStrokeEnabled()&&this._stroke(a)},fillStrokeShape:function(a){var b=a.getFillEnabled();b&&this._fill(a),a.getStrokeEnabled()&&this._stroke(a)},getTrace:function(n){var k,j,m,l,o=this.traceArr,p=o.length,b='';for(k=0;p>k;k++){j=o[k],m=j.method,m?(l=j.args,b+=m,b+=n?h:Kinetic.Util._isArray(l[0])?e+l.join(a)+f:c+l.join(a)+d):(b+=j.property,n||(b+=i+j.val)),b+=g}return b},clearTrace:function(){this.traceArr=[]},_trace:function(c){var b,a=this.traceArr;a.push(c),b=a.length,b>=Kinetic.traceArrMax&&a.shift()},reset:function(){var a=this.getCanvas().getPixelRatio();this.setTransform(1*a,0,0,1*a,0,0)},getCanvas:function(){return this.canvas},clear:function(a){var b=this.getCanvas();a?this.clearRect(a.x||0,a.y||0,a.width||0,a.height||0):this.clearRect(0,0,b.getWidth(),b.getHeight())},_applyLineCap:function(b){var a=b.getLineCap();a&&this.setAttr('lineCap',a)},_applyOpacity:function(b){var a=b.getAbsoluteOpacity();1!==a&&this.setAttr('globalAlpha',a)},_applyLineJoin:function(b){var a=b.getLineJoin();a&&this.setAttr('lineJoin',a)},setAttr:function(a,b){this._context[a]=b},arc:function(){var a=arguments;this._context.arc(a[0],a[1],a[2],a[3],a[4],a[5])},beginPath:function(){this._context.beginPath()},bezierCurveTo:function(){var a=arguments;this._context.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5])},clearRect:function(){var a=arguments;this._context.clearRect(a[0],a[1],a[2],a[3])},clip:function(){this._context.clip()},closePath:function(){this._context.closePath()},createImageData:function(){var a=arguments;return 2===a.length?this._context.createImageData(a[0],a[1]):1===a.length?this._context.createImageData(a[0]):void 0},createLinearGradient:function(){var a=arguments;return this._context.createLinearGradient(a[0],a[1],a[2],a[3])},createPattern:function(){var a=arguments;return this._context.createPattern(a[0],a[1])},createRadialGradient:function(){var a=arguments;return this._context.createRadialGradient(a[0],a[1],a[2],a[3],a[4],a[5])},drawImage:function(){var a=arguments,b=this._context;3===a.length?b.drawImage(a[0],a[1],a[2]):5===a.length?b.drawImage(a[0],a[1],a[2],a[3],a[4]):9===a.length&&b.drawImage(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])},fill:function(){this._context.fill()},fillText:function(){var a=arguments;this._context.fillText(a[0],a[1],a[2])},getImageData:function(){var a=arguments;return this._context.getImageData(a[0],a[1],a[2],a[3])},lineTo:function(){var a=arguments;this._context.lineTo(a[0],a[1])},moveTo:function(){var a=arguments;this._context.moveTo(a[0],a[1])},rect:function(){var a=arguments;this._context.rect(a[0],a[1],a[2],a[3])},putImageData:function(){var a=arguments;this._context.putImageData(a[0],a[1],a[2])},quadraticCurveTo:function(){var a=arguments;this._context.quadraticCurveTo(a[0],a[1],a[2],a[3])},restore:function(){this._context.restore()},rotate:function(){var a=arguments;this._context.rotate(a[0])},save:function(){this._context.save()},scale:function(){var a=arguments;this._context.scale(a[0],a[1])},setLineDash:function(){var b=arguments,a=this._context;this._context.setLineDash?a.setLineDash(b[0]):'mozDash' in a?a.mozDash=b[0]:'webkitLineDash' in a&&(a.webkitLineDash=b[0])},setTransform:function(){var a=arguments;this._context.setTransform(a[0],a[1],a[2],a[3],a[4],a[5])},stroke:function(){this._context.stroke()},strokeText:function(){var a=arguments;this._context.strokeText(a[0],a[1],a[2])},transform:function(){var a=arguments;this._context.transform(a[0],a[1],a[2],a[3],a[4],a[5])},translate:function(){var a=arguments;this._context.translate(a[0],a[1])},_enableTrace:function(){var c,d,a=this,e=b.length,f=Kinetic.Util._simplifyArray,g=this.setAttr,h=function(b){var c,e=a[b];a[b]=function(){return d=f(Array.prototype.slice.call(arguments,0)),c=e.apply(a,arguments),a._trace({method:b,args:d}),c}};for(c=0;e>c;c++){h(b[c])}a.setAttr=function(){g.apply(a,arguments),a._trace({property:arguments[0],val:arguments[1]})}}},Kinetic.SceneContext=function(a){Kinetic.Context.call(this,a)},Kinetic.SceneContext.prototype={_fillColor:function(a){var b=a.fill()||Kinetic.Util._getRGBAString({red:a.fillRed(),green:a.fillGreen(),blue:a.fillBlue(),alpha:a.fillAlpha()});this.setAttr('fillStyle',b),a._fillFunc(this)},_fillPattern:function(a){var g=a.getFillPatternImage(),d=a.getFillPatternX(),e=a.getFillPatternY(),b=a.getFillPatternScale(),f=Kinetic.getAngle(a.getFillPatternRotation()),c=a.getFillPatternOffset(),h=a.getFillPatternRepeat();(d||e)&&this.translate(d||0,e||0),f&&this.rotate(f),b&&this.scale(b.x,b.y),c&&this.translate(-1*c.x,-1*c.y),this.setAttr('fillStyle',this.createPattern(g,h||'repeat')),this.fill()},_fillLinearGradient:function(c){var d=c.getFillLinearGradientStartPoint(),e=c.getFillLinearGradientEndPoint(),a=c.getFillLinearGradientColorStops(),f=this.createLinearGradient(d.x,d.y,e.x,e.y);if(a){for(var b=0;b<a.length;b+=2){f.addColorStop(a[b],a[b+1])}this.setAttr('fillStyle',f),this.fill()}},_fillRadialGradient:function(a){for(var d=a.getFillRadialGradientStartPoint(),e=a.getFillRadialGradientEndPoint(),g=a.getFillRadialGradientStartRadius(),h=a.getFillRadialGradientEndRadius(),c=a.getFillRadialGradientColorStops(),f=this.createRadialGradient(d.x,d.y,g,e.x,e.y,h),b=0;b<c.length;b+=2){f.addColorStop(c[b],c[b+1])}this.setAttr('fillStyle',f),this.fill()},_fill:function(a){var c=a.fill()||a.fillRed()||a.fillGreen()||a.fillBlue(),d=a.getFillPatternImage(),e=a.getFillLinearGradientColorStops(),f=a.getFillRadialGradientColorStops(),b=a.getFillPriority();c&&'color'===b?this._fillColor(a):d&&'pattern'===b?this._fillPattern(a):e&&'linear-gradient'===b?this._fillLinearGradient(a):f&&'radial-gradient'===b?this._fillRadialGradient(a):c?this._fillColor(a):d?this._fillPattern(a):e?this._fillLinearGradient(a):f&&this._fillRadialGradient(a)},_stroke:function(a){var b=a.dash(),c=a.getStrokeScaleEnabled();a.hasStroke()&&(c||(this.save(),this.setTransform(1,0,0,1,0,0)),this._applyLineCap(a),b&&a.dashEnabled()&&this.setLineDash(b),this.setAttr('lineWidth',a.strokeWidth()),this.setAttr('strokeStyle',a.stroke()||Kinetic.Util._getRGBAString({red:a.strokeRed(),green:a.strokeGreen(),blue:a.strokeBlue(),alpha:a.strokeAlpha()})),a._strokeFunc(this),c||this.restore())},_applyShadow:function(a){var b=Kinetic.Util,e=a.getAbsoluteOpacity(),f=b.get(a.getShadowColor(),'black'),g=b.get(a.getShadowBlur(),5),c=b.get(a.getShadowOpacity(),1),d=b.get(a.getShadowOffset(),{x:0,y:0});c&&this.setAttr('globalAlpha',c*e),this.setAttr('shadowColor',f),this.setAttr('shadowBlur',g),this.setAttr('shadowOffsetX',d.x),this.setAttr('shadowOffsetY',d.y)}},Kinetic.Util.extend(Kinetic.SceneContext,Kinetic.Context),Kinetic.HitContext=function(a){Kinetic.Context.call(this,a)},Kinetic.HitContext.prototype={_fill:function(a){this.save(),this.setAttr('fillStyle',a.colorKey),a._fillFuncHit(this),this.restore()},_stroke:function(a){a.hasStroke()&&(this._applyLineCap(a),this.setAttr('lineWidth',a.strokeWidth()),this.setAttr('strokeStyle',a.colorKey),a._strokeFuncHit(this))}},Kinetic.Util.extend(Kinetic.HitContext,Kinetic.Context)}(),function(){var a='get',b='set';Kinetic.Factory={addGetterSetter:function(a,b,c,d,e){this.addGetter(a,b,c),this.addSetter(a,b,d,e),this.addOverloadedGetterSetter(a,b)},addGetter:function(c,b,d){var e=a+Kinetic.Util._capitalize(b);c.prototype[e]=function(){var a=this.attrs[b];return void 0===a?d:a}},addSetter:function(e,a,c,d){var f=b+Kinetic.Util._capitalize(a);e.prototype[f]=function(b){return c&&(b=c.call(this,b)),this._setAttr(a,b),d&&d.call(this),this}},addComponentsGetterSetter:function(f,c,h,i,j){var d,g,k=h.length,e=Kinetic.Util._capitalize,l=a+e(c),m=b+e(c);f.prototype[l]=function(){var a={};for(d=0;k>d;d++){g=h[d],a[g]=this.getAttr(c+e(g))}return a},f.prototype[m]=function(a){var b,d=this.attrs[c];i&&(a=i.call(this,a));for(b in a){this._setAttr(c+e(b),a[b])}return this._fireChangeEvent(c,d,a),j&&j.call(this),this},this.addOverloadedGetterSetter(f,c)},addOverloadedGetterSetter:function(e,c){var d=Kinetic.Util._capitalize(c),f=b+d,g=a+d;e.prototype[c]=function(){return arguments.length?(this[f](arguments[0]),this):this[g]()}},backCompat:function(b,c){var a;for(a in c){b.prototype[a]=b.prototype[c[a]]}},afterSetFilter:function(){this._filterUpToDate=!1}},Kinetic.Validators={RGBComponent:function(a){return a>255?255:0>a?0:Math.round(a)},alphaComponent:function(a){return a>1?1:1.0E-4>a?1.0E-4:a}}}(),function(){var c='absoluteOpacity',a='absoluteTransform',n='Change',o='children',g='.',p='',q='get',r='id',s='kinetic',d='listening',h='mouseenter',i='mouseleave',t='name',j='set',k='Shape',e=' ',l='stage',b='transform',u='Stage',f='visible',m=['id'],v=['xChange.kinetic','yChange.kinetic','scaleXChange.kinetic','scaleYChange.kinetic','skewXChange.kinetic','skewYChange.kinetic','rotationChange.kinetic','offsetXChange.kinetic','offsetYChange.kinetic','transformsEnabledChange.kinetic'].join(e);Kinetic.Util.addMethods(Kinetic.Node,{_init:function(g){var e=this;this._id=Kinetic.idCounter++,this.eventListeners={},this.attrs={},this._cache={},this._filterUpToDate=!1,this.setAttrs(g),this.on(v,function(){this._clearCache(b),e._clearSelfAndDescendantCache(a)}),this.on('visibleChange.kinetic',function(){e._clearSelfAndDescendantCache(f)}),this.on('listeningChange.kinetic',function(){e._clearSelfAndDescendantCache(d)}),this.on('opacityChange.kinetic',function(){e._clearSelfAndDescendantCache(c)})},_clearCache:function(a){a?delete this._cache[a]:this._cache={}},_getCache:function(a,b){var c=this._cache[a];return void 0===c&&(this._cache[a]=b.call(this)),this._cache[a]},_clearSelfAndDescendantCache:function(a){this._clearCache(a),this.children&&this.getChildren().each(function(b){b._clearSelfAndDescendantCache(a)})},clearCache:function(){return delete this._cache.canvas,this._filterUpToDate=!1,this},cache:function(j){var b=j||{},h=b.x||0,i=b.y||0,c=b.width||this.width(),d=b.height||this.height(),k=b.drawBorder||!1;if(0===c||0===d){return void Kinetic.Util.warn('Width or height of caching configuration equals 0. Cache is ignored.')}var g=new Kinetic.SceneCanvas({pixelRatio:1,width:c,height:d}),l=new Kinetic.SceneCanvas({pixelRatio:1,width:c,height:d}),e=new Kinetic.HitCanvas({width:c,height:d}),a=g.getContext(),f=e.getContext();return e.isCache=!0,this.clearCache(),a.save(),f.save(),k&&(a.save(),a.beginPath(),a.rect(0,0,c,d),a.closePath(),a.setAttr('strokeStyle','red'),a.setAttr('lineWidth',5),a.stroke(),a.restore()),a.translate(-1*h,-1*i),f.translate(-1*h,-1*i),'Shape'===this.nodeType&&(a.translate(-1*this.x(),-1*this.y()),f.translate(-1*this.x(),-1*this.y())),this.drawScene(g,this),this.drawHit(e,this),a.restore(),f.restore(),this._cache.canvas={scene:g,filter:l,hit:e},this},_drawCachedSceneCanvas:function(a){a.save(),this.getLayer()._applyTransform(this,a),a._applyOpacity(this),a.drawImage(this._getCachedSceneCanvas()._canvas,0,0),a.restore()},_getCachedSceneCanvas:function(){var f,d,a,g,e=this.filters(),h=this._cache.canvas,i=h.scene,b=h.filter,c=b.getContext();if(e){if(!this._filterUpToDate){try{for(f=e.length,c.clear(),c.drawImage(i._canvas,0,0),d=c.getImageData(0,0,b.getWidth(),b.getHeight()),a=0;f>a;a++){g=e[a],g.call(this,d),c.putImageData(d,0,0)}}catch(w){Kinetic.Util.warn('Unable to apply filter. '+w.message)}this._filterUpToDate=!0}return b}return i},_drawCachedHitCanvas:function(a){var b=this._cache.canvas,c=b.hit;a.save(),this.getLayer()._applyTransform(this,a),a.drawImage(c._canvas,0,0),a.restore()},on:function(i,j){var a,d,c,b,f,h=i.split(e),k=h.length;for(a=0;k>a;a++){d=h[a],c=d.split(g),b=c[0],f=c[1]||p,this.eventListeners[b]||(this.eventListeners[b]=[]),this.eventListeners[b].push({name:f,handler:j})}return this},off:function(h){var a,b,i,d,c,f,j=(h||'').split(e),k=j.length;if(!h){for(b in this.eventListeners){this._off(b)}}for(a=0;k>a;a++){if(i=j[a],d=i.split(g),c=d[0],f=d[1],c){this.eventListeners[c]&&this._off(c,f)}else {for(b in this.eventListeners){this._off(b,f)}}}return this},dispatchEvent:function(a){var b={target:this,type:a.type,evt:a};this.fire(a.type,b)},addEventListener:function(a,b){this.on(a,function(c){b.call(this,c.evt)})},removeEventListener:function(a){this.off(a)},remove:function(){var b=this.getParent();return b&&b.children&&(b.children.splice(this.index,1),b._setChildrenIndices(),delete this.parent),this._clearSelfAndDescendantCache(l),this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(f),this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(c),this},destroy:function(){Kinetic._removeId(this.getId()),Kinetic._removeName(this.getName(),this._id),this.remove()},getAttr:function(a){var b=q+Kinetic.Util._capitalize(a);return Kinetic.Util._isFunction(this[b])?this[b]():this.attrs[a]},getAncestors:function(){for(var a=this.getParent(),b=new Kinetic.Collection();a;){b.push(a),a=a.getParent()}return b},getAttrs:function(){return this.attrs||{}},setAttrs:function(b){var a,c;if(b){for(a in b){a===o||b[a] instanceof Kinetic.Node||(c=j+Kinetic.Util._capitalize(a),Kinetic.Util._isFunction(this[c])?this[c](b[a]):this._setAttr(a,b[a]))}}return this},isListening:function(){return this._getCache(d,this._isListening)},_isListening:function(){var a=this.getListening(),b=this.getParent();return 'inherit'===a?!b||b.isListening():a},isVisible:function(){return this._getCache(f,this._isVisible)},_isVisible:function(){var a=this.getVisible(),b=this.getParent();return 'inherit'===a?!b||b.isVisible():a},shouldDrawHit:function(a){var b=this.getLayer();return a&&a.isCache||b&&b.hitGraphEnabled()&&this.isListening()&&this.isVisible()},show:function(){return this.setVisible(!0),this},hide:function(){return this.setVisible(!1),this},getZIndex:function(){return this.index||0},getAbsoluteZIndex:function(){function a(i){for(b=[],e=i.length,c=0;e>c;c++){d=i[c],g++,d.nodeType!==k&&(b=b.concat(d.getChildren().toArray())),d._id===f._id&&(c=e)}b.length>0&&b[0].getDepth()<=h&&a(b)}var b,e,c,d,h=this.getDepth(),f=this,g=0;return f.nodeType!==u&&a(f.getStage().getChildren()),g},getDepth:function(){for(var b=0,a=this.parent;a;){b++,a=a.parent}return b},setPosition:function(a){return this.setX(a.x),this.setY(a.y),this},getPosition:function(){return {x:this.getX(),y:this.getY()}},getAbsolutePosition:function(){var c=this.getAbsoluteTransform().getMatrix(),a=new Kinetic.Transform(),b=this.offset();return a.m=c.slice(),a.translate(b.x,b.y),a.getTranslation()},setAbsolutePosition:function(a){var b,c=this._clearTransform();return this.attrs.x=c.x,this.attrs.y=c.y,delete c.x,delete c.y,b=this.getAbsoluteTransform(),b.invert(),b.translate(a.x,a.y),a={x:this.attrs.x+b.getTranslation().x,y:this.attrs.y+b.getTranslation().y},this.setPosition({x:a.x,y:a.y}),this._setTransform(c),this},_setTransform:function(d){var c;for(c in d){this.attrs[c]=d[c]}this._clearCache(b),this._clearSelfAndDescendantCache(a)},_clearTransform:function(){var c={x:this.getX(),y:this.getY(),rotation:this.getRotation(),scaleX:this.getScaleX(),scaleY:this.getScaleY(),offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),skewX:this.getSkewX(),skewY:this.getSkewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,this._clearCache(b),this._clearSelfAndDescendantCache(a),c},move:function(a){var b=a.x,c=a.y,d=this.getX(),e=this.getY();return void 0!==b&&(d+=b),void 0!==c&&(e+=c),this.setPosition({x:d,y:e}),this},_eachAncestorReverse:function(e,b){var f,c,d=[],a=this.getParent();if(b&&b._id===this._id){return e(this),!0}for(d.unshift(this);a&&(!b||a._id!==b._id);){d.unshift(a),a=a.parent}for(f=d.length,c=0;f>c;c++){e(d[c])}},rotate:function(a){return this.setRotation(this.getRotation()+a),this},moveToTop:function(){if(!this.parent){return void Kinetic.Util.warn('Node has no parent. moveToTop function is ignored.')}var a=this.index;return this.parent.children.splice(a,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){if(!this.parent){return void Kinetic.Util.warn('Node has no parent. moveUp function is ignored.')}var a=this.index,b=this.parent.getChildren().length;return b-1>a&&(this.parent.children.splice(a,1),this.parent.children.splice(a+1,0,this),this.parent._setChildrenIndices(),!0)},moveDown:function(){if(!this.parent){return void Kinetic.Util.warn('Node has no parent. moveDown function is ignored.')}var a=this.index;return a>0&&(this.parent.children.splice(a,1),this.parent.children.splice(a-1,0,this),this.parent._setChildrenIndices(),!0)},moveToBottom:function(){if(!this.parent){return void Kinetic.Util.warn('Node has no parent. moveToBottom function is ignored.')}var a=this.index;return a>0&&(this.parent.children.splice(a,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0)},setZIndex:function(a){if(!this.parent){return void Kinetic.Util.warn('Node has no parent. zIndex parameter is ignored.')}var b=this.index;return this.parent.children.splice(b,1),this.parent.children.splice(a,0,this),this.parent._setChildrenIndices(),this},getAbsoluteOpacity:function(){return this._getCache(c,this._getAbsoluteOpacity)},_getAbsoluteOpacity:function(){var a=this.getOpacity();return this.getParent()&&(a*=this.getParent().getAbsoluteOpacity()),a},moveTo:function(a){return this.getParent()!==a&&(this.remove(),a.add(this)),this},toObject:function(){var b,a,f,g,c=Kinetic.Util,d={},e=this.getAttrs();d.attrs={};for(b in e){a=e[b],c._isFunction(a)||c._isElement(a)||c._isObject(a)&&c._hasMethods(a)||(f=this[b],delete e[b],g=f?f.call(this):null,e[b]=a,g!==a&&(d.attrs[b]=a))}return d.className=this.getClassName(),d},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){var a=this.getParent();return a?a.getLayer():null},getStage:function(){return this._getCache(l,this._getStage)},_getStage:function(){var a=this.getParent();return a?a.getStage():void 0},fire:function(a,b,c){return c?this._fireAndBubble(a,b||{}):this._fire(a,b||{}),this},getAbsoluteTransform:function(b){return b?this._getAbsoluteTransform(b):this._getCache(a,this._getAbsoluteTransform)},_getAbsoluteTransform:function(d){var a,c,b=new Kinetic.Transform();return this._eachAncestorReverse(function(e){a=e.transformsEnabled(),c=e.getTransform(),'all'===a?b.multiply(c):'position'===a&&b.translate(e.x(),e.y())},d),b},getTransform:function(){return this._getCache(b,this._getTransform)},_getTransform:function(){var a=new Kinetic.Transform(),b=this.getX(),c=this.getY(),d=Kinetic.getAngle(this.getRotation()),e=this.getScaleX(),f=this.getScaleY(),g=this.getSkewX(),h=this.getSkewY(),i=this.getOffsetX(),j=this.getOffsetY();return (0!==b||0!==c)&&a.translate(b,c),0!==d&&a.rotate(d),(0!==g||0!==h)&&a.skew(g,h),(1!==e||1!==f)&&a.scale(e,f),(0!==i||0!==j)&&a.translate(-1*i,-1*j),a},clone:function(g){var a,d,h,b,e,i=this.getClassName(),f=Kinetic.Util.cloneObject(this.attrs);for(var j in m){var k=m[j];delete f[k]}for(a in g){f[a]=g[a]}var c=new Kinetic[i](f);for(a in this.eventListeners){for(d=this.eventListeners[a],h=d.length,b=0;h>b;b++){e=d[b],e.name.indexOf(s)<0&&(c.eventListeners[a]||(c.eventListeners[a]=[]),c.eventListeners[a].push(e))}}return c},toDataURL:function(a){a=a||{};var g=a.mimeType||null,h=a.quality||null,b=this.getStage(),e=a.x||0,f=a.y||0,c=new Kinetic.SceneCanvas({width:a.width||this.getWidth()||(b?b.getWidth():0),height:a.height||this.getHeight()||(b?b.getHeight():0),pixelRatio:1}),d=c.getContext();return d.save(),(e||f)&&d.translate(-1*e,-1*f),this.drawScene(c),d.restore(),c.toDataURL(g,h)},toImage:function(a){Kinetic.Util._getImage(this.toDataURL(a),function(b){a.callback(b)})},setSize:function(a){return this.setWidth(a.width),this.setHeight(a.height),this},getSize:function(){return {width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},getClassName:function(){return this.className||this.nodeType},getType:function(){return this.nodeType},getDragDistance:function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Kinetic.dragDistance},_get:function(a){return this.className===a||this.nodeType===a?[this]:[]},_off:function(e,c){var a,d,b=this.eventListeners[e];for(a=0;a<b.length;a++){if(d=b[a].name,!('kinetic'===d&&'kinetic'!==c||c&&d!==c)){if(b.splice(a,1),0===b.length){delete this.eventListeners[e];break}a--}}},_fireChangeEvent:function(a,b,c){this._fire(a+n,{oldVal:b,newVal:c})},setId:function(a){var b=this.getId();return Kinetic._removeId(b),Kinetic._addId(this,a),this._setAttr(r,a),this},setName:function(a){var b=this.getName();return Kinetic._removeName(b,this._id),Kinetic._addName(this,a),this._setAttr(t,a),this},setAttr:function(a,b){var d=j+Kinetic.Util._capitalize(a),c=this[d];return Kinetic.Util._isFunction(c)?c.call(this,b):this._setAttr(a,b),this},_setAttr:function(a,b){var c;void 0!==b&&(c=this.attrs[a],this.attrs[a]=b,this._fireChangeEvent(a,c,b))},_setComponentAttr:function(a,d,b){var c;void 0!==b&&(c=this.attrs[a],c||(this.attrs[a]=this.getAttr(a)),this.attrs[a][d]=b,this._fireChangeEvent(a,c,b))},_fireAndBubble:function(b,c,a){var d=!0;if(c&&this.nodeType===k&&(c.target=this),b===h&&a&&(this._id===a._id||this.isAncestorOf&&this.isAncestorOf(a))?d=!1:b===i&&a&&(this._id===a._id||this.isAncestorOf&&this.isAncestorOf(a))&&(d=!1),d){this._fire(b,c);var e=(b===h||b===i)&&(a&&a.isAncestorOf&&a.isAncestorOf(this)||!(!a||!a.isAncestorOf));c&&!c.cancelBubble&&this.parent&&this.parent.isListening()&&!e&&(a&&a.parent?this._fireAndBubble.call(this.parent,b,c,a.parent):this._fireAndBubble.call(this.parent,b,c))}},_fire:function(c,d){var a,b=this.eventListeners[c];if(d.type=c,b){for(a=0;a<b.length;a++){b[a].handler.call(this,d)}}},draw:function(){return this.drawScene(),this.drawHit(),this}}),Kinetic.Node.create=function(a,b){return this._createNode(JSON.parse(a),b)},Kinetic.Node._createNode=function(a,e){var c,f,b,g=Kinetic.Node.prototype.getClassName.call(a),d=a.children;if(e&&(a.attrs.container=e),c=new Kinetic[g](a.attrs),d){for(f=d.length,b=0;f>b;b++){c.add(this._createNode(d[b]))}}return c},Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'position'),Kinetic.Factory.addGetterSetter(Kinetic.Node,'x',0),Kinetic.Factory.addGetterSetter(Kinetic.Node,'y',0),Kinetic.Factory.addGetterSetter(Kinetic.Node,'opacity',1),Kinetic.Factory.addGetter(Kinetic.Node,'name'),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'name'),Kinetic.Factory.addGetter(Kinetic.Node,'id'),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'id'),Kinetic.Factory.addGetterSetter(Kinetic.Node,'rotation',0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,'scale',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Node,'scaleX',1),Kinetic.Factory.addGetterSetter(Kinetic.Node,'scaleY',1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,'skew',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Node,'skewX',0),Kinetic.Factory.addGetterSetter(Kinetic.Node,'skewY',0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Node,'offset',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Node,'offsetX',0),Kinetic.Factory.addGetterSetter(Kinetic.Node,'offsetY',0),Kinetic.Factory.addSetter(Kinetic.Node,'dragDistance'),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'dragDistance'),Kinetic.Factory.addSetter(Kinetic.Node,'width',0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'width'),Kinetic.Factory.addSetter(Kinetic.Node,'height',0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'height'),Kinetic.Factory.addGetterSetter(Kinetic.Node,'listening','inherit'),Kinetic.Factory.addGetterSetter(Kinetic.Node,'filters',void 0,function(a){return this._filterUpToDate=!1,a}),Kinetic.Factory.addGetterSetter(Kinetic.Node,'visible','inherit'),Kinetic.Factory.addGetterSetter(Kinetic.Node,'transformsEnabled','all'),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'size'),Kinetic.Factory.backCompat(Kinetic.Node,{rotateDeg:'rotate',setRotationDeg:'setRotation',getRotationDeg:'getRotation'}),Kinetic.Collection.mapMethods(Kinetic.Node)}(),function(){Kinetic.Filters.Grayscale=function(d){var a,c,b=d.data,e=b.length;for(a=0;e>a;a+=4){c=0.34*b[a]+0.5*b[a+1]+0.16*b[a+2],b[a]=c,b[a+1]=c,b[a+2]=c}}}(),function(){Kinetic.Filters.Brighten=function(d){var a,c=255*this.brightness(),b=d.data,e=b.length;for(a=0;e>a;a+=4){b[a]+=c,b[a+1]+=c,b[a+2]+=c}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'brightness',0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Invert=function(c){var a,b=c.data,d=b.length;for(a=0;d>a;a+=4){b[a]=255-b[a],b[a+1]=255-b[a+1],b[a+2]=255-b[a+2]}}}(),function(){function a(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}function b(O,H){var t,I,j,g,P,h,Q,p,q,r,s,D,E,F,G,u,v,w,x,n,o,l,f,y,b=O.data,z=O.width,L=O.height,R=H+H+1,K=z-1,M=L-1,k=H+1,A=k*(k+1)/2,J=new a(),N=null,e=J,i=null,m=null,B=c[H],C=d[H];for(j=1;R>j;j++){e=e.next=new a(),j==k&&(N=e)}for(e.next=J,Q=h=0,I=0;L>I;I++){for(u=v=w=x=p=q=r=s=0,D=k*(n=b[h]),E=k*(o=b[h+1]),F=k*(l=b[h+2]),G=k*(f=b[h+3]),p+=A*n,q+=A*o,r+=A*l,s+=A*f,e=J,j=0;k>j;j++){e.r=n,e.g=o,e.b=l,e.a=f,e=e.next}for(j=1;k>j;j++){g=h+((j>K?K:j)<<2),p+=(e.r=n=b[g])*(y=k-j),q+=(e.g=o=b[g+1])*y,r+=(e.b=l=b[g+2])*y,s+=(e.a=f=b[g+3])*y,u+=n,v+=o,w+=l,x+=f,e=e.next}for(i=J,m=N,t=0;z>t;t++){b[h+3]=f=s*B>>C,0!==f?(f=255/f,b[h]=(p*B>>C)*f,b[h+1]=(q*B>>C)*f,b[h+2]=(r*B>>C)*f):b[h]=b[h+1]=b[h+2]=0,p-=D,q-=E,r-=F,s-=G,D-=i.r,E-=i.g,F-=i.b,G-=i.a,g=Q+((g=t+H+1)<K?g:K)<<2,u+=i.r=b[g],v+=i.g=b[g+1],w+=i.b=b[g+2],x+=i.a=b[g+3],p+=u,q+=v,r+=w,s+=x,i=i.next,D+=n=m.r,E+=o=m.g,F+=l=m.b,G+=f=m.a,u-=n,v-=o,w-=l,x-=f,m=m.next,h+=4}Q+=z}for(t=0;z>t;t++){for(v=w=x=u=q=r=s=p=0,h=t<<2,D=k*(n=b[h]),E=k*(o=b[h+1]),F=k*(l=b[h+2]),G=k*(f=b[h+3]),p+=A*n,q+=A*o,r+=A*l,s+=A*f,e=J,j=0;k>j;j++){e.r=n,e.g=o,e.b=l,e.a=f,e=e.next}for(P=z,j=1;H>=j;j++){h=P+t<<2,p+=(e.r=n=b[h])*(y=k-j),q+=(e.g=o=b[h+1])*y,r+=(e.b=l=b[h+2])*y,s+=(e.a=f=b[h+3])*y,u+=n,v+=o,w+=l,x+=f,e=e.next,M>j&&(P+=z)}for(h=t,i=J,m=N,I=0;L>I;I++){g=h<<2,b[g+3]=f=s*B>>C,f>0?(f=255/f,b[g]=(p*B>>C)*f,b[g+1]=(q*B>>C)*f,b[g+2]=(r*B>>C)*f):b[g]=b[g+1]=b[g+2]=0,p-=D,q-=E,r-=F,s-=G,D-=i.r,E-=i.g,F-=i.b,G-=i.a,g=t+((g=I+k)<M?g:M)*z<<2,p+=u+=i.r=b[g],q+=v+=i.g=b[g+1],r+=w+=i.b=b[g+2],s+=x+=i.a=b[g+3],i=i.next,D+=n=m.r,E+=o=m.g,F+=l=m.b,G+=f=m.a,u-=n,v-=o,w-=l,x-=f,m=m.next,h+=z}}}var c=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],d=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];Kinetic.Filters.Blur=function(c){var a=Math.round(this.blurRadius());a>0&&b(c,a)},Kinetic.Factory.addGetterSetter(Kinetic.Node,'blurRadius',0,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(a,d,e){var b=4*(e*a.width+d),c=[];return c.push(a.data[b++],a.data[b++],a.data[b++],a.data[b++]),c}function b(a,b){return Math.sqrt(Math.pow(a[0]-b[0],2)+Math.pow(a[1]-b[1],2)+Math.pow(a[2]-b[2],2))}function c(a){for(var b=[0,0,0],c=0;c<a.length;c++){b[0]+=a[c][0],b[1]+=a[c][1],b[2]+=a[c][2]}return b[0]/=a.length,b[1]/=a.length,b[2]/=a.length,b}function d(d,l){var g=a(d,0,0),h=a(d,d.width-1,0),i=a(d,0,d.height-1),j=a(d,d.width-1,d.height-1),f=l||10;if(b(g,h)<f&&b(h,j)<f&&b(j,i)<f&&b(i,g)<f){for(var m=c([h,g,j,i]),k=[],e=0;e<d.width*d.height;e++){var n=b(m,[d.data[4*e],d.data[4*e+1],d.data[4*e+2]]);k[e]=f>n?0:255}return k}}function e(b,c){for(var a=0;a<b.width*b.height;a++){b.data[4*a+3]=c[a]}}function f(n,a,i){for(var j=[1,1,1,1,0,1,1,1,1],b=Math.round(Math.sqrt(j.length)),k=Math.floor(b/2),l=[],c=0;i>c;c++){for(var d=0;a>d;d++){for(var o=c*a+d,m=0,e=0;b>e;e++){for(var f=0;b>f;f++){var g=c+e-k,h=d+f-k;if(g>=0&&i>g&&h>=0&&a>h){var p=g*a+h,q=j[e*b+f];m+=n[p]*q}}}l[o]=2040===m?255:0}}return l}function g(n,a,i){for(var j=[1,1,1,1,1,1,1,1,1],b=Math.round(Math.sqrt(j.length)),k=Math.floor(b/2),l=[],c=0;i>c;c++){for(var d=0;a>d;d++){for(var o=c*a+d,m=0,e=0;b>e;e++){for(var f=0;b>f;f++){var g=c+e-k,h=d+f-k;if(g>=0&&i>g&&h>=0&&a>h){var p=g*a+h,q=j[e*b+f];m+=n[p]*q}}}l[o]=m>=1020?255:0}}return l}function h(n,a,i){for(var j=[1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9,1/9],b=Math.round(Math.sqrt(j.length)),k=Math.floor(b/2),l=[],c=0;i>c;c++){for(var d=0;a>d;d++){for(var o=c*a+d,m=0,e=0;b>e;e++){for(var f=0;b>f;f++){var g=c+e-k,h=d+f-k;if(g>=0&&i>g&&h>=0&&a>h){var p=g*a+h,q=j[e*b+f];m+=n[p]*q}}}l[o]=m}}return l}Kinetic.Filters.Mask=function(a){var c=this.threshold(),b=d(a,c);return b&&(b=f(b,a.width,a.height),b=g(b,a.width,a.height),b=h(b,a.width,a.height),e(a,b)),a},Kinetic.Factory.addGetterSetter(Kinetic.Node,'threshold',0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.RGB=function(d){var a,c,b=d.data,e=b.length,f=this.red(),g=this.green(),h=this.blue();for(a=0;e>a;a+=4){c=(0.34*b[a]+0.5*b[a+1]+0.16*b[a+2])/255,b[a]=c*f,b[a+1]=c*g,b[a+2]=c*h,b[a+3]=b[a+3]}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'red',0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,'green',0,function(a){return this._filterUpToDate=!1,a>255?255:0>a?0:Math.round(a)}),Kinetic.Factory.addGetterSetter(Kinetic.Node,'blue',0,Kinetic.Validators.RGBComponent,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.HSV=function(l){var a,f,g,h,i,c=l.data,m=c.length,b=Math.pow(2,this.value()),j=Math.pow(2,this.saturation()),k=Math.abs(this.hue()+360)%360,d=b*j*Math.cos(k*Math.PI/180),e=b*j*Math.sin(k*Math.PI/180),n=0.299*b+0.701*d+0.167*e,o=0.587*b-0.587*d+0.33*e,p=0.114*b-0.114*d-0.497*e,q=0.299*b-0.299*d-0.328*e,r=0.587*b+0.413*d+0.035*e,s=0.114*b-0.114*d+0.293*e,t=0.299*b-0.3*d+1.25*e,u=0.587*b-0.586*d-1.05*e,v=0.114*b+0.886*d-0.2*e;for(a=0;m>a;a+=4){f=c[a+0],g=c[a+1],h=c[a+2],i=c[a+3],c[a+0]=n*f+o*g+p*h,c[a+1]=q*f+r*g+s*h,c[a+2]=t*f+u*g+v*h,c[a+3]=i}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'hue',0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'saturation',0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'value',0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Factory.addGetterSetter(Kinetic.Node,'hue',0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'saturation',0,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'luminance',0,null,Kinetic.Factory.afterSetFilter),Kinetic.Filters.HSL=function(m){var a,f,g,h,j,c=m.data,n=c.length,b=1,k=Math.pow(2,this.saturation()),l=Math.abs(this.hue()+360)%360,i=127*this.luminance(),d=b*k*Math.cos(l*Math.PI/180),e=b*k*Math.sin(l*Math.PI/180),o=0.299*b+0.701*d+0.167*e,p=0.587*b-0.587*d+0.33*e,q=0.114*b-0.114*d-0.497*e,r=0.299*b-0.299*d-0.328*e,s=0.587*b+0.413*d+0.035*e,t=0.114*b-0.114*d+0.293*e,u=0.299*b-0.3*d+1.25*e,v=0.587*b-0.586*d-1.05*e,w=0.114*b+0.886*d-0.2*e;for(a=0;n>a;a+=4){f=c[a+0],g=c[a+1],h=c[a+2],j=c[a+3],c[a+0]=o*f+p*g+q*h+i,c[a+1]=r*f+s*g+t*h+i,c[a+2]=u*f+v*g+w*h+i,c[a+3]=j}}}(),function(){Kinetic.Filters.Emboss=function(q){var u=10*this.embossStrength(),v=255*this.embossWhiteLevel(),w=this.embossDirection(),x=this.embossBlend(),d=0,e=0,a=q.data,k=q.width,s=q.height,y=4*k,g=s;switch(w){case 'top-left':d=-1,e=-1;break;case 'top':d=-1,e=0;break;case 'top-right':d=-1,e=1;break;case 'right':d=0,e=1;break;case 'bottom-right':d=1,e=1;break;case 'bottom':d=1,e=0;break;case 'bottom-left':d=1,e=-1;break;case 'left':d=0,e=-1;}do{var z=(g-1)*y,h=d;1>g+h&&(h=0),g+h>s&&(h=0);var A=(g-1+h)*k*4,i=k;do{var b=z+4*(i-1),j=e;1>i+j&&(j=0),i+j>k&&(j=0);var r=A+4*(i-1+j),B=a[b]-a[r],l=a[b+1]-a[r+1],m=a[b+2]-a[r+2],c=B,t=c>0?c:-c,C=l>0?l:-l,D=m>0?m:-m;if(C>t&&(c=l),D>t&&(c=m),c*=u,x){var n=a[b]+c,o=a[b+1]+c,p=a[b+2]+c;a[b]=n>255?255:0>n?0:n,a[b+1]=o>255?255:0>o?0:o,a[b+2]=p>255?255:0>p?0:p}else {var f=v-c;0>f?f=0:f>255&&(f=255),a[b]=a[b+1]=a[b+2]=f}}while(--i)}while(--g)},Kinetic.Factory.addGetterSetter(Kinetic.Node,'embossStrength',0.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'embossWhiteLevel',0.5,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'embossDirection','top-left',null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'embossBlend',!1,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(f,d,g,a,h){var b,e=g-d,c=h-a;return 0===e?a+c/2:0===c?a:(b=(f-d)/e,b=c*b+a)}Kinetic.Filters.Enhance=function(x){var k,l,m,b,d=x.data,w=d.length,e=d[0],h=e,f=d[1],i=f,g=d[2],j=g,c=this.enhance();if(0!==c){for(b=0;w>b;b+=4){k=d[b+0],e>k?e=k:k>h&&(h=k),l=d[b+1],f>l?f=l:l>i&&(i=l),m=d[b+2],g>m?g=m:m>j&&(j=m)}h===e&&(h=255,e=0),i===f&&(i=255,f=0),j===g&&(j=255,g=0);var n,o,p,q,r,s,t,u,v;for(c>0?(o=h+c*(255-h),p=e-c*(e-0),r=i+c*(255-i),s=f-c*(f-0),u=j+c*(255-j),v=g-c*(g-0)):(n=0.5*(h+e),o=h+c*(h-n),p=e+c*(e-n),q=0.5*(i+f),r=i+c*(i-q),s=f+c*(f-q),t=0.5*(j+g),u=j+c*(j-t),v=g+c*(g-t)),b=0;w>b;b+=4){d[b+0]=a(d[b+0],e,h,p,o),d[b+1]=a(d[b+1],f,i,s,r),d[b+2]=a(d[b+2],g,j,v,u)}}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'enhance',0,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Posterize=function(d){var a,e=Math.round(254*this.levels())+1,b=d.data,f=b.length,c=255/e;for(a=0;f>a;a+=1){b[a]=Math.floor(b[a]/c)*c}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'levels',0.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Noise=function(d){var a,e=255*this.noise(),c=d.data,f=c.length,b=e/2;for(a=0;f>a;a+=4){c[a+0]+=b-2*b*Math.random(),c[a+1]+=b-2*b*Math.random(),c[a+2]+=b-2*b*Math.random()}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'noise',0.2,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Pixelate=function(a){var b,c,d,h,i,j,o,k,p,l,q,m,n,f,e=Math.ceil(this.pixelSize()),g=a.width,r=a.height,s=Math.ceil(g/e),t=Math.ceil(r/e);for(a=a.data,m=0;s>m;m+=1){for(n=0;t>n;n+=1){for(h=0,i=0,j=0,o=0,k=m*e,p=k+e,l=n*e,q=l+e,f=0,b=k;p>b;b+=1){if(!(b>=g)){for(c=l;q>c;c+=1){c>=r||(d=4*(g*c+b),h+=a[d+0],i+=a[d+1],j+=a[d+2],o+=a[d+3],f+=1)}}}for(h/=f,i/=f,j/=f,b=k;p>b;b+=1){if(!(b>=g)){for(c=l;q>c;c+=1){c>=r||(d=4*(g*c+b),a[d+0]=h,a[d+1]=i,a[d+2]=j,a[d+3]=o)}}}}}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'pixelSize',8,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Threshold=function(c){var a,d=255*this.threshold(),b=c.data,e=b.length;for(a=0;e>a;a+=1){b[a]=b[a]<d?0:255}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'threshold',0.5,null,Kinetic.Factory.afterSetFilter)}(),function(){Kinetic.Filters.Sepia=function(f){var k,g,a,c,d,e,h,i,j,b=f.data,l=f.width,m=f.height,n=4*l;do{k=(m-1)*n,g=l;do{a=k+4*(g-1),c=b[a],d=b[a+1],e=b[a+2],h=0.393*c+0.769*d+0.189*e,i=0.349*c+0.686*d+0.168*e,j=0.272*c+0.534*d+0.131*e,b[a]=h>255?255:h,b[a+1]=i>255?255:i,b[a+2]=j>255?255:j,b[a+3]=b[a+3]}while(--g)}while(--m)}}(),function(){Kinetic.Filters.Solarize=function(f){var a=f.data,g=f.width,j=f.height,k=4*g,h=j;do{var l=(h-1)*k,i=g;do{var b=l+4*(i-1),c=a[b],d=a[b+1],e=a[b+2];c>127&&(c=255-c),d>127&&(d=255-d),e>127&&(e=255-e),a[b]=c,a[b+1]=d,a[b+2]=e}while(--i)}while(--h)}}(),function(){var b=function(l,y,p){var a,d,e,m,h=l.data,i=y.data,f=l.width,n=l.height,j=p.polarCenterX||f/2,k=p.polarCenterY||n/2,q=0,r=0,s=0,t=0,g=Math.sqrt(j*j+k*k);d=f-j,e=n-k,m=Math.sqrt(d*d+e*e),g=m>g?m:g;var b,c,u,v,o=n,w=f,x=360/w*Math.PI/180;for(c=0;w>c;c+=1){for(u=Math.sin(c*x),v=Math.cos(c*x),b=0;o>b;b+=1){d=Math.floor(j+g*b/o*v),e=Math.floor(k+g*b/o*u),a=4*(e*f+d),q=h[a+0],r=h[a+1],s=h[a+2],t=h[a+3],a=4*(c+b*f),i[a+0]=q,i[a+1]=r,i[a+2]=s,i[a+3]=t}}},c=function(n,y,o){var a,b,c,e,f,p,g=n.data,h=y.data,d=n.width,i=n.height,j=o.polarCenterX||d/2,k=o.polarCenterY||i/2,q=0,r=0,s=0,t=0,l=Math.sqrt(j*j+k*k);b=d-j,c=i-k,p=Math.sqrt(b*b+c*c),l=p>l?p:l;var u,m,v,w,z=i,A=d,x=o.polarRotation||0;for(b=0;d>b;b+=1){for(c=0;i>c;c+=1){e=b-j,f=c-k,u=Math.sqrt(e*e+f*f)*z/l,m=(180*Math.atan2(f,e)/Math.PI+360+x)%360,m=m*A/360,v=Math.floor(m),w=Math.floor(u),a=4*(w*d+v),q=g[a+0],r=g[a+1],s=g[a+2],t=g[a+3],a=4*(c*d+b),h[a+0]=q,h[a+1]=r,h[a+2]=s,h[a+3]=t}}},a=Kinetic.Util.createCanvasElement();Kinetic.Filters.Kaleidoscope=function(m){var f,g,t,s,n,o,p,q,h,i,e=m.width,l=m.height,r=Math.round(this.kaleidoscopePower()),y=Math.round(this.kaleidoscopeAngle()),u=Math.floor(e*(y%360)/360);if(!(1>r)){a.width=e,a.height=l;var d=a.getContext('2d').getImageData(0,0,e,l);b(m,d,{polarCenterX:e/2,polarCenterY:l/2});for(var j=e/Math.pow(2,r);8>=j;){j=2*j,r-=1}j=Math.ceil(j);var k=j,v=0,w=k,x=1;for(u+j>e&&(v=k,w=0,x=-1),g=0;l>g;g+=1){for(f=v;f!==w;f+=x){t=Math.round(f+u)%e,h=4*(e*g+t),n=d.data[h+0],o=d.data[h+1],p=d.data[h+2],q=d.data[h+3],i=4*(e*g+f),d.data[i+0]=n,d.data[i+1]=o,d.data[i+2]=p,d.data[i+3]=q}}for(g=0;l>g;g+=1){for(k=Math.floor(j),s=0;r>s;s+=1){for(f=0;k+1>f;f+=1){h=4*(e*g+f),n=d.data[h+0],o=d.data[h+1],p=d.data[h+2],q=d.data[h+3],i=4*(e*g+2*k-f-1),d.data[i+0]=n,d.data[i+1]=o,d.data[i+2]=p,d.data[i+3]=q}k*=2}}c(d,m,{polarRotation:0})}},Kinetic.Factory.addGetterSetter(Kinetic.Node,'kaleidoscopePower',2,null,Kinetic.Factory.afterSetFilter),Kinetic.Factory.addGetterSetter(Kinetic.Node,'kaleidoscopeAngle',0,null,Kinetic.Factory.afterSetFilter)}(),function(){function a(a){setTimeout(a,1000/60)}function b(){return e.apply(Kinetic.root,arguments)}var d=500,c=function(){return Kinetic.root.performance&&Kinetic.root.performance.now?function(){return Kinetic.root.performance.now()}:function(){return (new Date()).getTime()}}(),e=function(){return Kinetic.root.requestAnimationFrame||Kinetic.root.webkitRequestAnimationFrame||Kinetic.root.mozRequestAnimationFrame||Kinetic.root.oRequestAnimationFrame||Kinetic.root.msRequestAnimationFrame||a}();Kinetic.Animation=function(a,b){var d=Kinetic.Animation;this.func=a,this.setLayers(b),this.id=d.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:c()}},Kinetic.Animation.prototype={setLayers:function(a){var b=[];b=a?a.length>0?a:[a]:[],this.layers=b},getLayers:function(){return this.layers},addLayer:function(c){var d,a,b=this.layers;if(b){for(d=b.length,a=0;d>a;a++){if(b[a]._id===c._id){return !1}}}else {this.layers=[]}return this.layers.push(c),!0},isRunning:function(){var a,c=Kinetic.Animation,b=c.animations,d=b.length;for(a=0;d>a;a++){if(b[a].id===this.id){return !0}}return !1},start:function(){var a=Kinetic.Animation;this.stop(),this.frame.timeDiff=0,this.frame.lastTime=c(),a._addAnimation(this)},stop:function(){Kinetic.Animation._removeAnimation(this)},_updateFrameObject:function(a){this.frame.timeDiff=a-this.frame.lastTime,this.frame.lastTime=a,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1000/this.frame.timeDiff}},Kinetic.Animation.animations=[],Kinetic.Animation.animIdCounter=0,Kinetic.Animation.animRunning=!1,Kinetic.Animation._addAnimation=function(a){this.animations.push(a),this._handleAnimation()},Kinetic.Animation._removeAnimation=function(c){var a,d=c.id,b=this.animations,e=b.length;for(a=0;e>a;a++){if(b[a].id===d){this.animations.splice(a,1);break}}},Kinetic.Animation._runFrames=function(){var a,f,g,b,d,i,e,j,l,h={},k=this.animations;for(b=0;b<k.length;b++){if(a=k[b],f=a.layers,g=a.func,a._updateFrameObject(c()),i=f.length,l=!g||g.call(a,a.frame)!==!1){for(d=0;i>d;d++){e=f[d],void 0!==e._id&&(h[e._id]=e)}}}for(j in h){h[j].draw()}},Kinetic.Animation._animationLoop=function(){var a=Kinetic.Animation;a.animations.length?(b(a._animationLoop),a._runFrames()):a.animRunning=!1},Kinetic.Animation._handleAnimation=function(){var a=this;this.animRunning||(this.animRunning=!0,a._animationLoop())};var f=Kinetic.Node.prototype.moveTo;Kinetic.Node.prototype.moveTo=function(a){f.call(this,a)},Kinetic.BaseLayer.prototype.batchDraw=function(){var a=this,b=Kinetic.Animation;this.batchAnim||(this.batchAnim=new b(function(){a.lastBatchDrawTime&&c()-a.lastBatchDrawTime>d&&a.batchAnim.stop()},this)),this.lastBatchDrawTime=c(),this.batchAnim.isRunning()||(this.draw(),this.batchAnim.start())},Kinetic.Stage.prototype.batchDraw=function(){this.getChildren().each(function(a){a.batchDraw()})}}(this),function(){var d={node:1,duration:1,easing:1,onFinish:1,yoyo:1},e=1,a=2,b=3,f=0;Kinetic.Tween=function(a){var h,e,i=this,g=a.node,b=g._id,j=a.easing||Kinetic.Easings.Linear,k=!!a.yoyo;h='undefined'==typeof a.duration?1:0===a.duration?0.001:a.duration,this.node=g,this._id=f++,this.anim=new Kinetic.Animation(function(){i.tween.onEnterFrame()},g.getLayer()||(g instanceof Kinetic.Stage?g.getLayers():null)),this.tween=new c(e,function(b){i._tweenFunc(b)},j,0,1,1000*h,k),this._addListeners(),Kinetic.Tween.attrs[b]||(Kinetic.Tween.attrs[b]={}),Kinetic.Tween.attrs[b][this._id]||(Kinetic.Tween.attrs[b][this._id]={}),Kinetic.Tween.tweens[b]||(Kinetic.Tween.tweens[b]={});for(e in a){void 0===d[e]&&this._addAttr(e,a[e])}this.reset(),this.onFinish=a.onFinish,this.onReset=a.onReset},Kinetic.Tween.attrs={},Kinetic.Tween.tweens={},Kinetic.Tween.prototype={_addAttr:function(a,c){var d,e,g,b,h,i=this.node,f=i._id;if(g=Kinetic.Tween.tweens[f][a],g&&delete Kinetic.Tween.attrs[f][g][a],d=i.getAttr(a),Kinetic.Util._isArray(c)){for(e=[],h=c.length,b=0;h>b;b++){e.push(c[b]-d[b])}}else {e=c-d}Kinetic.Tween.attrs[f][this._id][a]={start:d,diff:e},Kinetic.Tween.tweens[f][a]=this._id},_tweenFunc:function(g){var d,e,a,f,c,b,h,i=this.node,j=Kinetic.Tween.attrs[i._id][this._id];for(d in j){if(e=j[d],a=e.start,f=e.diff,Kinetic.Util._isArray(a)){for(c=[],h=a.length,b=0;h>b;b++){c.push(a[b]+f[b]*g)}}else {c=a+f*g}i.setAttr(d,c)}},_addListeners:function(){var a=this;this.tween.onPlay=function(){a.anim.start()},this.tween.onReverse=function(){a.anim.start()},this.tween.onPause=function(){a.anim.stop()},this.tween.onFinish=function(){a.onFinish&&a.onFinish()},this.tween.onReset=function(){a.onReset&&a.onReset()}},play:function(){return this.tween.play(),this},reverse:function(){return this.tween.reverse(),this},reset:function(){return this.tween.reset(),this},seek:function(a){return this.tween.seek(1000*a),this},pause:function(){return this.tween.pause(),this},finish:function(){return this.tween.finish(),this},destroy:function(){var b,a=this.node._id,c=this._id,d=Kinetic.Tween.tweens[a];this.pause();for(b in d){delete Kinetic.Tween.tweens[a][b]}delete Kinetic.Tween.attrs[a][c]}};var c=function(b,c,d,a,e,f,g){this.prop=b,this.propFunc=c,this.begin=a,this._pos=a,this.duration=f,this._change=0,this.prevPos=0,this.yoyo=g,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=d,this._change=e-this.begin,this.pause()};c.prototype={fire:function(b){var a=this[b];a&&a()},setTime:function(a){a>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():0>a?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=a,this.update())},getTime:function(){return this._time},setPosition:function(a){this.prevPos=this._pos,this.propFunc(a),this._pos=a},getPosition:function(a){return void 0===a&&(a=this._time),this.func(a,this.begin,this._change,this.duration)},play:function(){this.state=a,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire('onPlay')},reverse:function(){this.state=b,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire('onReverse')},seek:function(a){this.pause(),this._time=a,this.update(),this.fire('onSeek')},reset:function(){this.pause(),this._time=0,this.update(),this.fire('onReset')},finish:function(){this.pause(),this._time=this.duration,this.update(),this.fire('onFinish')},update:function(){this.setPosition(this.getPosition(this._time))},onEnterFrame:function(){var c=this.getTimer()-this._startTime;this.state===a?this.setTime(c):this.state===b&&this.setTime(this.duration-c)},pause:function(){this.state=e,this.fire('onPause')},getTimer:function(){return (new Date()).getTime()}},Kinetic.Easings={BackEaseIn:function(a,c,d,e){var b=1.70158;return d*(a/=e)*a*((b+1)*a-b)+c},BackEaseOut:function(a,c,d,e){var b=1.70158;return d*((a=a/e-1)*a*((b+1)*a+b)+1)+c},BackEaseInOut:function(a,c,d,e){var b=1.70158;return (a/=e/2)<1?d/2*a*a*(((b*=1.525)+1)*a-b)+c:d/2*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)+c},ElasticEaseIn:function(c,e,d,f,a,b){var g=0;return 0===c?e:1==(c/=f)?e+d:(b||(b=0.3*f),!a||a<Math.abs(d)?(a=d,g=b/4):g=b/(2*Math.PI)*Math.asin(d/a),-(a*Math.pow(2,10*(c-=1))*Math.sin(2*(c*f-g)*Math.PI/b))+e)},ElasticEaseOut:function(d,e,a,f,b,c){var g=0;return 0===d?e:1==(d/=f)?e+a:(c||(c=0.3*f),!b||b<Math.abs(a)?(b=a,g=c/4):g=c/(2*Math.PI)*Math.asin(a/b),b*Math.pow(2,-10*d)*Math.sin(2*(d*f-g)*Math.PI/c)+a+e)},ElasticEaseInOut:function(a,e,d,f,b,c){var g=0;return 0===a?e:2==(a/=f/2)?e+d:(c||(c=0.3*f*1.5),!b||b<Math.abs(d)?(b=d,g=c/4):g=c/(2*Math.PI)*Math.asin(d/b),1>a?-0.5*b*Math.pow(2,10*(a-=1))*Math.sin(2*(a*f-g)*Math.PI/c)+e:b*Math.pow(2,-10*(a-=1))*Math.sin(2*(a*f-g)*Math.PI/c)*0.5+d+e)},BounceEaseOut:function(a,b,c,d){return (a/=d)<1/2.75?7.5625*c*a*a+b:2/2.75>a?c*(7.5625*(a-=1.5/2.75)*a+0.75)+b:2.5/2.75>a?c*(7.5625*(a-=2.25/2.75)*a+0.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+0.984375)+b},BounceEaseIn:function(c,d,a,b){return a-Kinetic.Easings.BounceEaseOut(b-c,0,a,b)+d},BounceEaseInOut:function(b,d,c,a){return a/2>b?0.5*Kinetic.Easings.BounceEaseIn(2*b,0,c,a)+d:0.5*Kinetic.Easings.BounceEaseOut(2*b-a,0,c,a)+0.5*c+d},EaseIn:function(a,b,c,d){return c*(a/=d)*a+b},EaseOut:function(a,b,c,d){return -c*(a/=d)*(a-2)+b},EaseInOut:function(a,b,c,d){return (a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b},StrongEaseIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},StrongEaseOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},StrongEaseInOut:function(a,b,c,d){return (a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b},Linear:function(a,b,c,d){return c*a/d+b}}}(),function(){Kinetic.DD={anim:new Kinetic.Animation(function(){var a=this.dirty;return this.dirty=!1,a}),isDragging:!1,justDragged:!1,offset:{x:0,y:0},node:null,_drag:function(c){var b=Kinetic.DD,a=b.node;if(a){if(!b.isDragging){var d=a.getStage().getPointerPosition(),e=a.dragDistance(),f=Math.max(Math.abs(d.x-b.startPointerPos.x),Math.abs(d.y-b.startPointerPos.y));if(e>f){return}}a._setDragPosition(c),b.isDragging||(b.isDragging=!0,a.fire('dragstart',{type:'dragstart',target:a,evt:c},!0)),a.fire('dragmove',{type:'dragmove',target:a,evt:c},!0)}},_endDragBefore:function(c){var e,d,a=Kinetic.DD,b=a.node;b&&(e=b.nodeType,d=b.getLayer(),a.anim.stop(),a.isDragging&&(a.isDragging=!1,a.justDragged=!0,Kinetic.listenClickTap=!1,c&&(c.dragEndNode=b)),delete a.node,(d||b).draw())},_endDragAfter:function(a){a=a||{};var b=a.dragEndNode;a&&b&&b.fire('dragend',{type:'dragend',target:b,evt:a},!0)}},Kinetic.Node.prototype.startDrag=function(){var a=Kinetic.DD,d=this.getStage(),e=this.getLayer(),b=d.getPointerPosition(),c=this.getAbsolutePosition();b&&(a.node&&a.node.stopDrag(),a.node=this,a.startPointerPos=b,a.offset.x=b.x-c.x,a.offset.y=b.y-c.y,a.anim.setLayers(e||this.getLayers()),a.anim.start(),this._setDragPosition())},Kinetic.Node.prototype._setDragPosition=function(e){var b=Kinetic.DD,c=this.getStage().getPointerPosition(),d=this.getDragBoundFunc();if(c){var a={x:c.x-b.offset.x,y:c.y-b.offset.y};void 0!==d&&(a=d.call(this,a,e)),this.setAbsolutePosition(a),this._lastPos&&this._lastPos.x===a.x&&this._lastPos.y===a.y||(b.anim.dirty=!0),this._lastPos=a}},Kinetic.Node.prototype.stopDrag=function(){var a=Kinetic.DD,b={};a._endDragBefore(b),a._endDragAfter(b)},Kinetic.Node.prototype.setDraggable=function(a){this._setAttr('draggable',a),this._dragChange()};var b=Kinetic.Node.prototype.destroy;Kinetic.Node.prototype.destroy=function(){var a=Kinetic.DD;a.node&&a.node._id===this._id&&this.stopDrag(),b.call(this)},Kinetic.Node.prototype.isDragging=function(){var a=Kinetic.DD;return !(!a.node||a.node._id!==this._id||!a.isDragging)},Kinetic.Node.prototype._listenDrag=function(){var a=this;this._dragCleanup(),'Stage'===this.getClassName()?this.on('contentMousedown.kinetic contentTouchstart.kinetic',function(b){Kinetic.DD.node||a.startDrag(b)}):this.on('mousedown.kinetic touchstart.kinetic',function(b){1!==b.evt.button&&2!==b.evt.button&&(Kinetic.DD.node||a.startDrag(b))})},Kinetic.Node.prototype._dragChange=function(){if(this.attrs.draggable){this._listenDrag()}else {this._dragCleanup();var b=this.getStage(),a=Kinetic.DD;b&&a.node&&a.node._id===this._id&&a.node.stopDrag()}},Kinetic.Node.prototype._dragCleanup=function(){'Stage'===this.getClassName()?(this.off('contentMousedown.kinetic'),this.off('contentTouchstart.kinetic')):(this.off('mousedown.kinetic'),this.off('touchstart.kinetic'))},Kinetic.Factory.addGetterSetter(Kinetic.Node,'dragBoundFunc'),Kinetic.Factory.addGetter(Kinetic.Node,'draggable',!1),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Node,'draggable');var a=Kinetic.document.documentElement;a.addEventListener('mouseup',Kinetic.DD._endDragBefore,!0),a.addEventListener('touchend',Kinetic.DD._endDragBefore,!0),a.addEventListener('mouseup',Kinetic.DD._endDragAfter,!1),a.addEventListener('touchend',Kinetic.DD._endDragAfter,!1)}(),function(){Kinetic.Util.addMethods(Kinetic.Container,{__init:function(a){this.children=new Kinetic.Collection(),Kinetic.Node.call(this,a)},getChildren:function(a){if(a){var b=new Kinetic.Collection();return this.children.each(function(c){a(c)&&b.push(c)}),b}return this.children},hasChildren:function(){return this.getChildren().length>0},removeChildren:function(){for(var a,b=Kinetic.Collection.toCollection(this.children),c=0;c<b.length;c++){a=b[c],delete a.parent,a.index=0,a.hasChildren()&&a.removeChildren(),a.remove()}return b=null,this.children=new Kinetic.Collection(),this},destroyChildren:function(){for(var a,b=Kinetic.Collection.toCollection(this.children),c=0;c<b.length;c++){a=b[c],delete a.parent,a.index=0,a.destroy()}return b=null,this.children=new Kinetic.Collection(),this},add:function(a){if(arguments.length>1){for(var b=0;b<arguments.length;b++){this.add(arguments[b])}return this}if(a.getParent()){return a.moveTo(this),this}var c=this.children;return this._validateAdd(a),a.index=c.length,a.parent=this,c.push(a),this._fire('add',{child:a}),a.isDragging()&&Kinetic.DD.anim.setLayers(a.getLayer()),this},destroy:function(){this.hasChildren()&&this.destroyChildren(),Kinetic.Node.prototype.destroy.call(this)},find:function(j){var c,d,a,g,e,f,h,b=[],i=j.replace(/ /g,'').split(','),k=i.length;for(c=0;k>c;c++){if(a=i[c],'#'===a.charAt(0)){e=this._getNodeById(a.slice(1)),e&&b.push(e)}else {if('.'===a.charAt(0)){g=this._getNodesByName(a.slice(1)),b=b.concat(g)}else {for(f=this.getChildren(),h=f.length,d=0;h>d;d++){b=b.concat(f[d]._get(a))}}}}return Kinetic.Collection.toCollection(b)},_getNodeById:function(b){var a=Kinetic.ids[b];return void 0!==a&&this.isAncestorOf(a)?a:null},_getNodesByName:function(a){var b=Kinetic.names[a]||[];return this._getDescendants(b)},_get:function(c){for(var a=Kinetic.Node.prototype._get.call(this,c),d=this.getChildren(),e=d.length,b=0;e>b;b++){a=a.concat(d[b]._get(c))}return a},toObject:function(){var a=Kinetic.Node.prototype.toObject.call(this);a.children=[];for(var c=this.getChildren(),d=c.length,b=0;d>b;b++){var e=c[b];a.children.push(e.toObject())}return a},_getDescendants:function(b){for(var c=[],e=b.length,a=0;e>a;a++){var d=b[a];this.isAncestorOf(d)&&c.push(d)}return c},isAncestorOf:function(b){for(var a=b.getParent();a;){if(a._id===this._id){return !0}a=a.getParent()}return !1},clone:function(b){var a=Kinetic.Node.prototype.clone.call(this,b);return this.getChildren().each(function(c){a.add(c.clone())}),a},getAllIntersections:function(b){var a=[];return this.find('Shape').each(function(c){c.isVisible()&&c.intersects(b)&&a.push(c)}),a},_setChildrenIndices:function(){this.children.each(function(a,b){a.index=b})},drawScene:function(d,e){var b=this.getLayer(),a=d||b&&b.getCanvas(),f=a&&a.getContext(),c=this._cache.canvas,g=c&&c.scene;return this.isVisible()&&(g?this._drawCachedSceneCanvas(f):this._drawChildren(a,'drawScene',e)),this},drawHit:function(d,e){var a=this.getLayer(),b=d||a&&a.hitCanvas,f=b&&b.getContext(),c=this._cache.canvas,g=c&&c.hit;return this.shouldDrawHit(b)&&(a&&a.clearHitCache(),g?this._drawCachedHitCanvas(f):this._drawChildren(b,'drawHit',e)),this},_drawChildren:function(b,i,j){var c,d,e=this.getLayer(),a=b&&b.getContext(),f=this.getClipWidth(),g=this.getClipHeight(),h=f&&g;h&&e&&(c=this.getClipX(),d=this.getClipY(),a.save(),e._applyTransform(this,a),a.beginPath(),a.rect(c,d,f,g),a.clip(),a.reset()),this.children.each(function(a){a[i](b,j)}),h&&a.restore()},shouldDrawHit:function(b){var a=this.getLayer(),c=Kinetic.DD,d=c&&Kinetic.isDragging()&&-1!==Kinetic.DD.anim.getLayers().indexOf(a);return b&&b.isCache||a&&a.hitGraphEnabled()&&this.isVisible()&&!d}}),Kinetic.Util.extend(Kinetic.Container,Kinetic.Node),Kinetic.Container.prototype.get=Kinetic.Container.prototype.find,Kinetic.Factory.addComponentsGetterSetter(Kinetic.Container,'clip',['x','y','width','height']),Kinetic.Factory.addGetterSetter(Kinetic.Container,'clipX'),Kinetic.Factory.addGetterSetter(Kinetic.Container,'clipY'),Kinetic.Factory.addGetterSetter(Kinetic.Container,'clipWidth'),Kinetic.Factory.addGetterSetter(Kinetic.Container,'clipHeight'),Kinetic.Collection.mapMethods(Kinetic.Container)}(),function(){function a(a){a.fill()}function b(a){a.stroke()}function c(a){a.fill()}function d(a){a.stroke()}function e(){this._clearCache(f)}var f='hasShadow';Kinetic.Util.addMethods(Kinetic.Shape,{__init:function(h){this.nodeType='Shape',this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=c,this._strokeFuncHit=d;for(var f,g=Kinetic.shapes;f=Kinetic.Util.getRandomColor(),!f||f in g;){}this.colorKey=f,g[f]=this,Kinetic.Node.call(this,h),this.on('shadowColorChange.kinetic shadowBlurChange.kinetic shadowOffsetChange.kinetic shadowOpacityChange.kinetic shadowEnabledChange.kinetic',e)},hasChildren:function(){return !1},getChildren:function(){return []},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return this._getCache(f,this._hasShadow)},_hasShadow:function(){return this.getShadowEnabled()&&0!==this.getShadowOpacity()&&!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffsetX()||this.getShadowOffsetY())},hasFill:function(){return !!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientColorStops()||this.getFillRadialGradientColorStops())},hasStroke:function(){return !!(this.stroke()||this.strokeRed()||this.strokeGreen()||this.strokeBlue())},intersects:function(b){var c,d=this.getStage(),a=d.bufferHitCanvas;return a.getContext().clear(),this.drawScene(a),c=a.context.getImageData(Math.round(b.x),Math.round(b.y),1,1).data,c[3]>0},destroy:function(){Kinetic.Node.prototype.destroy.call(this),delete Kinetic.shapes[this.colorKey]},_useBufferCanvas:function(){return (this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasFill()&&this.hasStroke()&&this.getStage()},drawScene:function(l,f){var j,g,b,e=this.getLayer(),i=l||e.getCanvas(),a=i.getContext(),m=this._cache.canvas,h=this.sceneFunc(),k=this.hasShadow();if(this.isVisible()){if(m){this._drawCachedSceneCanvas(a)}else {if(h){if(a.save(),this._useBufferCanvas()){if(j=this.getStage(),g=j.bufferCanvas,b=g.getContext(),b.clear(),b.save(),b._applyLineJoin(this),e){e._applyTransform(this,b,f)}else {var c=this.getAbsoluteTransform(f).getMatrix();a.transform(c[0],c[1],c[2],c[3],c[4],c[5])}h.call(this,b),b.restore(),k&&!i.hitCanvas&&(a.save(),a._applyShadow(this),a.drawImage(g._canvas,0,0),a.restore()),a._applyOpacity(this),a.drawImage(g._canvas,0,0)}else {if(a._applyLineJoin(this),e){e._applyTransform(this,a,f)}else {var d=this.getAbsoluteTransform(f).getMatrix();a.transform(d[0],d[1],d[2],d[3],d[4],d[5])}k&&!i.hitCanvas&&(a.save(),a._applyShadow(this),h.call(this,a),a.restore()),a._applyOpacity(this),h.call(this,a)}a.restore()}}}return this},drawHit:function(h,d){var c=this.getLayer(),e=h||c.hitCanvas,a=e.getContext(),f=this.hitFunc()||this.sceneFunc(),g=this._cache.canvas,i=g&&g.hit;if(this.shouldDrawHit(e)){if(c&&c.clearHitCache(),i){this._drawCachedHitCanvas(a)}else {if(f){if(a.save(),a._applyLineJoin(this),c){c._applyTransform(this,a,d)}else {var b=this.getAbsoluteTransform(d).getMatrix();a.transform(b[0],b[1],b[2],b[3],b[4],b[5])}f.call(this,a),a.restore()}}}return this},drawHitFromCache:function(m){var h,d,e,b,i,c,a,j,n=m||0,o=this._cache.canvas,f=this._getCachedSceneCanvas(),p=f.getContext(),q=o.hit,g=q.getContext(),k=f.getWidth(),l=f.getHeight();g.clear();try{for(h=p.getImageData(0,0,k,l),d=h.data,e=g.getImageData(0,0,k,l),b=e.data,i=d.length,c=Kinetic.Util._hexToRgb(this.colorKey),a=0;i>a;a+=4){j=d[a+3],j>n&&(b[a]=c.r,b[a+1]=c.g,b[a+2]=c.b,b[a+3]=255)}g.putImageData(e,0,0)}catch(r){Kinetic.Util.warn('Unable to draw hit graph from cached scene canvas. '+r.message)}return this}}),Kinetic.Util.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'stroke'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'strokeRed',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'strokeGreen',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'strokeBlue',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'strokeAlpha',1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'strokeWidth',2),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'lineJoin'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'lineCap'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'sceneFunc'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'hitFunc'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'dash'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowColor'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowRed',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowGreen',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowBlue',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowAlpha',1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowBlur'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowOpacity'),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,'shadowOffset',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowOffsetX',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowOffsetY',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternImage'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fill'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRed',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillGreen',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillBlue',0,Kinetic.Validators.RGBComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillAlpha',1,Kinetic.Validators.alphaComponent),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternX',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternY',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillLinearGradientColorStops'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRadialGradientStartRadius',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRadialGradientEndRadius',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRadialGradientColorStops'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternRepeat','repeat'),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillEnabled',!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'strokeEnabled',!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'shadowEnabled',!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'dashEnabled',!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'strokeScaleEnabled',!0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPriority','color'),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,'fillPatternOffset',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternOffsetX',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternOffsetY',0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,'fillPatternScale',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternScaleX',1),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternScaleY',1),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,'fillLinearGradientStartPoint',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillLinearGradientStartPointX',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillLinearGradientStartPointY',0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,'fillLinearGradientEndPoint',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillLinearGradientEndPointX',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillLinearGradientEndPointY',0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,'fillRadialGradientStartPoint',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRadialGradientStartPointX',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRadialGradientStartPointY',0),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Shape,'fillRadialGradientEndPoint',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRadialGradientEndPointX',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillRadialGradientEndPointY',0),Kinetic.Factory.addGetterSetter(Kinetic.Shape,'fillPatternRotation',0),Kinetic.Factory.backCompat(Kinetic.Shape,{dashArray:'dash',getDashArray:'getDash',setDashArray:'getDash',drawFunc:'sceneFunc',getDrawFunc:'getSceneFunc',setDrawFunc:'setSceneFunc',drawHitFunc:'hitFunc',getDrawHitFunc:'getHitFunc',setDrawHitFunc:'setHitFunc'}),Kinetic.Collection.mapMethods(Kinetic.Shape)}(),function(){function a(a,b){a.content.addEventListener(b,function(c){a[y+b](c)},!1)}var C='Stage',D='string',f='px',b='mouseout',d='mouseleave',g='mouseover',E='mouseenter',h='mousemove',i='mousedown',j='mouseup',F='click',G='dblclick',k='touchstart',l='touchend',H='tap',I='dbltap',m='touchmove',J='DOMMouseScroll',n='mousewheel',K='wheel',L='contentMouseout',M='contentMouseover',N='contentMousemove',O='contentMousedown',P='contentMouseup',o='contentClick',p='contentDblclick',q='contentTouchstart',r='contentTouchend',s='contentDbltap',t='contentTouchmove',c='div',u='relative',v='inline-block',w='kineticjs-content',x=' ',y='_',z='container',A='',e=[i,h,j,b,k,m,l,g,J,n,K],B=e.length;Kinetic.Util.addMethods(Kinetic.Stage,{___init:function(a){this.nodeType=C,Kinetic.Container.call(this,a),this._id=Kinetic.idCounter++,this._buildDOM(),this._bindContentEvents(),this._enableNestedTransforms=!1,Kinetic.stages.push(this)},_validateAdd:function(a){'Layer'!==a.getType()&&Kinetic.Util.error('You may only add layers to the stage.')},setContainer:function(a){if(typeof a===D){var b=a;if(a=Kinetic.document.getElementById(a),!a){throw 'Can not find container in document with id '+b}}return this._setAttr(z,a),this},shouldDrawHit:function(){return !0},draw:function(){return Kinetic.Node.prototype.draw.call(this),this},setHeight:function(a){return Kinetic.Node.prototype.setHeight.call(this,a),this._resizeDOM(),this},setWidth:function(a){return Kinetic.Node.prototype.setWidth.call(this,a),this._resizeDOM(),this},clear:function(){var a,b=this.children,c=b.length;for(a=0;c>a;a++){b[a].clear()}return this},clone:function(a){return a||(a={}),a.container=Kinetic.document.createElement(c),Kinetic.Container.prototype.clone.call(this,a)},destroy:function(){var a=this.content;Kinetic.Container.prototype.destroy.call(this),a&&Kinetic.Util._isInDocument(a)&&this.getContainer().removeChild(a);var b=Kinetic.stages.indexOf(this);b>-1&&Kinetic.stages.splice(b,1)},getPointerPosition:function(){return this.pointerPos},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(a){function b(c){var j=g[c],k=j.toDataURL(),d=new Kinetic.window.Image();d.onload=function(){f.drawImage(d,0,0),c<g.length-1?b(c+1):a.callback(e.toDataURL(h,i))},d.src=k}a=a||{};var h=a.mimeType||null,i=a.quality||null,c=a.x||0,d=a.y||0,e=new Kinetic.SceneCanvas({width:a.width||this.getWidth(),height:a.height||this.getHeight(),pixelRatio:1}),f=e.getContext()._context,g=this.children;(c||d)&&f.translate(-1*c,-1*d),b(0)},toImage:function(a){var b=a.callback;a.callback=function(c){Kinetic.Util._getImage(c,function(d){b(d)})},this.toDataURL(a)},getIntersection:function(d){var a,b,c=this.getChildren(),e=c.length,f=e-1;for(a=f;a>=0;a--){if(b=c[a].getIntersection(d)){return b}}return null},_resizeDOM:function(){if(this.content){var a,d,b=this.getWidth(),c=this.getHeight(),e=this.getChildren(),g=e.length;for(this.content.style.width=b+f,this.content.style.height=c+f,this.bufferCanvas.setSize(b,c),this.bufferHitCanvas.setSize(b,c),a=0;g>a;a++){d=e[a],d.setSize(b,c),d.draw()}}},add:function(a){if(!(arguments.length>1)){return Kinetic.Container.prototype.add.call(this,a),a._setCanvasSize(this.width(),this.height()),a.draw(),this.content.appendChild(a.canvas._canvas),this}for(var b=0;b<arguments.length;b++){this.add(arguments[b])}},getParent:function(){return null},getLayer:function(){return null},getLayers:function(){return this.getChildren()},_bindContentEvents:function(){for(var b=0;B>b;b++){a(this,e[b])}},_mouseover:function(a){Kinetic.UA.mobile||(this._setPointerPosition(a),this._fire(M,{evt:a}))},_mouseout:function(a){if(!Kinetic.UA.mobile){this._setPointerPosition(a);var c=this.targetShape;c&&!Kinetic.isDragging()&&(c._fireAndBubble(b,{evt:a}),c._fireAndBubble(d,{evt:a}),this.targetShape=null),this.pointerPos=void 0,this._fire(L,{evt:a})}},_mousemove:function(a){if(Kinetic.UA.ieMobile){return this._touchmove(a)}if(('undefined'==typeof a.webkitMovementX&&'undefined'==typeof a.webkitMovementY||0!==a.webkitMovementY||0!==a.webkitMovementX)&&!Kinetic.UA.mobile){this._setPointerPosition(a);var c,e=Kinetic.DD;Kinetic.isDragging()||(c=this.getIntersection(this.getPointerPosition()),c&&c.isListening()?Kinetic.isDragging()||this.targetShape&&this.targetShape._id===c._id?c._fireAndBubble(h,{evt:a}):(this.targetShape&&(this.targetShape._fireAndBubble(b,{evt:a},c),this.targetShape._fireAndBubble(d,{evt:a},c)),c._fireAndBubble(g,{evt:a},this.targetShape),c._fireAndBubble(E,{evt:a},this.targetShape),this.targetShape=c):this.targetShape&&!Kinetic.isDragging()&&(this.targetShape._fireAndBubble(b,{evt:a}),this.targetShape._fireAndBubble(d,{evt:a}),this.targetShape=null),this._fire(N,{evt:a})),e&&e._drag(a),a.preventDefault&&a.preventDefault()}},_mousedown:function(a){if(Kinetic.UA.ieMobile){return this._touchstart(a)}if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.clickStartShape=b,b._fireAndBubble(i,{evt:a})),this._fire(O,{evt:a})}a.preventDefault&&a.preventDefault()},_mouseup:function(a){if(Kinetic.UA.ieMobile){return this._touchend(a)}if(!Kinetic.UA.mobile){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),e=this.clickStartShape,d=!1,c=Kinetic.DD;Kinetic.inDblClickWindow?(d=!0,Kinetic.inDblClickWindow=!1):c&&c.justDragged?c&&(c.justDragged=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(j,{evt:a}),Kinetic.listenClickTap&&e&&e._id===b._id&&(b._fireAndBubble(F,{evt:a}),d&&b._fireAndBubble(G,{evt:a}))),this._fire(P,{evt:a}),Kinetic.listenClickTap&&(this._fire(o,{evt:a}),d&&this._fire(p,{evt:a})),Kinetic.listenClickTap=!1}a.preventDefault&&a.preventDefault()},_touchstart:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition());Kinetic.listenClickTap=!0,b&&b.isListening()&&(this.tapStartShape=b,b._fireAndBubble(k,{evt:a}),b.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(q,{evt:a})},_touchend:function(a){this._setPointerPosition(a);var b=this.getIntersection(this.getPointerPosition()),c=!1;Kinetic.inDblClickWindow?(c=!0,Kinetic.inDblClickWindow=!1):Kinetic.inDblClickWindow=!0,setTimeout(function(){Kinetic.inDblClickWindow=!1},Kinetic.dblClickWindow),b&&b.isListening()&&(b._fireAndBubble(l,{evt:a}),Kinetic.listenClickTap&&b._id===this.tapStartShape._id&&(b._fireAndBubble(H,{evt:a}),c&&b._fireAndBubble(I,{evt:a})),b.isListening()&&a.preventDefault&&a.preventDefault()),Kinetic.listenClickTap&&(this._fire(r,{evt:a}),c&&this._fire(s,{evt:a})),Kinetic.listenClickTap=!1},_touchmove:function(a){this._setPointerPosition(a);var b,c=Kinetic.DD;Kinetic.isDragging()||(b=this.getIntersection(this.getPointerPosition()),b&&b.isListening()&&(b._fireAndBubble(m,{evt:a}),b.isListening()&&a.preventDefault&&a.preventDefault()),this._fire(t,{evt:a})),c&&(c._drag(a),Kinetic.isDragging()&&a.preventDefault())},_DOMMouseScroll:function(a){this._mousewheel(a)},_mousewheel:function(b){this._setPointerPosition(b);var a=this.getIntersection(this.getPointerPosition());a&&a.isListening()&&a._fireAndBubble(n,{evt:b})},_wheel:function(a){this._mousewheel(a)},_setPointerPosition:function(a){var e,d=this._getContentPosition(),f=a.offsetX,g=a.clientX,b=null,c=null;a=a?a:window.event,void 0!==a.touches?a.touches.length>0&&(e=a.touches[0],b=e.clientX-d.left,c=e.clientY-d.top):void 0!==f?(b=f,c=a.offsetY):'mozilla'===Kinetic.UA.browser?(b=a.layerX,c=a.layerY):void 0!==g&&d&&(b=g-d.left,c=a.clientY-d.top),null!==b&&null!==c&&(this.pointerPos={x:b,y:c})},_getContentPosition:function(){var a=this.content.getBoundingClientRect?this.content.getBoundingClientRect():{top:0,left:0};return {top:a.top,left:a.left}},_buildDOM:function(){var a=this.getContainer();if(!a){if(Kinetic.Util.isBrowser()){throw 'Stage has no container. A container is required.'}a=Kinetic.document.createElement(c)}a.innerHTML=A,this.content=Kinetic.document.createElement(c),this.content.style.position=u,this.content.style.display=v,this.content.className=w,this.content.setAttribute('role','presentation'),a.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas({pixelRatio:1}),this.bufferHitCanvas=new Kinetic.HitCanvas(),this._resizeDOM()},_onContent:function(d,e){var a,b,c=d.split(x),f=c.length;for(a=0;f>a;a++){b=c[a],this.content.addEventListener(b,e,!1)}},cache:function(){Kinetic.Util.warn('Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.')},clearCache:function(){}}),Kinetic.Util.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Factory.addGetter(Kinetic.Stage,'container'),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Stage,'container')}(),function(){Kinetic.Util.addMethods(Kinetic.BaseLayer,{___init:function(a){this.nodeType='Layer',Kinetic.Container.call(this,a)},createPNGStream:function(){return this.canvas._canvas.createPNGStream()},getCanvas:function(){return this.canvas},getHitCanvas:function(){return this.hitCanvas},getContext:function(){return this.getCanvas().getContext()},clear:function(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this},clearHitCache:function(){this._hitImageData=void 0},setZIndex:function(b){Kinetic.Node.prototype.setZIndex.call(this,b);var a=this.getStage();return a&&(a.content.removeChild(this.getCanvas()._canvas),b<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[b+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas)),this},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),a.content.appendChild(this.getCanvas()._canvas))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var a=this.getStage();a&&(a.content.removeChild(this.getCanvas()._canvas),this.index<a.getChildren().length-1?a.content.insertBefore(this.getCanvas()._canvas,a.getChildren()[this.index+1].getCanvas()._canvas):a.content.appendChild(this.getCanvas()._canvas))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[this.index+1].getCanvas()._canvas)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var a=this.getStage();if(a){var b=a.getChildren();a.content.removeChild(this.getCanvas()._canvas),a.content.insertBefore(this.getCanvas()._canvas,b[1].getCanvas()._canvas)}}},getLayer:function(){return this},remove:function(){var a=this.getCanvas()._canvas;return Kinetic.Node.prototype.remove.call(this),a&&a.parentNode&&Kinetic.Util._isInDocument(a)&&a.parentNode.removeChild(a),this},getStage:function(){return this.parent},setSize:function(a,b){this.canvas.setSize(a,b)},getWidth:function(){return this.parent?this.parent.getWidth():void 0},setWidth:function(){Kinetic.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')},getHeight:function(){return this.parent?this.parent.getHeight():void 0},setHeight:function(){Kinetic.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}}),Kinetic.Util.extend(Kinetic.BaseLayer,Kinetic.Container),Kinetic.Factory.addGetterSetter(Kinetic.BaseLayer,'clearBeforeDraw',!0),Kinetic.Collection.mapMethods(Kinetic.BaseLayer)}(),function(){var b='#',c='beforeDraw',d='draw',a=[{x:0,y:0},{x:-1,y:0},{x:-1,y:-1},{x:0,y:-1},{x:1,y:-1},{x:1,y:0},{x:1,y:1},{x:0,y:1},{x:-1,y:1}],e=a.length;Kinetic.Util.addMethods(Kinetic.Layer,{____init:function(a){this.nodeType='Layer',this.canvas=new Kinetic.SceneCanvas(),this.hitCanvas=new Kinetic.HitCanvas(),Kinetic.BaseLayer.call(this,a)},_setCanvasSize:function(a,b){this.canvas.setSize(a,b),this.hitCanvas.setSize(a,b)},_validateAdd:function(b){var a=b.getType();'Group'!==a&&'Shape'!==a&&Kinetic.Util.error('You may only add groups and shapes to a layer.')},getIntersection:function(g){var c,b,d,h;if(!this.hitGraphEnabled()||!this.isVisible()){return null}for(var f=1,i=!1;;){for(b=0;e>b;b++){if(d=a[b],c=this._getIntersection({x:g.x+d.x*f,y:g.y+d.y*f}),h=c.shape){return h}c.antialiased&&(i=!0)}if(!i){return}f+=1}},_getImageData:function(c,d){var b=this.hitCanvas.width||1,e=this.hitCanvas.height||1,a=Math.round(d)*b+Math.round(c);return this._hitImageData||(this._hitImageData=this.hitCanvas.context.getImageData(0,0,b,e)),[this._hitImageData.data[4*a+0],this._hitImageData.data[4*a+1],this._hitImageData.data[4*a+2],this._hitImageData.data[4*a+3]]},_getIntersection:function(c){var d,e,a=this.hitCanvas.context.getImageData(c.x,c.y,1,1).data,f=a[3];return 255===f?(d=Kinetic.Util._rgbToHex(a[0],a[1],a[2]),e=Kinetic.shapes[b+d],{shape:e}):f>0?{antialiased:!0}:{}},drawScene:function(e,f){var a=this.getLayer(),b=e||a&&a.getCanvas();return this._fire(c,{node:this}),this.getClearBeforeDraw()&&b.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,b,f),this._fire(d,{node:this}),this},_applyTransform:function(b,c,d){var a=b.getAbsoluteTransform(d).getMatrix();c.transform(a[0],a[1],a[2],a[3],a[4],a[5])},drawHit:function(b,c){var a=this.getLayer(),d=b||a&&a.hitCanvas;return a&&a.getClearBeforeDraw()&&a.getHitCanvas().getContext().clear(),Kinetic.Container.prototype.drawHit.call(this,d,c),this.imageData=null,this},clear:function(a){return this.getContext().clear(a),this.getHitCanvas().getContext().clear(a),this.imageData=null,this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),a?(this.getCanvas()._canvas.style.display='block',this.hitCanvas._canvas.style.display='block'):(this.getCanvas()._canvas.style.display='none',this.hitCanvas._canvas.style.display='none'),this},enableHitGraph:function(){return this.setHitGraphEnabled(!0),this},disableHitGraph:function(){return this.setHitGraphEnabled(!1),this},setSize:function(a,b){Kinetic.BaseLayer.prototype.setSize.call(this,a,b),this.hitCanvas.setSize(a,b)}}),Kinetic.Util.extend(Kinetic.Layer,Kinetic.BaseLayer),Kinetic.Factory.addGetterSetter(Kinetic.Layer,'hitGraphEnabled',!0),Kinetic.Collection.mapMethods(Kinetic.Layer)}(),function(){Kinetic.Util.addMethods(Kinetic.FastLayer,{____init:function(a){this.nodeType='Layer',this.canvas=new Kinetic.SceneCanvas(),Kinetic.BaseLayer.call(this,a)},_validateAdd:function(a){var b=a.getType();'Shape'!==b&&Kinetic.Util.error('You may only add shapes to a fast layer.')},_setCanvasSize:function(a,b){this.canvas.setSize(a,b)},hitGraphEnabled:function(){return !1},getIntersection:function(){return null},drawScene:function(c){var a=this.getLayer(),b=c||a&&a.getCanvas();return this.getClearBeforeDraw()&&b.getContext().clear(),Kinetic.Container.prototype.drawScene.call(this,b),this},_applyTransform:function(c,d,b){if(!b||b._id!==this._id){var a=c.getTransform().getMatrix();d.transform(a[0],a[1],a[2],a[3],a[4],a[5])}},draw:function(){return this.drawScene(),this},clear:function(a){return this.getContext().clear(a),this},setVisible:function(a){return Kinetic.Node.prototype.setVisible.call(this,a),this.getCanvas()._canvas.style.display=a?'block':'none',this}}),Kinetic.Util.extend(Kinetic.FastLayer,Kinetic.BaseLayer),Kinetic.Collection.mapMethods(Kinetic.FastLayer)}(),function(){Kinetic.Util.addMethods(Kinetic.Group,{___init:function(a){this.nodeType='Group',Kinetic.Container.call(this,a)},_validateAdd:function(b){var a=b.getType();'Group'!==a&&'Shape'!==a&&Kinetic.Util.error('You may only add groups and shapes to groups.')}}),Kinetic.Util.extend(Kinetic.Group,Kinetic.Container),Kinetic.Collection.mapMethods(Kinetic.Group)}(),function(){Kinetic.Rect=function(a){this.___init(a)},Kinetic.Rect.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='Rect',this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){var a=this.getCornerRadius(),c=this.getWidth(),d=this.getHeight();b.beginPath(),a?(b.moveTo(a,0),b.lineTo(c-a,0),b.arc(c-a,a,a,3*Math.PI/2,0,!1),b.lineTo(c,d-a),b.arc(c-a,d-a,a,0,Math.PI/2,!1),b.lineTo(a,d),b.arc(a,d-a,a,Math.PI/2,Math.PI,!1),b.lineTo(0,a),b.arc(a,a,a,Math.PI,3*Math.PI/2,!1)):b.rect(0,0,c,d),b.closePath(),b.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Rect,'cornerRadius',0),Kinetic.Collection.mapMethods(Kinetic.Rect)}(),function(){var a=2*Math.PI-1.0E-4,b='Circle';Kinetic.Circle=function(a){this.___init(a)},Kinetic.Circle.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getRadius(),0,a,!1),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadius()},getHeight:function(){return 2*this.getRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.radius()!==a/2&&this.setRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.radius()!==a/2&&this.setRadius(a/2)},setRadius:function(a){this._setAttr('radius',a),this.setWidth(2*a),this.setHeight(2*a)}},Kinetic.Util.extend(Kinetic.Circle,Kinetic.Shape),Kinetic.Factory.addGetter(Kinetic.Circle,'radius',0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Circle,'radius'),Kinetic.Collection.mapMethods(Kinetic.Circle)}(),function(){var a=2*Math.PI-1.0E-4,b='Ellipse';Kinetic.Ellipse=function(a){this.___init(a)},Kinetic.Ellipse.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className=b,this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){var c=this.getRadiusX(),d=this.getRadiusY();b.beginPath(),b.save(),c!==d&&b.scale(1,d/c),b.arc(0,0,c,0,a,!1),b.restore(),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getRadiusX()},getHeight:function(){return 2*this.getRadiusY()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.setRadius({x:a/2})},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.setRadius({y:a/2})}},Kinetic.Util.extend(Kinetic.Ellipse,Kinetic.Shape),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Ellipse,'radius',['x','y']),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,'radiusX',0),Kinetic.Factory.addGetterSetter(Kinetic.Ellipse,'radiusY',0),Kinetic.Collection.mapMethods(Kinetic.Ellipse)}(),function(){var a=2*Math.PI-1.0E-4;Kinetic.Ring=function(a){this.___init(a)},Kinetic.Ring.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='Ring',this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){b.beginPath(),b.arc(0,0,this.getInnerRadius(),0,a,!1),b.moveTo(this.getOuterRadius(),0),b.arc(0,0,this.getOuterRadius(),a,0,!0),b.closePath(),b.fillStrokeShape(this)},getWidth:function(){return 2*this.getOuterRadius()},getHeight:function(){return 2*this.getOuterRadius()},setWidth:function(a){Kinetic.Node.prototype.setWidth.call(this,a),this.outerRadius()!==a/2&&this.setOuterRadius(a/2)},setHeight:function(a){Kinetic.Node.prototype.setHeight.call(this,a),this.outerRadius()!==a/2&&this.setOuterRadius(a/2)},setOuterRadius:function(a){this._setAttr('outerRadius',a),this.setWidth(2*a),this.setHeight(2*a)}},Kinetic.Util.extend(Kinetic.Ring,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Ring,'innerRadius',0),Kinetic.Factory.addGetter(Kinetic.Ring,'outerRadius',0),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Ring,'outerRadius'),Kinetic.Collection.mapMethods(Kinetic.Ring)}(),function(){Kinetic.Wedge=function(a){this.___init(a)},Kinetic.Wedge.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='Wedge',this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.beginPath(),a.arc(0,0,this.getRadius(),0,Kinetic.getAngle(this.getAngle()),this.getClockwise()),a.lineTo(0,0),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Wedge,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,'radius',0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,'angle',0),Kinetic.Factory.addGetterSetter(Kinetic.Wedge,'clockwise',!1),Kinetic.Factory.backCompat(Kinetic.Wedge,{angleDeg:'angle',getAngleDeg:'getAngle',setAngleDeg:'setAngle'}),Kinetic.Collection.mapMethods(Kinetic.Wedge)}(),function(){Kinetic.Arc=function(a){this.___init(a)},Kinetic.Arc.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='Arc',this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b=Kinetic.getAngle(this.angle()),c=this.clockwise();a.beginPath(),a.arc(0,0,this.getOuterRadius(),0,b,c),a.arc(0,0,this.getInnerRadius(),b,0,!c),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Arc,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Arc,'innerRadius',0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,'outerRadius',0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,'angle',0),Kinetic.Factory.addGetterSetter(Kinetic.Arc,'clockwise',!1),Kinetic.Collection.mapMethods(Kinetic.Arc)}(),function(){var a='Image';Kinetic.Image=function(a){this.___init(a)},Kinetic.Image.prototype={___init:function(b){Kinetic.Shape.call(this,b),this.className=a,this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_useBufferCanvas:function(){return (this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()&&this.getStage()},_sceneFunc:function(a){var c,d,g,e=this.getWidth(),f=this.getHeight(),b=this.getImage();b&&(c=this.getCropWidth(),d=this.getCropHeight(),g=c&&d?[b,this.getCropX(),this.getCropY(),c,d,0,0,e,f]:[b,0,0,e,f]),(this.hasFill()||this.hasStroke()||this.hasShadow())&&(a.beginPath(),a.rect(0,0,e,f),a.closePath(),a.fillStrokeShape(this)),b&&a.drawImage.apply(a,g)},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},getWidth:function(){var a=this.getImage();return this.attrs.width||(a?a.width:0)},getHeight:function(){var a=this.getImage();return this.attrs.height||(a?a.height:0)}},Kinetic.Util.extend(Kinetic.Image,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Image,'image'),Kinetic.Factory.addComponentsGetterSetter(Kinetic.Image,'crop',['x','y','width','height']),Kinetic.Factory.addGetterSetter(Kinetic.Image,'cropX',0),Kinetic.Factory.addGetterSetter(Kinetic.Image,'cropY',0),Kinetic.Factory.addGetterSetter(Kinetic.Image,'cropWidth',0),Kinetic.Factory.addGetterSetter(Kinetic.Image,'cropHeight',0),Kinetic.Collection.mapMethods(Kinetic.Image)}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var c='auto',i='center',j='Change.kinetic',k='2d',l='-',m='',f='left',n='text',o='Text',p='middle',g='normal',q='px ',e=' ',r='right',s='word',t='char',u='none',h=['fontFamily','fontSize','fontStyle','fontVariant','padding','align','lineHeight','text','width','height','wrap'],v=h.length,d=Kinetic.Util.createCanvasElement().getContext(k);Kinetic.Text=function(a){this.___init(a)},Kinetic.Text.prototype={___init:function(d){d=d||{},d.fill=d.fill||'black',void 0===d.width&&(d.width=c),void 0===d.height&&(d.height=c),Kinetic.Shape.call(this,d),this._fillFunc=a,this._strokeFunc=b,this.className=o;for(var e=0;v>e;e++){this.on(h[e]+j,this._setTextData)}this._setTextData(),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(a){var b,c=this.getPadding(),d=this.getTextHeight(),k=this.getLineHeight()*d,e=this.textArr,l=e.length,g=this.getWidth();for(a.setAttr('font',this._getContextFont()),a.setAttr('textBaseline',p),a.setAttr('textAlign',f),a.save(),a.translate(c,0),a.translate(0,c+d/2),b=0;l>b;b++){var h=e[b],m=h.text,j=h.width;a.save(),this.getAlign()===r?a.translate(g-j-2*c,0):this.getAlign()===i&&a.translate((g-j-2*c)/2,0),this.partialText=m,a.fillStrokeShape(this),a.restore(),a.translate(0,k)}a.restore()},_hitFunc:function(a){var b=this.getWidth(),c=this.getHeight();a.beginPath(),a.rect(0,0,b,c),a.closePath(),a.fillStrokeShape(this)},setText:function(a){var b=Kinetic.Util._isString(a)?a:a.toString();return this._setAttr(n,b),this},getWidth:function(){return this.attrs.width===c?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===c?this.getTextHeight()*this.textArr.length*this.getLineHeight()+2*this.getPadding():this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(c){var b,a=d,e=this.getFontSize();return a.save(),a.font=this._getContextFont(),b=a.measureText(c),a.restore(),{width:b.width,height:parseInt(e,10)}},_getContextFont:function(){return this.getFontStyle()+e+this.getFontVariant()+e+this.getFontSize()+q+this.getFontFamily()},_addTextLine:function(a,b){return this.textArr.push({text:a,width:b})},_getTextWidth:function(a){return d.measureText(a).width},_setTextData:function(){var v=this.getText().split('\n'),w=+this.getFontSize(),f=0,i=this.getLineHeight()*w,x=this.attrs.width,y=this.attrs.height,E=x!==c,z=y!==c,A=this.getPadding(),o=x-2*A,B=y-2*A,j=0,C=this.getWrap(),D=C!==u,F=C!==t&&D;this.textArr=[],d.save(),d.font=this._getContextFont();for(var p=0,G=v.length;G>p;++p){var a=v[p],g=this._getTextWidth(a);if(E&&g>o){for(;a.length>0;){for(var h=0,m=a.length,b='',k=0;m>h;){var n=h+m>>>1,q=a.slice(0,n+1),r=this._getTextWidth(q);o>=r?(h=n+1,b=q,k=r):m=n}if(!b){break}if(F){var s=Math.max(b.lastIndexOf(e),b.lastIndexOf(l))+1;s>0&&(h=s,b=b.slice(0,h),k=this._getTextWidth(b))}if(this._addTextLine(b,k),f=Math.max(f,k),j+=i,!D||z&&j+i>B){break}if(a=a.slice(h),a.length>0&&(g=this._getTextWidth(a),o>=g)){this._addTextLine(a,g),j+=i,f=Math.max(f,g);break}}}else {this._addTextLine(a,g),j+=i,f=Math.max(f,g)}if(z&&j+i>B){break}}d.restore(),this.textHeight=w,this.textWidth=f}},Kinetic.Util.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Text,'fontFamily','Arial'),Kinetic.Factory.addGetterSetter(Kinetic.Text,'fontSize',12),Kinetic.Factory.addGetterSetter(Kinetic.Text,'fontStyle',g),Kinetic.Factory.addGetterSetter(Kinetic.Text,'fontVariant',g),Kinetic.Factory.addGetterSetter(Kinetic.Text,'padding',0),Kinetic.Factory.addGetterSetter(Kinetic.Text,'align',f),Kinetic.Factory.addGetterSetter(Kinetic.Text,'lineHeight',1),Kinetic.Factory.addGetterSetter(Kinetic.Text,'wrap',s),Kinetic.Factory.addGetter(Kinetic.Text,'text',m),Kinetic.Factory.addOverloadedGetterSetter(Kinetic.Text,'text'),Kinetic.Collection.mapMethods(Kinetic.Text)}(),function(){Kinetic.Line=function(a){this.___init(a)},Kinetic.Line.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='Line',this.on('pointsChange.kinetic tensionChange.kinetic closedChange.kinetic',function(){this._clearCache('tensionPoints')}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(c){var a,f,b,d=this.getPoints(),e=d.length,h=this.getTension(),g=this.getClosed();if(e){if(c.beginPath(),c.moveTo(d[0],d[1]),0!==h&&e>4){for(a=this.getTensionPoints(),f=a.length,b=g?0:4,g||c.quadraticCurveTo(a[0],a[1],a[2],a[3]);f-2>b;){c.bezierCurveTo(a[b++],a[b++],a[b++],a[b++],a[b++],a[b++])}g||c.quadraticCurveTo(a[f-2],a[f-1],d[e-2],d[e-1])}else {for(b=2;e>b;b+=2){c.lineTo(d[b],d[b+1])}}g?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}},getTensionPoints:function(){return this._getCache('tensionPoints',this._getTensionPoints)},_getTensionPoints:function(){return this.getClosed()?this._getTensionPointsClosed():Kinetic.Util._expandPoints(this.getPoints(),this.getTension())},_getTensionPointsClosed:function(){var a=this.getPoints(),b=a.length,e=this.getTension(),f=Kinetic.Util,c=f._getControlPoints(a[b-2],a[b-1],a[0],a[1],a[2],a[3],e),d=f._getControlPoints(a[b-4],a[b-3],a[b-2],a[b-1],a[0],a[1],e),g=Kinetic.Util._expandPoints(a,e),h=[c[2],c[3]].concat(g).concat([d[0],d[1],a[b-2],a[b-1],d[2],d[3],c[0],c[1],a[0],a[1]]);return h}},Kinetic.Util.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Line,'closed',!1),Kinetic.Factory.addGetterSetter(Kinetic.Line,'tension',0),Kinetic.Factory.addGetterSetter(Kinetic.Line,'points',[]),Kinetic.Collection.mapMethods(Kinetic.Line)}(),function(){Kinetic.Sprite=function(a){this.___init(a)},Kinetic.Sprite.prototype={___init:function(b){Kinetic.Shape.call(this,b),this.className='Sprite',this._updated=!0;var a=this;this.anim=new Kinetic.Animation(function(){var c=a._updated;return a._updated=!1,c}),this.on('animationChange.kinetic',function(){this.frameIndex(0)}),this.on('frameIndexChange.kinetic',function(){this._updated=!0}),this.on('frameRateChange.kinetic',function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())}),this.sceneFunc(this._sceneFunc),this.hitFunc(this._hitFunc)},_sceneFunc:function(f){var g=this.getAnimation(),h=this.frameIndex(),a=4*h,b=this.getAnimations()[g],i=this.frameOffsets(),j=b[a+0],k=b[a+1],c=b[a+2],d=b[a+3],e=this.getImage();if(e){if(i){var l=i[g],m=2*h;f.drawImage(e,j,k,c,d,l[m+0],l[m+1],c,d)}else {f.drawImage(e,j,k,c,d,0,0,c,d)}}},_hitFunc:function(a){var b=this.getAnimation(),c=this.frameIndex(),d=4*c,e=this.getAnimations()[b],f=this.frameOffsets(),g=e[d+2],h=e[d+3];if(a.beginPath(),f){var i=f[b],j=2*c;a.rect(i[j+0],i[j+1],g,h)}else {a.rect(0,0,g,h)}a.closePath(),a.fillShape(this)},_useBufferCanvas:function(){return (this.hasShadow()||1!==this.getAbsoluteOpacity())&&this.hasStroke()},_setInterval:function(){var a=this;this.interval=setInterval(function(){a._updateIndex()},1000/this.getFrameRate())},start:function(){var a=this.getLayer();this.anim.setLayers(a),this._setInterval(),this.anim.start()},stop:function(){this.anim.stop(),clearInterval(this.interval)},isRunning:function(){return this.anim.isRunning()},_updateIndex:function(){var a=this.frameIndex(),b=this.getAnimation(),c=this.getAnimations(),d=c[b],e=d.length/4;this.frameIndex(e-1>a?a+1:0)}},Kinetic.Util.extend(Kinetic.Sprite,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,'animation'),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,'animations'),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,'frameOffsets'),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,'image'),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,'frameIndex',0),Kinetic.Factory.addGetterSetter(Kinetic.Sprite,'frameRate',17),Kinetic.Factory.backCompat(Kinetic.Sprite,{index:'frameIndex',getIndex:'getFrameIndex',setIndex:'setFrameIndex'}),Kinetic.Collection.mapMethods(Kinetic.Sprite)}(),function(){Kinetic.Path=function(a){this.___init(a)},Kinetic.Path.prototype={___init:function(a){this.dataArray=[];var b=this;Kinetic.Shape.call(this,a),this.className='Path',this.dataArray=Kinetic.Path.parsePathData(this.getData()),this.on('dataChange.kinetic',function(){b.dataArray=Kinetic.Path.parsePathData(this.getData())}),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(b){var f=this.dataArray,g=!1;b.beginPath();for(var e=0;e<f.length;e++){var n=f[e].command,a=f[e].points;switch(n){case 'L':b.lineTo(a[0],a[1]);break;case 'M':b.moveTo(a[0],a[1]);break;case 'C':b.bezierCurveTo(a[0],a[1],a[2],a[3],a[4],a[5]);break;case 'Q':b.quadraticCurveTo(a[0],a[1],a[2],a[3]);break;case 'A':var h=a[0],i=a[1],c=a[2],d=a[3],j=a[4],o=a[5],k=a[6],p=a[7],q=c>d?c:d,l=c>d?1:c/d,m=c>d?d/c:1;b.translate(h,i),b.rotate(k),b.scale(l,m),b.arc(0,0,q,j,j+o,1-p),b.scale(1/l,1/m),b.rotate(-k),b.translate(-h,-i);break;case 'z':b.closePath(),g=!0;}}g?b.fillStrokeShape(this):b.strokeShape(this)}},Kinetic.Util.extend(Kinetic.Path,Kinetic.Shape),Kinetic.Path.getLineLength=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},Kinetic.Path.getPointOnLine=function(h,a,b,c,i,d,e){void 0===d&&(d=a),void 0===e&&(e=b);var f=(i-b)/(c-a+1.0E-8),g=Math.sqrt(h*h/(1+f*f));a>c&&(g*=-1);var j,k=f*g;if(c===a){j={x:d,y:e+k}}else {if((e-b)/(d-a+1.0E-8)===f){j={x:d+g,y:e+k}}else {var l,m,n=this.getLineLength(a,b,c,i);if(1.0E-8>n){return}var o=(d-a)*(c-a)+(e-b)*(i-b);o/=n*n,l=a+o*(c-a),m=b+o*(i-b);var p=this.getLineLength(d,e,l,m),q=Math.sqrt(h*h-p*p);g=Math.sqrt(q*q/(1+f*f)),a>c&&(g*=-1),k=f*g,j={x:l+g,y:m+k}}}return j},Kinetic.Path.getPointOnCubicBezier=function(a,b,c,d,e,f,g,h,i){function j(j){return j*j*j}function k(j){return 3*j*j*(1-j)}function l(j){return 3*j*(1-j)*(1-j)}function m(j){return (1-j)*(1-j)*(1-j)}var n=h*j(a)+f*k(a)+d*l(a)+b*m(a),o=i*j(a)+g*k(a)+e*l(a)+c*m(a);return {x:n,y:o}},Kinetic.Path.getPointOnQuadraticBezier=function(a,b,c,d,e,f,g){function h(h){return h*h}function i(h){return 2*h*(1-h)}function j(h){return (1-h)*(1-h)}var k=f*h(a)+d*i(a)+b*j(a),l=g*h(a)+e*i(a)+c*j(a);return {x:k,y:l}},Kinetic.Path.getPointOnEllipticalArc=function(f,g,h,i,b,c){var d=Math.cos(c),e=Math.sin(c),a={x:h*Math.cos(b),y:i*Math.sin(b)};return {x:f+(a.x*d-a.y*e),y:g+(a.x*e+a.y*d)}},Kinetic.Path.parsePathData=function(z){if(!z){return []}var n=z,w=['m','M','l','L','v','V','h','H','z','Z','c','C','q','Q','t','T','s','S','a','A'];n=n.replace(new RegExp(' ','g'),',');for(var k=0;k<w.length;k++){n=n.replace(new RegExp(w[k],'g'),'|'+w[k])}var A=n.split('|'),e=[],b=0,c=0;for(k=1;k<A.length;k++){var j=A[k],l=j.charAt(0);j=j.slice(1),j=j.replace(new RegExp(',-','g'),'-'),j=j.replace(new RegExp('-','g'),',-'),j=j.replace(new RegExp('e,-','g'),'e-');var a=j.split(',');a.length>0&&''===a[0]&&a.shift();for(var o=0;o<a.length;o++){a[o]=parseFloat(a[o])}for(;a.length>0&&!isNaN(a[0]);){var g,h,i,p,q,r,s,t,u,v,f=null,d=[],B=b,C=c;switch(l){case 'l':b+=a.shift(),c+=a.shift(),f='L',d.push(b,c);break;case 'L':b=a.shift(),c=a.shift(),d.push(b,c);break;case 'm':var x=a.shift(),y=a.shift();if(b+=x,c+=y,f='M',e.length>2&&'z'===e[e.length-1].command){for(var m=e.length-2;m>=0;m--){if('M'===e[m].command){b=e[m].points[0]+x,c=e[m].points[1]+y;break}}};d.push(b,c),l='l';break;case 'M':b=a.shift(),c=a.shift(),f='M',d.push(b,c),l='L';break;case 'h':b+=a.shift(),f='L',d.push(b,c);break;case 'H':b=a.shift(),f='L',d.push(b,c);break;case 'v':c+=a.shift(),f='L',d.push(b,c);break;case 'V':c=a.shift(),f='L',d.push(b,c);break;case 'C':d.push(a.shift(),a.shift(),a.shift(),a.shift()),b=a.shift(),c=a.shift(),d.push(b,c);break;case 'c':d.push(b+a.shift(),c+a.shift(),b+a.shift(),c+a.shift()),b+=a.shift(),c+=a.shift(),f='C',d.push(b,c);break;case 'S':h=b,i=c,g=e[e.length-1],'C'===g.command&&(h=b+(b-g.points[2]),i=c+(c-g.points[3])),d.push(h,i,a.shift(),a.shift()),b=a.shift(),c=a.shift(),f='C',d.push(b,c);break;case 's':h=b,i=c,g=e[e.length-1],'C'===g.command&&(h=b+(b-g.points[2]),i=c+(c-g.points[3])),d.push(h,i,b+a.shift(),c+a.shift()),b+=a.shift(),c+=a.shift(),f='C',d.push(b,c);break;case 'Q':d.push(a.shift(),a.shift()),b=a.shift(),c=a.shift(),d.push(b,c);break;case 'q':d.push(b+a.shift(),c+a.shift()),b+=a.shift(),c+=a.shift(),f='Q',d.push(b,c);break;case 'T':h=b,i=c,g=e[e.length-1],'Q'===g.command&&(h=b+(b-g.points[0]),i=c+(c-g.points[1])),b=a.shift(),c=a.shift(),f='Q',d.push(h,i,b,c);break;case 't':h=b,i=c,g=e[e.length-1],'Q'===g.command&&(h=b+(b-g.points[0]),i=c+(c-g.points[1])),b+=a.shift(),c+=a.shift(),f='Q',d.push(h,i,b,c);break;case 'A':p=a.shift(),q=a.shift(),r=a.shift(),s=a.shift(),t=a.shift(),u=b,v=c,b=a.shift(),c=a.shift(),f='A',d=this.convertEndpointToCenterParameterization(u,v,b,c,s,t,p,q,r);break;case 'a':p=a.shift(),q=a.shift(),r=a.shift(),s=a.shift(),t=a.shift(),u=b,v=c,b+=a.shift(),c+=a.shift(),f='A',d=this.convertEndpointToCenterParameterization(u,v,b,c,s,t,p,q,r);}e.push({command:f||l,points:d,start:{x:B,y:C},pathLength:this.calcLength(B,C,f||l,d)})}('z'===l||'Z'===l)&&e.push({command:'z',points:[],start:void 0,pathLength:0})}return e},Kinetic.Path.calcLength=function(h,i,m,a){var f,c,b,d,e=Kinetic.Path;switch(m){case 'L':return e.getLineLength(h,i,a[0],a[1]);case 'C':for(f=0,c=e.getPointOnCubicBezier(0,h,i,a[0],a[1],a[2],a[3],a[4],a[5]),d=0.01;1>=d;d+=0.01){b=e.getPointOnCubicBezier(d,h,i,a[0],a[1],a[2],a[3],a[4],a[5]),f+=e.getLineLength(c.x,c.y,b.x,b.y),c=b};return f;case 'Q':for(f=0,c=e.getPointOnQuadraticBezier(0,h,i,a[0],a[1],a[2],a[3]),d=0.01;1>=d;d+=0.01){b=e.getPointOnQuadraticBezier(d,h,i,a[0],a[1],a[2],a[3]),f+=e.getLineLength(c.x,c.y,b.x,b.y),c=b};return f;case 'A':f=0;var j=a[4],l=a[5],k=a[4]+l,g=Math.PI/180;if(Math.abs(j-k)<g&&(g=Math.abs(j-k)),c=e.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],j,0),0>l){for(d=j-g;d>k;d-=g){b=e.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],d,0),f+=e.getLineLength(c.x,c.y,b.x,b.y),c=b}}else {for(d=j+g;k>d;d+=g){b=e.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],d,0),f+=e.getLineLength(c.x,c.y,b.x,b.y),c=b}};return b=e.getPointOnEllipticalArc(a[0],a[1],a[2],a[3],k,0),f+=e.getLineLength(c.x,c.y,b.x,b.y);}return 0},Kinetic.Path.convertEndpointToCenterParameterization=function(k,l,m,n,u,j,a,b,v){var e=v*(Math.PI/180),c=Math.cos(e)*(k-m)/2+Math.sin(e)*(l-n)/2,d=-1*Math.sin(e)*(k-m)/2+Math.cos(e)*(l-n)/2,o=c*c/(a*a)+d*d/(b*b);o>1&&(a*=Math.sqrt(o),b*=Math.sqrt(o));var g=Math.sqrt((a*a*b*b-a*a*d*d-b*b*c*c)/(a*a*d*d+b*b*c*c));u===j&&(g*=-1),isNaN(g)&&(g=0);var h=g*a*d/b,i=g*-b*c/a,w=(k+m)/2+Math.cos(e)*h-Math.sin(e)*i,x=(l+n)/2+Math.sin(e)*h+Math.cos(e)*i,s=function(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])},p=function(c,d){return (c[0]*d[0]+c[1]*d[1])/(s(c)*s(d))},t=function(c,d){return (c[0]*d[1]<c[1]*d[0]?-1:1)*Math.acos(p(c,d))},y=t([1,0],[(c-h)/a,(d-i)/b]),q=[(c-h)/a,(d-i)/b],r=[(-1*c-h)/a,(-1*d-i)/b],f=t(q,r);return p(q,r)<=-1&&(f=Math.PI),p(q,r)>=1&&(f=0),0===j&&f>0&&(f-=2*Math.PI),1===j&&0>f&&(f+=2*Math.PI),[w,x,a,b,y,f,e,j]},Kinetic.Factory.addGetterSetter(Kinetic.Path,'data'),Kinetic.Collection.mapMethods(Kinetic.Path)}(),function(){function a(a){a.fillText(this.partialText,0,0)}function b(a){a.strokeText(this.partialText,0,0)}var d='',c='normal';Kinetic.TextPath=function(a){this.___init(a)},Kinetic.TextPath.prototype={___init:function(d){var c=this;this.dummyCanvas=Kinetic.Util.createCanvasElement(),this.dataArray=[],Kinetic.Shape.call(this,d),this._fillFunc=a,this._strokeFunc=b,this._fillFuncHit=a,this._strokeFuncHit=b,this.className='TextPath',this.dataArray=Kinetic.Path.parsePathData(this.attrs.data),this.on('dataChange.kinetic',function(){c.dataArray=Kinetic.Path.parsePathData(this.attrs.data)}),this.on('textChange.kinetic textStroke.kinetic textStrokeWidth.kinetic',c._setTextData),c._setTextData(),this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){a.setAttr('font',this._getContextFont()),a.setAttr('textBaseline','middle'),a.setAttr('textAlign','left'),a.save();for(var c=this.glyphInfo,b=0;b<c.length;b++){a.save();var d=c[b].p0;a.translate(d.x,d.y),a.rotate(c[b].rotation),this.partialText=c[b].text,a.fillStrokeShape(this),a.restore()}a.restore()},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},setText:function(a){Kinetic.Text.prototype.setText.call(this,a)},_getTextSize:function(b){var c=this.dummyCanvas,a=c.getContext('2d');a.save(),a.font=this._getContextFont();var d=a.measureText(b);return a.restore(),{width:d.width,height:parseInt(this.attrs.fontSize,10)}},_setTextData:function(){var g=this,h=this._getTextSize(this.attrs.text);this.textWidth=h.width,this.textHeight=h.height,this.glyphInfo=[];for(var c,d,a,f=this.attrs.text.split(''),i=-1,b=0,k=function(){b=0;for(var d=g.dataArray,a=i+1;a<d.length;a++){if(d[a].pathLength>0){return i=a,d[a]}'M'==d[a].command&&(c={x:d[a].points[0],y:d[a].points[1]})}return {}},l=function(n){var e=g._getTextSize(n).width,f=0,l=0;for(d=void 0;Math.abs(e-f)/e>0.01&&25>l;){l++;for(var m=f;void 0===a;){a=k(),a&&m+a.pathLength<e&&(m+=a.pathLength,a=void 0)}if(a==={}||void 0===c){return}var i=!1;switch(a.command){case 'L':Kinetic.Path.getLineLength(c.x,c.y,a.points[0],a.points[1])>e?d=Kinetic.Path.getPointOnLine(e,c.x,c.y,a.points[0],a.points[1],c.x,c.y):a=void 0;break;case 'A':var o=a.points[4],h=a.points[5],j=a.points[4]+h;0===b?b=o+1.0E-8:e>f?b+=Math.PI/180*h/Math.abs(h):b-=Math.PI/360*h/Math.abs(h),(0>h&&j>b||h>=0&&b>j)&&(b=j,i=!0),d=Kinetic.Path.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],b,a.points[6]);break;case 'C':0===b?b=e>a.pathLength?1.0E-8:e/a.pathLength:e>f?b+=(e-f)/a.pathLength:b-=(f-e)/a.pathLength,b>1&&(b=1,i=!0),d=Kinetic.Path.getPointOnCubicBezier(b,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case 'Q':0===b?b=e/a.pathLength:e>f?b+=(e-f)/a.pathLength:b-=(f-e)/a.pathLength,b>1&&(b=1,i=!0),d=Kinetic.Path.getPointOnQuadraticBezier(b,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);}void 0!==d&&(f=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y)),i&&(i=!1,a=void 0)}},e=0;e<f.length&&(l(f[e]),void 0!==c&&void 0!==d);e++){var m=Kinetic.Path.getLineLength(c.x,c.y,d.x,d.y),n=0,j=Kinetic.Path.getPointOnLine(n+m/2,c.x,c.y,d.x,d.y),o=Math.atan2(d.y-c.y,d.x-c.x);this.glyphInfo.push({transposeX:j.x,transposeY:j.y,text:f[e],rotation:o,p0:c,p1:d}),c=d}}},Kinetic.TextPath.prototype._getContextFont=Kinetic.Text.prototype._getContextFont,Kinetic.Util.extend(Kinetic.TextPath,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,'fontFamily','Arial'),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,'fontSize',12),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,'fontStyle',c),Kinetic.Factory.addGetterSetter(Kinetic.TextPath,'fontVariant',c),Kinetic.Factory.addGetter(Kinetic.TextPath,'text',d),Kinetic.Collection.mapMethods(Kinetic.TextPath)}(),function(){Kinetic.RegularPolygon=function(a){this.___init(a)},Kinetic.RegularPolygon.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='RegularPolygon',this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var b,e,f,c=this.attrs.sides,d=this.attrs.radius;for(a.beginPath(),a.moveTo(0,0-d),b=1;c>b;b++){e=d*Math.sin(2*b*Math.PI/c),f=-1*d*Math.cos(2*b*Math.PI/c),a.lineTo(e,f)}a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.RegularPolygon,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,'radius',0),Kinetic.Factory.addGetterSetter(Kinetic.RegularPolygon,'sides',0),Kinetic.Collection.mapMethods(Kinetic.RegularPolygon)}(),function(){Kinetic.Star=function(a){this.___init(a)},Kinetic.Star.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='Star',this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var f=this.innerRadius(),d=this.outerRadius(),c=this.numPoints();a.beginPath(),a.moveTo(0,0-d);for(var b=1;2*c>b;b++){var e=b%2===0?d:f,g=e*Math.sin(b*Math.PI/c),h=-1*e*Math.cos(b*Math.PI/c);a.lineTo(g,h)}a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Star,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Star,'numPoints',5),Kinetic.Factory.addGetterSetter(Kinetic.Star,'innerRadius',0),Kinetic.Factory.addGetterSetter(Kinetic.Star,'outerRadius',0),Kinetic.Collection.mapMethods(Kinetic.Star)}(),function(){var a=['fontFamily','fontSize','fontStyle','padding','lineHeight','text'],f='Change.kinetic',g='none',b='up',c='right',d='down',e='left',h='Label',i=a.length;Kinetic.Label=function(a){this.____init(a)},Kinetic.Label.prototype={____init:function(b){var a=this;Kinetic.Group.call(this,b),this.className=h,this.on('add.kinetic',function(c){a._addListeners(c.child),a._sync()})},getText:function(){return this.find('Text')[0]},getTag:function(){return this.find('Tag')[0]},_addListeners:function(c){var b,d=this,e=function(){d._sync()};for(b=0;i>b;b++){c.on(a[b]+f,e)}},getWidth:function(){return this.getText().getWidth()},getHeight:function(){return this.getText().getHeight()},_sync:function(){var g,h,m,k,a,f,l,j=this.getText(),i=this.getTag();if(j&&i){switch(g=j.getWidth(),h=j.getHeight(),m=i.getPointerDirection(),k=i.getPointerWidth(),l=i.getPointerHeight(),a=0,f=0,m){case b:a=g/2,f=-1*l;break;case c:a=g+k,f=h/2;break;case d:a=g/2,f=h+l;break;case e:a=-1*k,f=h/2;}i.setAttrs({x:-1*a,y:-1*f,width:g,height:h}),j.setAttrs({x:-1*a,y:-1*f})}}},Kinetic.Util.extend(Kinetic.Label,Kinetic.Group),Kinetic.Collection.mapMethods(Kinetic.Label),Kinetic.Tag=function(a){this.___init(a)},Kinetic.Tag.prototype={___init:function(a){Kinetic.Shape.call(this,a),this.className='Tag',this.sceneFunc(this._sceneFunc)},_sceneFunc:function(a){var g=this.getWidth(),h=this.getHeight(),k=this.getPointerDirection(),i=this.getPointerWidth(),j=this.getPointerHeight(),f=this.getCornerRadius();a.beginPath(),a.moveTo(0,0),k===b&&(a.lineTo((g-i)/2,0),a.lineTo(g/2,-1*j),a.lineTo((g+i)/2,0)),f?(a.lineTo(g-f,0),a.arc(g-f,f,f,3*Math.PI/2,0,!1)):a.lineTo(g,0),k===c&&(a.lineTo(g,(h-j)/2),a.lineTo(g+i,h/2),a.lineTo(g,(h+j)/2)),f?(a.lineTo(g,h-f),a.arc(g-f,h-f,f,0,Math.PI/2,!1)):a.lineTo(g,h),k===d&&(a.lineTo((g+i)/2,h),a.lineTo(g/2,h+j),a.lineTo((g-i)/2,h)),f?(a.lineTo(f,h),a.arc(f,h-f,f,Math.PI/2,Math.PI,!1)):a.lineTo(0,h),k===e&&(a.lineTo(0,(h+j)/2),a.lineTo(-1*i,h/2),a.lineTo(0,(h-j)/2)),f&&(a.lineTo(0,f),a.arc(f,f,f,Math.PI,3*Math.PI/2,!1)),a.closePath(),a.fillStrokeShape(this)}},Kinetic.Util.extend(Kinetic.Tag,Kinetic.Shape),Kinetic.Factory.addGetterSetter(Kinetic.Tag,'pointerDirection',g),Kinetic.Factory.addGetterSetter(Kinetic.Tag,'pointerWidth',0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,'pointerHeight',0),Kinetic.Factory.addGetterSetter(Kinetic.Tag,'cornerRadius',0),Kinetic.Collection.mapMethods(Kinetic.Tag)}(),function(){Kinetic.Arrow=function(a){this.____init(a)},Kinetic.Arrow.prototype={____init:function(a){Kinetic.Line.call(this,a),this.className='Arrow'},_sceneFunc:function(a){var d=2*Math.PI,b=this.points(),c=b.length,e=b[c-2]-b[c-4],f=b[c-1]-b[c-3],i=(Math.atan2(f,e)+d)%d,g=this.pointerLength(),h=this.pointerWidth();a.save(),a.beginPath(),a.translate(b[c-2],b[c-1]),a.rotate(i),a.moveTo(0,0),a.lineTo(-g,h/2),a.lineTo(-g,-h/2),a.closePath(),a.restore(),this.pointerAtBeginning()&&(a.save(),a.translate(b[0],b[1]),e=b[2]-b[0],f=b[3]-b[1],a.rotate((Math.atan2(-f,-e)+d)%d),a.moveTo(0,0),a.lineTo(-10,6),a.lineTo(-10,-6),a.closePath(),a.restore()),a.fillStrokeShape(this),Kinetic.Line.prototype._sceneFunc.apply(this,arguments)}},Kinetic.Util.extend(Kinetic.Arrow,Kinetic.Line),Kinetic.Factory.addGetterSetter(Kinetic.Arrow,'pointerLength',10),Kinetic.Factory.addGetterSetter(Kinetic.Arrow,'pointerWidth',10),Kinetic.Factory.addGetterSetter(Kinetic.Arrow,'pointerAtBeginning',!1),Kinetic.Collection.mapMethods(Kinetic.Arrow)}(),function(a){'function'==typeof define&&define.amd?define(['jquery'],a):'undefined'!=typeof module&&module.exports?module.exports=a(require('jquery')):a(jQuery)}(function(a){function b(b){return !b.nodeName||-1!==a.inArray(b.nodeName.toLowerCase(),['iframe','#document','html','body'])}function c(b){return a.isFunction(b)||a.isPlainObject(b)?b:{top:b,left:b}}var d=a.scrollTo=function(b,c,d){return a(window).scrollTo(b,c,d)};return d.defaults={axis:'xy',duration:0,limit:!0},a.fn.scrollTo=function(g,f,e){'object'==typeof f&&(e=f,f=0),'function'==typeof e&&(e={onAfter:e}),'max'===g&&(g=9.0E9),e=a.extend({},d.defaults,e),f=f||e.duration;var h=e.queue&&1<e.axis.length;return h&&(f/=2),e.offset=c(e.offset),e.over=c(e.over),this.each(function(){function i(b){var c=a.extend({},e,{queue:!0,duration:f,complete:b&&function(){b.call(l,j,e)}});o.animate(k,c)}if(null!==g){var m,n=b(this),l=n?this.contentWindow||window:this,o=a(l),j=g,k={};switch(typeof j){case 'number':case 'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(j)){j=c(j);break};j=n?a(j):a(j,l);case 'object':if(0===j.length){return};(j.is||j.style)&&(m=(j=a(j)).offset());}var p=a.isFunction(e.offset)&&e.offset(l,j)||e.offset;a.each(e.axis.split(''),function(u,r){var c='x'===r?'Left':'Top',q=c.toLowerCase(),b='scroll'+c,s=o[b](),t=d.max(l,r);m?(k[b]=m[q]+(n?0:s-o.offset()[q]),e.margin&&(k[b]-=parseInt(j.css('margin'+c),10)||0,k[b]-=parseInt(j.css('border'+c+'Width'),10)||0),k[b]+=p[q]||0,e.over[q]&&(k[b]+=j['x'===r?'width':'height']()*e.over[q])):(c=j[q],k[b]=c.slice&&'%'===c.slice(-1)?parseFloat(c)/100*t:c),e.limit&&/^\d+$/.test(k[b])&&(k[b]=0>=k[b]?0:Math.min(k[b],t)),!u&&1<e.axis.length&&(s===k[b]?k={}:h&&(i(e.onAfterFirst),k={}))}),i(e.onAfter)}})},d.max=function(d,h){var c='x'===h?'Width':'Height',f='scroll'+c;if(!b(d)){return d[f]-a(d)[c.toLowerCase()]()}var c='client'+c,e=d.ownerDocument||d.document,g=e.documentElement,e=e.body;return Math.max(g[f],e[f])-Math.min(g[c],e[c])},a.Tween.propHooks.scrollLeft=a.Tween.propHooks.scrollTop={get:function(b){return a(b.elem)[b.prop]()},set:function(b){var c=this.get(b);if(b.options.interrupt&&b._last&&b._last!==c){return a(b.elem).stop()}var d=Math.round(b.now);c!==d&&(a(b.elem)[b.prop](d),b._last=this.get(b))}},d});